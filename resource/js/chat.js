/*
 The buffer module from node.js, for the browser.

 @author   Feross Aboukhadijeh <https://feross.org>
 @license  MIT
 ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */
(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a;}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){exports.byteLength=
byteLength;exports.toByteArray=toByteArray;exports.fromByteArray=fromByteArray;var lookup=[];var revLookup=[];var Arr=typeof Uint8Array!=="undefined"?Uint8Array:Array;var code="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var i=0,len=code.length;i<len;++i){lookup[i]=code[i];revLookup[code.charCodeAt(i)]=i}revLookup["-".charCodeAt(0)]=62;revLookup["_".charCodeAt(0)]=63;function getLens(b64){var len=b64.length;if(len%4>0)throw new Error("Invalid string. Length must be a multiple of 4");
var validLen=b64.indexOf("=");if(validLen===-1)validLen=len;var placeHoldersLen=validLen===len?0:4-validLen%4;return[validLen,placeHoldersLen]}function byteLength(b64){var lens=getLens(b64);var validLen=lens[0];var placeHoldersLen=lens[1];return(validLen+placeHoldersLen)*3/4-placeHoldersLen}function _byteLength(b64,validLen,placeHoldersLen){return(validLen+placeHoldersLen)*3/4-placeHoldersLen}function toByteArray(b64){var tmp;var lens=getLens(b64);var validLen=lens[0];var placeHoldersLen=lens[1];
var arr=new Arr(_byteLength(b64,validLen,placeHoldersLen));var curByte=0;var len=placeHoldersLen>0?validLen-4:validLen;var i;for(i=0;i<len;i+=4){tmp=revLookup[b64.charCodeAt(i)]<<18|revLookup[b64.charCodeAt(i+1)]<<12|revLookup[b64.charCodeAt(i+2)]<<6|revLookup[b64.charCodeAt(i+3)];arr[curByte++]=tmp>>16&255;arr[curByte++]=tmp>>8&255;arr[curByte++]=tmp&255}if(placeHoldersLen===2){tmp=revLookup[b64.charCodeAt(i)]<<2|revLookup[b64.charCodeAt(i+1)]>>4;arr[curByte++]=tmp&255}if(placeHoldersLen===1){tmp=
revLookup[b64.charCodeAt(i)]<<10|revLookup[b64.charCodeAt(i+1)]<<4|revLookup[b64.charCodeAt(i+2)]>>2;arr[curByte++]=tmp>>8&255;arr[curByte++]=tmp&255}return arr}function tripletToBase64(num){return lookup[num>>18&63]+lookup[num>>12&63]+lookup[num>>6&63]+lookup[num&63]}function encodeChunk(uint8,start,end){var tmp;var output=[];for(var i=start;i<end;i+=3){tmp=(uint8[i]<<16&16711680)+(uint8[i+1]<<8&65280)+(uint8[i+2]&255);output.push(tripletToBase64(tmp))}return output.join("")}function fromByteArray(uint8){var tmp;
var len=uint8.length;var extraBytes=len%3;var parts=[];var maxChunkLength=16383;for(var i=0,len2=len-extraBytes;i<len2;i+=maxChunkLength)parts.push(encodeChunk(uint8,i,i+maxChunkLength>len2?len2:i+maxChunkLength));if(extraBytes===1){tmp=uint8[len-1];parts.push(lookup[tmp>>2]+lookup[tmp<<4&63]+"==")}else if(extraBytes===2){tmp=(uint8[len-2]<<8)+uint8[len-1];parts.push(lookup[tmp>>10]+lookup[tmp>>4&63]+lookup[tmp<<2&63]+"=")}return parts.join("")}},{}],2:[function(require,module,exports){(function(Buffer){(function(){var base64=
require("base64-js");var ieee754=require("ieee754");exports.Buffer=Buffer;exports.SlowBuffer=SlowBuffer;exports.INSPECT_MAX_BYTES=50;var K_MAX_LENGTH=2147483647;exports.kMaxLength=K_MAX_LENGTH;Buffer.TYPED_ARRAY_SUPPORT=typedArraySupport();if(!Buffer.TYPED_ARRAY_SUPPORT&&typeof console!=="undefined"&&typeof console.error==="function")console.error("This browser lacks typed array (Uint8Array) support which is required by "+"`buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function typedArraySupport(){try{var arr=
new Uint8Array(1);arr.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}};return arr.foo()===42}catch(e){return false}}Object.defineProperty(Buffer.prototype,"parent",{enumerable:true,get:function(){if(!Buffer.isBuffer(this))return undefined;return this.buffer}});Object.defineProperty(Buffer.prototype,"offset",{enumerable:true,get:function(){if(!Buffer.isBuffer(this))return undefined;return this.byteOffset}});function createBuffer(length){if(length>K_MAX_LENGTH)throw new RangeError('The value "'+
length+'" is invalid for option "size"');var buf=new Uint8Array(length);buf.__proto__=Buffer.prototype;return buf}function Buffer(arg,encodingOrOffset,length){if(typeof arg==="number"){if(typeof encodingOrOffset==="string")throw new TypeError('The "string" argument must be of type string. Received type number');return allocUnsafe(arg)}return from(arg,encodingOrOffset,length)}if(typeof Symbol!=="undefined"&&Symbol.species!=null&&Buffer[Symbol.species]===Buffer)Object.defineProperty(Buffer,Symbol.species,
{value:null,configurable:true,enumerable:false,writable:false});Buffer.poolSize=8192;function from(value,encodingOrOffset,length){if(typeof value==="string")return fromString(value,encodingOrOffset);if(ArrayBuffer.isView(value))return fromArrayLike(value);if(value==null)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, "+"or Array-like Object. Received type "+typeof value);if(isInstance(value,ArrayBuffer)||value&&isInstance(value.buffer,ArrayBuffer))return fromArrayBuffer(value,
encodingOrOffset,length);if(typeof value==="number")throw new TypeError('The "value" argument must not be of type number. Received type number');var valueOf=value.valueOf&&value.valueOf();if(valueOf!=null&&valueOf!==value)return Buffer.from(valueOf,encodingOrOffset,length);var b=fromObject(value);if(b)return b;if(typeof Symbol!=="undefined"&&Symbol.toPrimitive!=null&&typeof value[Symbol.toPrimitive]==="function")return Buffer.from(value[Symbol.toPrimitive]("string"),encodingOrOffset,length);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, "+
"or Array-like Object. Received type "+typeof value);}Buffer.from=function(value,encodingOrOffset,length){return from(value,encodingOrOffset,length)};Buffer.prototype.__proto__=Uint8Array.prototype;Buffer.__proto__=Uint8Array;function assertSize(size){if(typeof size!=="number")throw new TypeError('"size" argument must be of type number');else if(size<0)throw new RangeError('The value "'+size+'" is invalid for option "size"');}function alloc(size,fill,encoding){assertSize(size);if(size<=0)return createBuffer(size);
if(fill!==undefined)return typeof encoding==="string"?createBuffer(size).fill(fill,encoding):createBuffer(size).fill(fill);return createBuffer(size)}Buffer.alloc=function(size,fill,encoding){return alloc(size,fill,encoding)};function allocUnsafe(size){assertSize(size);return createBuffer(size<0?0:checked(size)|0)}Buffer.allocUnsafe=function(size){return allocUnsafe(size)};Buffer.allocUnsafeSlow=function(size){return allocUnsafe(size)};function fromString(string,encoding){if(typeof encoding!=="string"||
encoding==="")encoding="utf8";if(!Buffer.isEncoding(encoding))throw new TypeError("Unknown encoding: "+encoding);var length=byteLength(string,encoding)|0;var buf=createBuffer(length);var actual=buf.write(string,encoding);if(actual!==length)buf=buf.slice(0,actual);return buf}function fromArrayLike(array){var length=array.length<0?0:checked(array.length)|0;var buf=createBuffer(length);for(var i=0;i<length;i+=1)buf[i]=array[i]&255;return buf}function fromArrayBuffer(array,byteOffset,length){if(byteOffset<
0||array.byteLength<byteOffset)throw new RangeError('"offset" is outside of buffer bounds');if(array.byteLength<byteOffset+(length||0))throw new RangeError('"length" is outside of buffer bounds');var buf;if(byteOffset===undefined&&length===undefined)buf=new Uint8Array(array);else if(length===undefined)buf=new Uint8Array(array,byteOffset);else buf=new Uint8Array(array,byteOffset,length);buf.__proto__=Buffer.prototype;return buf}function fromObject(obj){if(Buffer.isBuffer(obj)){var len=checked(obj.length)|
0;var buf=createBuffer(len);if(buf.length===0)return buf;obj.copy(buf,0,0,len);return buf}if(obj.length!==undefined){if(typeof obj.length!=="number"||numberIsNaN(obj.length))return createBuffer(0);return fromArrayLike(obj)}if(obj.type==="Buffer"&&Array.isArray(obj.data))return fromArrayLike(obj.data)}function checked(length){if(length>=K_MAX_LENGTH)throw new RangeError("Attempt to allocate Buffer larger than maximum "+"size: 0x"+K_MAX_LENGTH.toString(16)+" bytes");return length|0}function SlowBuffer(length){if(+length!=
length)length=0;return Buffer.alloc(+length)}Buffer.isBuffer=function isBuffer(b){return b!=null&&b._isBuffer===true&&b!==Buffer.prototype};Buffer.compare=function compare(a,b){if(isInstance(a,Uint8Array))a=Buffer.from(a,a.offset,a.byteLength);if(isInstance(b,Uint8Array))b=Buffer.from(b,b.offset,b.byteLength);if(!Buffer.isBuffer(a)||!Buffer.isBuffer(b))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(a===b)return 0;var x=a.length;var y=b.length;for(var i=
0,len=Math.min(x,y);i<len;++i)if(a[i]!==b[i]){x=a[i];y=b[i];break}if(x<y)return-1;if(y<x)return 1;return 0};Buffer.isEncoding=function isEncoding(encoding){switch(String(encoding).toLowerCase()){case "hex":case "utf8":case "utf-8":case "ascii":case "latin1":case "binary":case "base64":case "ucs2":case "ucs-2":case "utf16le":case "utf-16le":return true;default:return false}};Buffer.concat=function concat(list,length){if(!Array.isArray(list))throw new TypeError('"list" argument must be an Array of Buffers');
if(list.length===0)return Buffer.alloc(0);var i;if(length===undefined){length=0;for(i=0;i<list.length;++i)length+=list[i].length}var buffer=Buffer.allocUnsafe(length);var pos=0;for(i=0;i<list.length;++i){var buf=list[i];if(isInstance(buf,Uint8Array))buf=Buffer.from(buf);if(!Buffer.isBuffer(buf))throw new TypeError('"list" argument must be an Array of Buffers');buf.copy(buffer,pos);pos+=buf.length}return buffer};function byteLength(string,encoding){if(Buffer.isBuffer(string))return string.length;if(ArrayBuffer.isView(string)||
isInstance(string,ArrayBuffer))return string.byteLength;if(typeof string!=="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. '+"Received type "+typeof string);var len=string.length;var mustMatch=arguments.length>2&&arguments[2]===true;if(!mustMatch&&len===0)return 0;var loweredCase=false;for(;;)switch(encoding){case "ascii":case "latin1":case "binary":return len;case "utf8":case "utf-8":return utf8ToBytes(string).length;case "ucs2":case "ucs-2":case "utf16le":case "utf-16le":return len*
2;case "hex":return len>>>1;case "base64":return base64ToBytes(string).length;default:if(loweredCase)return mustMatch?-1:utf8ToBytes(string).length;encoding=(""+encoding).toLowerCase();loweredCase=true}}Buffer.byteLength=byteLength;function slowToString(encoding,start,end){var loweredCase=false;if(start===undefined||start<0)start=0;if(start>this.length)return"";if(end===undefined||end>this.length)end=this.length;if(end<=0)return"";end>>>=0;start>>>=0;if(end<=start)return"";if(!encoding)encoding="utf8";
while(true)switch(encoding){case "hex":return hexSlice(this,start,end);case "utf8":case "utf-8":return utf8Slice(this,start,end);case "ascii":return asciiSlice(this,start,end);case "latin1":case "binary":return latin1Slice(this,start,end);case "base64":return base64Slice(this,start,end);case "ucs2":case "ucs-2":case "utf16le":case "utf-16le":return utf16leSlice(this,start,end);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(encoding+"").toLowerCase();loweredCase=
true}}Buffer.prototype._isBuffer=true;function swap(b,n,m){var i=b[n];b[n]=b[m];b[m]=i}Buffer.prototype.swap16=function swap16(){var len=this.length;if(len%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var i=0;i<len;i+=2)swap(this,i,i+1);return this};Buffer.prototype.swap32=function swap32(){var len=this.length;if(len%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var i=0;i<len;i+=4){swap(this,i,i+3);swap(this,i+1,i+2)}return this};Buffer.prototype.swap64=
function swap64(){var len=this.length;if(len%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var i=0;i<len;i+=8){swap(this,i,i+7);swap(this,i+1,i+6);swap(this,i+2,i+5);swap(this,i+3,i+4)}return this};Buffer.prototype.toString=function toString(){var length=this.length;if(length===0)return"";if(arguments.length===0)return utf8Slice(this,0,length);return slowToString.apply(this,arguments)};Buffer.prototype.toLocaleString=Buffer.prototype.toString;Buffer.prototype.equals=
function equals(b){if(!Buffer.isBuffer(b))throw new TypeError("Argument must be a Buffer");if(this===b)return true;return Buffer.compare(this,b)===0};Buffer.prototype.inspect=function inspect(){var str="";var max=exports.INSPECT_MAX_BYTES;str=this.toString("hex",0,max).replace(/(.{2})/g,"$1 ").trim();if(this.length>max)str+=" ... ";return"<Buffer "+str+">"};Buffer.prototype.compare=function compare(target,start,end,thisStart,thisEnd){if(isInstance(target,Uint8Array))target=Buffer.from(target,target.offset,
target.byteLength);if(!Buffer.isBuffer(target))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. '+"Received type "+typeof target);if(start===undefined)start=0;if(end===undefined)end=target?target.length:0;if(thisStart===undefined)thisStart=0;if(thisEnd===undefined)thisEnd=this.length;if(start<0||end>target.length||thisStart<0||thisEnd>this.length)throw new RangeError("out of range index");if(thisStart>=thisEnd&&start>=end)return 0;if(thisStart>=thisEnd)return-1;
if(start>=end)return 1;start>>>=0;end>>>=0;thisStart>>>=0;thisEnd>>>=0;if(this===target)return 0;var x=thisEnd-thisStart;var y=end-start;var len=Math.min(x,y);var thisCopy=this.slice(thisStart,thisEnd);var targetCopy=target.slice(start,end);for(var i=0;i<len;++i)if(thisCopy[i]!==targetCopy[i]){x=thisCopy[i];y=targetCopy[i];break}if(x<y)return-1;if(y<x)return 1;return 0};function bidirectionalIndexOf(buffer,val,byteOffset,encoding,dir){if(buffer.length===0)return-1;if(typeof byteOffset==="string"){encoding=
byteOffset;byteOffset=0}else if(byteOffset>2147483647)byteOffset=2147483647;else if(byteOffset<-2147483648)byteOffset=-2147483648;byteOffset=+byteOffset;if(numberIsNaN(byteOffset))byteOffset=dir?0:buffer.length-1;if(byteOffset<0)byteOffset=buffer.length+byteOffset;if(byteOffset>=buffer.length)if(dir)return-1;else byteOffset=buffer.length-1;else if(byteOffset<0)if(dir)byteOffset=0;else return-1;if(typeof val==="string")val=Buffer.from(val,encoding);if(Buffer.isBuffer(val)){if(val.length===0)return-1;
return arrayIndexOf(buffer,val,byteOffset,encoding,dir)}else if(typeof val==="number"){val=val&255;if(typeof Uint8Array.prototype.indexOf==="function")if(dir)return Uint8Array.prototype.indexOf.call(buffer,val,byteOffset);else return Uint8Array.prototype.lastIndexOf.call(buffer,val,byteOffset);return arrayIndexOf(buffer,[val],byteOffset,encoding,dir)}throw new TypeError("val must be string, number or Buffer");}function arrayIndexOf(arr,val,byteOffset,encoding,dir){var indexSize=1;var arrLength=arr.length;
var valLength=val.length;if(encoding!==undefined){encoding=String(encoding).toLowerCase();if(encoding==="ucs2"||encoding==="ucs-2"||encoding==="utf16le"||encoding==="utf-16le"){if(arr.length<2||val.length<2)return-1;indexSize=2;arrLength/=2;valLength/=2;byteOffset/=2}}function read(buf,i){if(indexSize===1)return buf[i];else return buf.readUInt16BE(i*indexSize)}var i;if(dir){var foundIndex=-1;for(i=byteOffset;i<arrLength;i++)if(read(arr,i)===read(val,foundIndex===-1?0:i-foundIndex)){if(foundIndex===
-1)foundIndex=i;if(i-foundIndex+1===valLength)return foundIndex*indexSize}else{if(foundIndex!==-1)i-=i-foundIndex;foundIndex=-1}}else{if(byteOffset+valLength>arrLength)byteOffset=arrLength-valLength;for(i=byteOffset;i>=0;i--){var found=true;for(var j=0;j<valLength;j++)if(read(arr,i+j)!==read(val,j)){found=false;break}if(found)return i}}return-1}Buffer.prototype.includes=function includes(val,byteOffset,encoding){return this.indexOf(val,byteOffset,encoding)!==-1};Buffer.prototype.indexOf=function indexOf(val,
byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,true)};Buffer.prototype.lastIndexOf=function lastIndexOf(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,false)};function hexWrite(buf,string,offset,length){offset=Number(offset)||0;var remaining=buf.length-offset;if(!length)length=remaining;else{length=Number(length);if(length>remaining)length=remaining}var strLen=string.length;if(length>strLen/2)length=strLen/2;for(var i=0;i<length;++i){var parsed=
parseInt(string.substr(i*2,2),16);if(numberIsNaN(parsed))return i;buf[offset+i]=parsed}return i}function utf8Write(buf,string,offset,length){return blitBuffer(utf8ToBytes(string,buf.length-offset),buf,offset,length)}function asciiWrite(buf,string,offset,length){return blitBuffer(asciiToBytes(string),buf,offset,length)}function latin1Write(buf,string,offset,length){return asciiWrite(buf,string,offset,length)}function base64Write(buf,string,offset,length){return blitBuffer(base64ToBytes(string),buf,
offset,length)}function ucs2Write(buf,string,offset,length){return blitBuffer(utf16leToBytes(string,buf.length-offset),buf,offset,length)}Buffer.prototype.write=function write(string,offset,length,encoding){if(offset===undefined){encoding="utf8";length=this.length;offset=0}else if(length===undefined&&typeof offset==="string"){encoding=offset;length=this.length;offset=0}else if(isFinite(offset)){offset=offset>>>0;if(isFinite(length)){length=length>>>0;if(encoding===undefined)encoding="utf8"}else{encoding=
length;length=undefined}}else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var remaining=this.length-offset;if(length===undefined||length>remaining)length=remaining;if(string.length>0&&(length<0||offset<0)||offset>this.length)throw new RangeError("Attempt to write outside buffer bounds");if(!encoding)encoding="utf8";var loweredCase=false;for(;;)switch(encoding){case "hex":return hexWrite(this,string,offset,length);case "utf8":case "utf-8":return utf8Write(this,
string,offset,length);case "ascii":return asciiWrite(this,string,offset,length);case "latin1":case "binary":return latin1Write(this,string,offset,length);case "base64":return base64Write(this,string,offset,length);case "ucs2":case "ucs-2":case "utf16le":case "utf-16le":return ucs2Write(this,string,offset,length);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(""+encoding).toLowerCase();loweredCase=true}};Buffer.prototype.toJSON=function toJSON(){return{type:"Buffer",
data:Array.prototype.slice.call(this._arr||this,0)}};function base64Slice(buf,start,end){if(start===0&&end===buf.length)return base64.fromByteArray(buf);else return base64.fromByteArray(buf.slice(start,end))}function utf8Slice(buf,start,end){end=Math.min(buf.length,end);var res=[];var i=start;while(i<end){var firstByte=buf[i];var codePoint=null;var bytesPerSequence=firstByte>239?4:firstByte>223?3:firstByte>191?2:1;if(i+bytesPerSequence<=end){var secondByte,thirdByte,fourthByte,tempCodePoint;switch(bytesPerSequence){case 1:if(firstByte<
128)codePoint=firstByte;break;case 2:secondByte=buf[i+1];if((secondByte&192)===128){tempCodePoint=(firstByte&31)<<6|secondByte&63;if(tempCodePoint>127)codePoint=tempCodePoint}break;case 3:secondByte=buf[i+1];thirdByte=buf[i+2];if((secondByte&192)===128&&(thirdByte&192)===128){tempCodePoint=(firstByte&15)<<12|(secondByte&63)<<6|thirdByte&63;if(tempCodePoint>2047&&(tempCodePoint<55296||tempCodePoint>57343))codePoint=tempCodePoint}break;case 4:secondByte=buf[i+1];thirdByte=buf[i+2];fourthByte=buf[i+
3];if((secondByte&192)===128&&(thirdByte&192)===128&&(fourthByte&192)===128){tempCodePoint=(firstByte&15)<<18|(secondByte&63)<<12|(thirdByte&63)<<6|fourthByte&63;if(tempCodePoint>65535&&tempCodePoint<1114112)codePoint=tempCodePoint}}}if(codePoint===null){codePoint=65533;bytesPerSequence=1}else if(codePoint>65535){codePoint-=65536;res.push(codePoint>>>10&1023|55296);codePoint=56320|codePoint&1023}res.push(codePoint);i+=bytesPerSequence}return decodeCodePointsArray(res)}var MAX_ARGUMENTS_LENGTH=4096;
function decodeCodePointsArray(codePoints){var len=codePoints.length;if(len<=MAX_ARGUMENTS_LENGTH)return String.fromCharCode.apply(String,codePoints);var res="";var i=0;while(i<len)res+=String.fromCharCode.apply(String,codePoints.slice(i,i+=MAX_ARGUMENTS_LENGTH));return res}function asciiSlice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i)ret+=String.fromCharCode(buf[i]&127);return ret}function latin1Slice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=
start;i<end;++i)ret+=String.fromCharCode(buf[i]);return ret}function hexSlice(buf,start,end){var len=buf.length;if(!start||start<0)start=0;if(!end||end<0||end>len)end=len;var out="";for(var i=start;i<end;++i)out+=toHex(buf[i]);return out}function utf16leSlice(buf,start,end){var bytes=buf.slice(start,end);var res="";for(var i=0;i<bytes.length;i+=2)res+=String.fromCharCode(bytes[i]+bytes[i+1]*256);return res}Buffer.prototype.slice=function slice(start,end){var len=this.length;start=~~start;end=end===
undefined?len:~~end;if(start<0){start+=len;if(start<0)start=0}else if(start>len)start=len;if(end<0){end+=len;if(end<0)end=0}else if(end>len)end=len;if(end<start)end=start;var newBuf=this.subarray(start,end);newBuf.__proto__=Buffer.prototype;return newBuf};function checkOffset(offset,ext,length){if(offset%1!==0||offset<0)throw new RangeError("offset is not uint");if(offset+ext>length)throw new RangeError("Trying to access beyond buffer length");}Buffer.prototype.readUIntLE=function readUIntLE(offset,
byteLength,noAssert){offset=offset>>>0;byteLength=byteLength>>>0;if(!noAssert)checkOffset(offset,byteLength,this.length);var val=this[offset];var mul=1;var i=0;while(++i<byteLength&&(mul*=256))val+=this[offset+i]*mul;return val};Buffer.prototype.readUIntBE=function readUIntBE(offset,byteLength,noAssert){offset=offset>>>0;byteLength=byteLength>>>0;if(!noAssert)checkOffset(offset,byteLength,this.length);var val=this[offset+--byteLength];var mul=1;while(byteLength>0&&(mul*=256))val+=this[offset+--byteLength]*
mul;return val};Buffer.prototype.readUInt8=function readUInt8(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,1,this.length);return this[offset]};Buffer.prototype.readUInt16LE=function readUInt16LE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,2,this.length);return this[offset]|this[offset+1]<<8};Buffer.prototype.readUInt16BE=function readUInt16BE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,2,this.length);return this[offset]<<8|this[offset+
1]};Buffer.prototype.readUInt32LE=function readUInt32LE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,4,this.length);return(this[offset]|this[offset+1]<<8|this[offset+2]<<16)+this[offset+3]*16777216};Buffer.prototype.readUInt32BE=function readUInt32BE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,4,this.length);return this[offset]*16777216+(this[offset+1]<<16|this[offset+2]<<8|this[offset+3])};Buffer.prototype.readIntLE=function readIntLE(offset,byteLength,
noAssert){offset=offset>>>0;byteLength=byteLength>>>0;if(!noAssert)checkOffset(offset,byteLength,this.length);var val=this[offset];var mul=1;var i=0;while(++i<byteLength&&(mul*=256))val+=this[offset+i]*mul;mul*=128;if(val>=mul)val-=Math.pow(2,8*byteLength);return val};Buffer.prototype.readIntBE=function readIntBE(offset,byteLength,noAssert){offset=offset>>>0;byteLength=byteLength>>>0;if(!noAssert)checkOffset(offset,byteLength,this.length);var i=byteLength;var mul=1;var val=this[offset+--i];while(i>
0&&(mul*=256))val+=this[offset+--i]*mul;mul*=128;if(val>=mul)val-=Math.pow(2,8*byteLength);return val};Buffer.prototype.readInt8=function readInt8(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,1,this.length);if(!(this[offset]&128))return this[offset];return(255-this[offset]+1)*-1};Buffer.prototype.readInt16LE=function readInt16LE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,2,this.length);var val=this[offset]|this[offset+1]<<8;return val&32768?val|4294901760:
val};Buffer.prototype.readInt16BE=function readInt16BE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,2,this.length);var val=this[offset+1]|this[offset]<<8;return val&32768?val|4294901760:val};Buffer.prototype.readInt32LE=function readInt32LE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,4,this.length);return this[offset]|this[offset+1]<<8|this[offset+2]<<16|this[offset+3]<<24};Buffer.prototype.readInt32BE=function readInt32BE(offset,noAssert){offset=offset>>>
0;if(!noAssert)checkOffset(offset,4,this.length);return this[offset]<<24|this[offset+1]<<16|this[offset+2]<<8|this[offset+3]};Buffer.prototype.readFloatLE=function readFloatLE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,4,this.length);return ieee754.read(this,offset,true,23,4)};Buffer.prototype.readFloatBE=function readFloatBE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,4,this.length);return ieee754.read(this,offset,false,23,4)};Buffer.prototype.readDoubleLE=
function readDoubleLE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,8,this.length);return ieee754.read(this,offset,true,52,8)};Buffer.prototype.readDoubleBE=function readDoubleBE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,8,this.length);return ieee754.read(this,offset,false,52,8)};function checkInt(buf,value,offset,ext,max,min){if(!Buffer.isBuffer(buf))throw new TypeError('"buffer" argument must be a Buffer instance');if(value>max||value<min)throw new RangeError('"value" argument is out of bounds');
if(offset+ext>buf.length)throw new RangeError("Index out of range");}Buffer.prototype.writeUIntLE=function writeUIntLE(value,offset,byteLength,noAssert){value=+value;offset=offset>>>0;byteLength=byteLength>>>0;if(!noAssert){var maxBytes=Math.pow(2,8*byteLength)-1;checkInt(this,value,offset,byteLength,maxBytes,0)}var mul=1;var i=0;this[offset]=value&255;while(++i<byteLength&&(mul*=256))this[offset+i]=value/mul&255;return offset+byteLength};Buffer.prototype.writeUIntBE=function writeUIntBE(value,offset,
byteLength,noAssert){value=+value;offset=offset>>>0;byteLength=byteLength>>>0;if(!noAssert){var maxBytes=Math.pow(2,8*byteLength)-1;checkInt(this,value,offset,byteLength,maxBytes,0)}var i=byteLength-1;var mul=1;this[offset+i]=value&255;while(--i>=0&&(mul*=256))this[offset+i]=value/mul&255;return offset+byteLength};Buffer.prototype.writeUInt8=function writeUInt8(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,1,255,0);this[offset]=value&255;return offset+
1};Buffer.prototype.writeUInt16LE=function writeUInt16LE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,2,65535,0);this[offset]=value&255;this[offset+1]=value>>>8;return offset+2};Buffer.prototype.writeUInt16BE=function writeUInt16BE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,2,65535,0);this[offset]=value>>>8;this[offset+1]=value&255;return offset+2};Buffer.prototype.writeUInt32LE=function writeUInt32LE(value,
offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,4,4294967295,0);this[offset+3]=value>>>24;this[offset+2]=value>>>16;this[offset+1]=value>>>8;this[offset]=value&255;return offset+4};Buffer.prototype.writeUInt32BE=function writeUInt32BE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,4,4294967295,0);this[offset]=value>>>24;this[offset+1]=value>>>16;this[offset+2]=value>>>8;this[offset+3]=value&255;return offset+4};
Buffer.prototype.writeIntLE=function writeIntLE(value,offset,byteLength,noAssert){value=+value;offset=offset>>>0;if(!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=0;var mul=1;var sub=0;this[offset]=value&255;while(++i<byteLength&&(mul*=256)){if(value<0&&sub===0&&this[offset+i-1]!==0)sub=1;this[offset+i]=(value/mul>>0)-sub&255}return offset+byteLength};Buffer.prototype.writeIntBE=function writeIntBE(value,offset,byteLength,noAssert){value=
+value;offset=offset>>>0;if(!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=byteLength-1;var mul=1;var sub=0;this[offset+i]=value&255;while(--i>=0&&(mul*=256)){if(value<0&&sub===0&&this[offset+i+1]!==0)sub=1;this[offset+i]=(value/mul>>0)-sub&255}return offset+byteLength};Buffer.prototype.writeInt8=function writeInt8(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,1,127,-128);if(value<0)value=
255+value+1;this[offset]=value&255;return offset+1};Buffer.prototype.writeInt16LE=function writeInt16LE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,2,32767,-32768);this[offset]=value&255;this[offset+1]=value>>>8;return offset+2};Buffer.prototype.writeInt16BE=function writeInt16BE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,2,32767,-32768);this[offset]=value>>>8;this[offset+1]=value&255;return offset+
2};Buffer.prototype.writeInt32LE=function writeInt32LE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,4,2147483647,-2147483648);this[offset]=value&255;this[offset+1]=value>>>8;this[offset+2]=value>>>16;this[offset+3]=value>>>24;return offset+4};Buffer.prototype.writeInt32BE=function writeInt32BE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,4,2147483647,-2147483648);if(value<0)value=4294967295+value+1;this[offset]=
value>>>24;this[offset+1]=value>>>16;this[offset+2]=value>>>8;this[offset+3]=value&255;return offset+4};function checkIEEE754(buf,value,offset,ext,max,min){if(offset+ext>buf.length)throw new RangeError("Index out of range");if(offset<0)throw new RangeError("Index out of range");}function writeFloat(buf,value,offset,littleEndian,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkIEEE754(buf,value,offset,4,3.4028234663852886E38,-3.4028234663852886E38);ieee754.write(buf,value,offset,littleEndian,
23,4);return offset+4}Buffer.prototype.writeFloatLE=function writeFloatLE(value,offset,noAssert){return writeFloat(this,value,offset,true,noAssert)};Buffer.prototype.writeFloatBE=function writeFloatBE(value,offset,noAssert){return writeFloat(this,value,offset,false,noAssert)};function writeDouble(buf,value,offset,littleEndian,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkIEEE754(buf,value,offset,8,1.7976931348623157E308,-1.7976931348623157E308);ieee754.write(buf,value,offset,littleEndian,
52,8);return offset+8}Buffer.prototype.writeDoubleLE=function writeDoubleLE(value,offset,noAssert){return writeDouble(this,value,offset,true,noAssert)};Buffer.prototype.writeDoubleBE=function writeDoubleBE(value,offset,noAssert){return writeDouble(this,value,offset,false,noAssert)};Buffer.prototype.copy=function copy(target,targetStart,start,end){if(!Buffer.isBuffer(target))throw new TypeError("argument should be a Buffer");if(!start)start=0;if(!end&&end!==0)end=this.length;if(targetStart>=target.length)targetStart=
target.length;if(!targetStart)targetStart=0;if(end>0&&end<start)end=start;if(end===start)return 0;if(target.length===0||this.length===0)return 0;if(targetStart<0)throw new RangeError("targetStart out of bounds");if(start<0||start>=this.length)throw new RangeError("Index out of range");if(end<0)throw new RangeError("sourceEnd out of bounds");if(end>this.length)end=this.length;if(target.length-targetStart<end-start)end=target.length-targetStart+start;var len=end-start;if(this===target&&typeof Uint8Array.prototype.copyWithin===
"function")this.copyWithin(targetStart,start,end);else if(this===target&&start<targetStart&&targetStart<end)for(var i=len-1;i>=0;--i)target[i+targetStart]=this[i+start];else Uint8Array.prototype.set.call(target,this.subarray(start,end),targetStart);return len};Buffer.prototype.fill=function fill(val,start,end,encoding){if(typeof val==="string"){if(typeof start==="string"){encoding=start;start=0;end=this.length}else if(typeof end==="string"){encoding=end;end=this.length}if(encoding!==undefined&&typeof encoding!==
"string")throw new TypeError("encoding must be a string");if(typeof encoding==="string"&&!Buffer.isEncoding(encoding))throw new TypeError("Unknown encoding: "+encoding);if(val.length===1){var code=val.charCodeAt(0);if(encoding==="utf8"&&code<128||encoding==="latin1")val=code}}else if(typeof val==="number")val=val&255;if(start<0||this.length<start||this.length<end)throw new RangeError("Out of range index");if(end<=start)return this;start=start>>>0;end=end===undefined?this.length:end>>>0;if(!val)val=
0;var i;if(typeof val==="number")for(i=start;i<end;++i)this[i]=val;else{var bytes=Buffer.isBuffer(val)?val:Buffer.from(val,encoding);var len=bytes.length;if(len===0)throw new TypeError('The value "'+val+'" is invalid for argument "value"');for(i=0;i<end-start;++i)this[i+start]=bytes[i%len]}return this};var INVALID_BASE64_RE=/[^+/0-9A-Za-z-_]/g;function base64clean(str){str=str.split("=")[0];str=str.trim().replace(INVALID_BASE64_RE,"");if(str.length<2)return"";while(str.length%4!==0)str=str+"=";return str}
function toHex(n){if(n<16)return"0"+n.toString(16);return n.toString(16)}function utf8ToBytes(string,units){units=units||Infinity;var codePoint;var length=string.length;var leadSurrogate=null;var bytes=[];for(var i=0;i<length;++i){codePoint=string.charCodeAt(i);if(codePoint>55295&&codePoint<57344){if(!leadSurrogate){if(codePoint>56319){if((units-=3)>-1)bytes.push(239,191,189);continue}else if(i+1===length){if((units-=3)>-1)bytes.push(239,191,189);continue}leadSurrogate=codePoint;continue}if(codePoint<
56320){if((units-=3)>-1)bytes.push(239,191,189);leadSurrogate=codePoint;continue}codePoint=(leadSurrogate-55296<<10|codePoint-56320)+65536}else if(leadSurrogate)if((units-=3)>-1)bytes.push(239,191,189);leadSurrogate=null;if(codePoint<128){if((units-=1)<0)break;bytes.push(codePoint)}else if(codePoint<2048){if((units-=2)<0)break;bytes.push(codePoint>>6|192,codePoint&63|128)}else if(codePoint<65536){if((units-=3)<0)break;bytes.push(codePoint>>12|224,codePoint>>6&63|128,codePoint&63|128)}else if(codePoint<
1114112){if((units-=4)<0)break;bytes.push(codePoint>>18|240,codePoint>>12&63|128,codePoint>>6&63|128,codePoint&63|128)}else throw new Error("Invalid code point");}return bytes}function asciiToBytes(str){var byteArray=[];for(var i=0;i<str.length;++i)byteArray.push(str.charCodeAt(i)&255);return byteArray}function utf16leToBytes(str,units){var c,hi,lo;var byteArray=[];for(var i=0;i<str.length;++i){if((units-=2)<0)break;c=str.charCodeAt(i);hi=c>>8;lo=c%256;byteArray.push(lo);byteArray.push(hi)}return byteArray}
function base64ToBytes(str){return base64.toByteArray(base64clean(str))}function blitBuffer(src,dst,offset,length){for(var i=0;i<length;++i){if(i+offset>=dst.length||i>=src.length)break;dst[i+offset]=src[i]}return i}function isInstance(obj,type){return obj instanceof type||obj!=null&&obj.constructor!=null&&obj.constructor.name!=null&&obj.constructor.name===type.name}function numberIsNaN(obj){return obj!==obj}}).call(this)}).call(this,require("buffer").Buffer)},{"base64-js":1,"buffer":2,"ieee754":3}],
3:[function(require,module,exports){exports.read=function(buffer,offset,isLE,mLen,nBytes){var e,m;var eLen=nBytes*8-mLen-1;var eMax=(1<<eLen)-1;var eBias=eMax>>1;var nBits=-7;var i=isLE?nBytes-1:0;var d=isLE?-1:1;var s=buffer[offset+i];i+=d;e=s&(1<<-nBits)-1;s>>=-nBits;nBits+=eLen;for(;nBits>0;e=e*256+buffer[offset+i],i+=d,nBits-=8);m=e&(1<<-nBits)-1;e>>=-nBits;nBits+=mLen;for(;nBits>0;m=m*256+buffer[offset+i],i+=d,nBits-=8);if(e===0)e=1-eBias;else if(e===eMax)return m?NaN:(s?-1:1)*Infinity;else{m=
m+Math.pow(2,mLen);e=e-eBias}return(s?-1:1)*m*Math.pow(2,e-mLen)};exports.write=function(buffer,value,offset,isLE,mLen,nBytes){var e,m,c;var eLen=nBytes*8-mLen-1;var eMax=(1<<eLen)-1;var eBias=eMax>>1;var rt=mLen===23?Math.pow(2,-24)-Math.pow(2,-77):0;var i=isLE?0:nBytes-1;var d=isLE?1:-1;var s=value<0||value===0&&1/value<0?1:0;value=Math.abs(value);if(isNaN(value)||value===Infinity){m=isNaN(value)?1:0;e=eMax}else{e=Math.floor(Math.log(value)/Math.LN2);if(value*(c=Math.pow(2,-e))<1){e--;c*=2}if(e+
eBias>=1)value+=rt/c;else value+=rt*Math.pow(2,1-eBias);if(value*c>=2){e++;c/=2}if(e+eBias>=eMax){m=0;e=eMax}else if(e+eBias>=1){m=(value*c-1)*Math.pow(2,mLen);e=e+eBias}else{m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen);e=0}}for(;mLen>=8;buffer[offset+i]=m&255,i+=d,m/=256,mLen-=8);e=e<<mLen|m;eLen+=mLen;for(;eLen>0;buffer[offset+i]=e&255,i+=d,e/=256,eLen-=8);buffer[offset+i-d]|=s*128}},{}],4:[function(require,module,exports){var process=module.exports={};var cachedSetTimeout;var cachedClearTimeout;
function defaultSetTimout(){throw new Error("setTimeout has not been defined");}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined");}(function(){try{if(typeof setTimeout==="function")cachedSetTimeout=setTimeout;else cachedSetTimeout=defaultSetTimout}catch(e){cachedSetTimeout=defaultSetTimout}try{if(typeof clearTimeout==="function")cachedClearTimeout=clearTimeout;else cachedClearTimeout=defaultClearTimeout}catch(e){cachedClearTimeout=defaultClearTimeout}})();function runTimeout(fun){if(cachedSetTimeout===
setTimeout)return setTimeout(fun,0);if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout){cachedSetTimeout=setTimeout;return setTimeout(fun,0)}try{return cachedSetTimeout(fun,0)}catch(e){try{return cachedSetTimeout.call(null,fun,0)}catch(e){return cachedSetTimeout.call(this,fun,0)}}}function runClearTimeout(marker){if(cachedClearTimeout===clearTimeout)return clearTimeout(marker);if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout){cachedClearTimeout=
clearTimeout;return clearTimeout(marker)}try{return cachedClearTimeout(marker)}catch(e){try{return cachedClearTimeout.call(null,marker)}catch(e){return cachedClearTimeout.call(this,marker)}}}var queue=[];var draining=false;var currentQueue;var queueIndex=-1;function cleanUpNextTick(){if(!draining||!currentQueue)return;draining=false;if(currentQueue.length)queue=currentQueue.concat(queue);else queueIndex=-1;if(queue.length)drainQueue()}function drainQueue(){if(draining)return;var timeout=runTimeout(cleanUpNextTick);
draining=true;var len=queue.length;while(len){currentQueue=queue;queue=[];while(++queueIndex<len)if(currentQueue)currentQueue[queueIndex].run();queueIndex=-1;len=queue.length}currentQueue=null;draining=false;runClearTimeout(timeout)}process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)args[i-1]=arguments[i];queue.push(new Item(fun,args));if(queue.length===1&&!draining)runTimeout(drainQueue)};function Item(fun,array){this.fun=
fun;this.array=array}Item.prototype.run=function(){this.fun.apply(null,this.array)};process.title="browser";process.browser=true;process.env={};process.argv=[];process.version="";process.versions={};function noop(){}process.on=noop;process.addListener=noop;process.once=noop;process.off=noop;process.removeListener=noop;process.removeAllListeners=noop;process.emit=noop;process.prependListener=noop;process.prependOnceListener=noop;process.listeners=function(name){return[]};process.binding=function(name){throw new Error("process.binding is not supported");
};process.cwd=function(){return"/"};process.chdir=function(dir){throw new Error("process.chdir is not supported");};process.umask=function(){return 0}},{}],5:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.MultipartBody=void 0;class MultipartBody{constructor(body){this.body=body}get [Symbol.toStringTag](){return"MultipartBody"}}exports.MultipartBody=MultipartBody},{}],6:[function(require,module,exports){var __createBinding=this&&this.__createBinding||
(Object.create?function(o,m,k,k2){if(k2===undefined)k2=k;var desc=Object.getOwnPropertyDescriptor(m,k);if(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))desc={enumerable:true,get:function(){return m[k]}};Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){if(k2===undefined)k2=k;o[k2]=m[k]});var __exportStar=this&&this.__exportStar||function(m,exports){for(var p in m)if(p!=="default"&&!Object.prototype.hasOwnProperty.call(exports,p))__createBinding(exports,m,p)};Object.defineProperty(exports,
"__esModule",{value:true});__exportStar(require("../web-runtime.js"),exports)},{"../web-runtime.js":9}],7:[function(require,module,exports){const shims=require("./registry");const auto=require("openai/_shims/auto/runtime");exports.init=()=>{if(!shims.kind)shims.setShims(auto.getRuntime(),{auto:true})};for(const property of Object.keys(shims))Object.defineProperty(exports,property,{get(){return shims[property]}});exports.init()},{"./registry":8,"openai/_shims/auto/runtime":6}],8:[function(require,
module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.setShims=exports.isFsReadStream=exports.fileFromPath=exports.getDefaultAgent=exports.getMultipartRequestOptions=exports.ReadableStream=exports.File=exports.Blob=exports.FormData=exports.Headers=exports.Response=exports.Request=exports.fetch=exports.kind=exports.auto=void 0;exports.auto=false;exports.kind=undefined;exports.fetch=undefined;exports.Request=undefined;exports.Response=undefined;exports.Headers=undefined;exports.FormData=
undefined;exports.Blob=undefined;exports.File=undefined;exports.ReadableStream=undefined;exports.getMultipartRequestOptions=undefined;exports.getDefaultAgent=undefined;exports.fileFromPath=undefined;exports.isFsReadStream=undefined;function setShims(shims,options={auto:false}){if(exports.auto)throw new Error(`you must \`import 'openai/shims/${shims.kind}'\` before importing anything else from openai`);if(exports.kind)throw new Error(`can't \`import 'openai/shims/${shims.kind}'\` after \`import 'openai/shims/${exports.kind}'\``);
exports.auto=options.auto;exports.kind=shims.kind;exports.fetch=shims.fetch;exports.Request=shims.Request;exports.Response=shims.Response;exports.Headers=shims.Headers;exports.FormData=shims.FormData;exports.Blob=shims.Blob;exports.File=shims.File;exports.ReadableStream=shims.ReadableStream;exports.getMultipartRequestOptions=shims.getMultipartRequestOptions;exports.getDefaultAgent=shims.getDefaultAgent;exports.fileFromPath=shims.fileFromPath;exports.isFsReadStream=shims.isFsReadStream}exports.setShims=
setShims},{}],9:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.getRuntime=void 0;const MultipartBody_1=require("./MultipartBody.js");function getRuntime({manuallyImported}={}){const recommendation=manuallyImported?`You may need to use polyfills`:`Add one of these imports before your first \`import \u2026 from 'openai'\`:
- \`import 'openai/shims/node'\` (if you're running on Node)
- \`import 'openai/shims/web'\` (otherwise)
`;let _fetch,_Request,_Response,_Headers;try{_fetch=fetch;_Request=Request;_Response=Response;_Headers=Headers}catch(error){throw new Error(`this environment is missing the following Web Fetch API type: ${error.message}. ${recommendation}`);}return{kind:"web",fetch:_fetch,Request:_Request,Response:_Response,Headers:_Headers,FormData:typeof FormData!=="undefined"?FormData:class FormData{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${recommendation}`);
}},Blob:typeof Blob!=="undefined"?Blob:class Blob{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${recommendation}`);}},File:typeof File!=="undefined"?File:class File{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${recommendation}`);}},ReadableStream:typeof ReadableStream!=="undefined"?ReadableStream:class ReadableStream{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${recommendation}`);
}},getMultipartRequestOptions:async(form,opts)=>({...opts,body:new MultipartBody_1.MultipartBody(form)}),getDefaultAgent:url=>undefined,fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads");},isFsReadStream:value=>false}}exports.getRuntime=getRuntime},{"./MultipartBody.js":5}],10:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.MalformedJSON=
exports.PartialJSON=exports.partialParse=void 0;const STR=1;const NUM=2;const ARR=4;const OBJ=8;const NULL=16;const BOOL=32;const NAN=64;const INFINITY=128;const MINUS_INFINITY=256;const INF=INFINITY|MINUS_INFINITY;const SPECIAL=NULL|BOOL|INF|NAN;const ATOM=STR|NUM|SPECIAL;const COLLECTION=ARR|OBJ;const ALL=ATOM|COLLECTION;const Allow={STR,NUM,ARR,OBJ,NULL,BOOL,NAN,INFINITY,MINUS_INFINITY,INF,SPECIAL,ATOM,COLLECTION,ALL};class PartialJSON extends Error{}exports.PartialJSON=PartialJSON;class MalformedJSON extends Error{}
exports.MalformedJSON=MalformedJSON;function parseJSON(jsonString,allowPartial=Allow.ALL){if(typeof jsonString!=="string")throw new TypeError(`expecting str, got ${typeof jsonString}`);if(!jsonString.trim())throw new Error(`${jsonString} is empty`);return _parseJSON(jsonString.trim(),allowPartial)}const _parseJSON=(jsonString,allow)=>{const length=jsonString.length;let index=0;const markPartialJSON=msg=>{throw new PartialJSON(`${msg} at position ${index}`);};const throwMalformedError=msg=>{throw new MalformedJSON(`${msg} at position ${index}`);
};const parseAny=()=>{skipBlank();if(index>=length)markPartialJSON("Unexpected end of input");if(jsonString[index]==='"')return parseStr();if(jsonString[index]==="{")return parseObj();if(jsonString[index]==="[")return parseArr();if(jsonString.substring(index,index+4)==="null"||Allow.NULL&allow&&length-index<4&&"null".startsWith(jsonString.substring(index))){index+=4;return null}if(jsonString.substring(index,index+4)==="true"||Allow.BOOL&allow&&length-index<4&&"true".startsWith(jsonString.substring(index))){index+=
4;return true}if(jsonString.substring(index,index+5)==="false"||Allow.BOOL&allow&&length-index<5&&"false".startsWith(jsonString.substring(index))){index+=5;return false}if(jsonString.substring(index,index+8)==="Infinity"||Allow.INFINITY&allow&&length-index<8&&"Infinity".startsWith(jsonString.substring(index))){index+=8;return Infinity}if(jsonString.substring(index,index+9)==="-Infinity"||Allow.MINUS_INFINITY&allow&&1<length-index&&length-index<9&&"-Infinity".startsWith(jsonString.substring(index))){index+=
9;return-Infinity}if(jsonString.substring(index,index+3)==="NaN"||Allow.NAN&allow&&length-index<3&&"NaN".startsWith(jsonString.substring(index))){index+=3;return NaN}return parseNum()};const parseStr=()=>{const start=index;let escape=false;index++;while(index<length&&(jsonString[index]!=='"'||escape&&jsonString[index-1]==="\\")){escape=jsonString[index]==="\\"?!escape:false;index++}if(jsonString.charAt(index)=='"')try{return JSON.parse(jsonString.substring(start,++index-Number(escape)))}catch(e){throwMalformedError(String(e))}else if(Allow.STR&
allow)try{return JSON.parse(jsonString.substring(start,index-Number(escape))+'"')}catch(e){return JSON.parse(jsonString.substring(start,jsonString.lastIndexOf("\\"))+'"')}markPartialJSON("Unterminated string literal")};const parseObj=()=>{index++;skipBlank();const obj={};try{while(jsonString[index]!=="}"){skipBlank();if(index>=length&&Allow.OBJ&allow)return obj;const key=parseStr();skipBlank();index++;try{const value=parseAny();Object.defineProperty(obj,key,{value,writable:true,enumerable:true,configurable:true})}catch(e){if(Allow.OBJ&
allow)return obj;else throw e;}skipBlank();if(jsonString[index]===",")index++}}catch(e){if(Allow.OBJ&allow)return obj;else markPartialJSON("Expected '}' at end of object")}index++;return obj};const parseArr=()=>{index++;const arr=[];try{while(jsonString[index]!=="]"){arr.push(parseAny());skipBlank();if(jsonString[index]===",")index++}}catch(e){if(Allow.ARR&allow)return arr;markPartialJSON("Expected ']' at end of array")}index++;return arr};const parseNum=()=>{if(index===0){if(jsonString==="-"&&Allow.NUM&
allow)markPartialJSON("Not sure what '-' is");try{return JSON.parse(jsonString)}catch(e){if(Allow.NUM&allow)try{if("."===jsonString[jsonString.length-1])return JSON.parse(jsonString.substring(0,jsonString.lastIndexOf(".")));return JSON.parse(jsonString.substring(0,jsonString.lastIndexOf("e")))}catch(e){}throwMalformedError(String(e))}}const start=index;if(jsonString[index]==="-")index++;while(jsonString[index]&&!",]}".includes(jsonString[index]))index++;if(index==length&&!(Allow.NUM&allow))markPartialJSON("Unterminated number literal");
try{return JSON.parse(jsonString.substring(start,index))}catch(e){if(jsonString.substring(start,index)==="-"&&Allow.NUM&allow)markPartialJSON("Not sure what '-' is");try{return JSON.parse(jsonString.substring(start,jsonString.lastIndexOf("e")))}catch(e){throwMalformedError(String(e))}}};const skipBlank=()=>{while(index<length&&" \n\r\t".includes(jsonString[index]))index++};return parseAny()};const partialParse=input=>parseJSON(input,Allow.ALL^Allow.NUM);exports.partialParse=partialParse},{}],11:[function(require,
module,exports){(function(process,Buffer){(function(){var __classPrivateFieldSet=this&&this.__classPrivateFieldSet||function(receiver,state,value,kind,f){if(kind==="m")throw new TypeError("Private method is not writable");if(kind==="a"&&!f)throw new TypeError("Private accessor was defined without a setter");if(typeof state==="function"?receiver!==state||!f:!state.has(receiver))throw new TypeError("Cannot write private member to an object whose class did not declare it");return kind==="a"?f.call(receiver,
value):f?f.value=value:state.set(receiver,value),value};var __classPrivateFieldGet=this&&this.__classPrivateFieldGet||function(receiver,state,kind,f){if(kind==="a"&&!f)throw new TypeError("Private accessor was defined without a getter");if(typeof state==="function"?receiver!==state||!f:!state.has(receiver))throw new TypeError("Cannot read private member from an object whose class did not declare it");return kind==="m"?f:kind==="a"?f.call(receiver):f?f.value:state.get(receiver)};var _AbstractPage_client;
Object.defineProperty(exports,"__esModule",{value:true});exports.isObj=exports.toFloat32Array=exports.toBase64=exports.getHeader=exports.getRequiredHeader=exports.isHeadersProtocol=exports.isRunningInBrowser=exports.debug=exports.hasOwn=exports.isEmptyObj=exports.maybeCoerceBoolean=exports.maybeCoerceFloat=exports.maybeCoerceInteger=exports.coerceBoolean=exports.coerceFloat=exports.coerceInteger=exports.readEnv=exports.ensurePresent=exports.castToError=exports.sleep=exports.safeJSON=exports.isRequestOptions=
exports.createResponseHeaders=exports.PagePromise=exports.AbstractPage=exports.APIClient=exports.APIPromise=exports.createForm=exports.multipartFormRequestOptions=exports.maybeMultipartFormRequestOptions=void 0;const version_1=require("./version.js");const streaming_1=require("./streaming.js");const error_1=require("./error.js");const index_1=require("./_shims/index.js");(0,index_1.init)();const uploads_1=require("./uploads.js");var uploads_2=require("./uploads.js");Object.defineProperty(exports,
"maybeMultipartFormRequestOptions",{enumerable:true,get:function(){return uploads_2.maybeMultipartFormRequestOptions}});Object.defineProperty(exports,"multipartFormRequestOptions",{enumerable:true,get:function(){return uploads_2.multipartFormRequestOptions}});Object.defineProperty(exports,"createForm",{enumerable:true,get:function(){return uploads_2.createForm}});async function defaultParseResponse(props){const {response}=props;if(props.options.stream){debug("response",response.status,response.url,
response.headers,response.body);if(props.options.__streamClass)return props.options.__streamClass.fromSSEResponse(response,props.controller);return streaming_1.Stream.fromSSEResponse(response,props.controller)}if(response.status===204)return null;if(props.options.__binaryResponse)return response;const contentType=response.headers.get("content-type");const mediaType=contentType?.split(";")[0]?.trim();const isJSON=mediaType?.includes("application/json")||mediaType?.endsWith("+json");if(isJSON){const json=
await response.json();debug("response",response.status,response.url,response.headers,json);return _addRequestID(json,response)}const text=await response.text();debug("response",response.status,response.url,response.headers,text);return text}function _addRequestID(value,response){if(!value||typeof value!=="object"||Array.isArray(value))return value;return Object.defineProperty(value,"_request_id",{value:response.headers.get("x-request-id"),enumerable:false})}class APIPromise extends Promise{constructor(responsePromise,
parseResponse=defaultParseResponse){super(resolve=>{resolve(null)});this.responsePromise=responsePromise;this.parseResponse=parseResponse}_thenUnwrap(transform){return new APIPromise(this.responsePromise,async props=>_addRequestID(transform(await this.parseResponse(props),props),props.response))}asResponse(){return this.responsePromise.then(p=>p.response)}async withResponse(){const [data,response]=await Promise.all([this.parse(),this.asResponse()]);return{data,response,request_id:response.headers.get("x-request-id")}}parse(){if(!this.parsedPromise)this.parsedPromise=
this.responsePromise.then(this.parseResponse);return this.parsedPromise}then(onfulfilled,onrejected){return this.parse().then(onfulfilled,onrejected)}catch(onrejected){return this.parse().catch(onrejected)}finally(onfinally){return this.parse().finally(onfinally)}}exports.APIPromise=APIPromise;class APIClient{constructor({baseURL,maxRetries=2,timeout=6E5,httpAgent,fetch:overriddenFetch}){this.baseURL=baseURL;this.maxRetries=validatePositiveInteger("maxRetries",maxRetries);this.timeout=validatePositiveInteger("timeout",
timeout);this.httpAgent=httpAgent;this.fetch=overriddenFetch??index_1.fetch}authHeaders(opts){return{}}defaultHeaders(opts){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...getPlatformHeaders(),...this.authHeaders(opts)}}validateHeaders(headers,customHeaders){}defaultIdempotencyKey(){return`stainless-node-retry-${uuid4()}`}get(path,opts){return this.methodRequest("get",path,opts)}post(path,opts){return this.methodRequest("post",path,opts)}patch(path,
opts){return this.methodRequest("patch",path,opts)}put(path,opts){return this.methodRequest("put",path,opts)}delete(path,opts){return this.methodRequest("delete",path,opts)}methodRequest(method,path,opts){return this.request(Promise.resolve(opts).then(async opts=>{const body=opts&&(0,uploads_1.isBlobLike)(opts?.body)?new DataView(await opts.body.arrayBuffer()):opts?.body instanceof DataView?opts.body:opts?.body instanceof ArrayBuffer?new DataView(opts.body):opts&&ArrayBuffer.isView(opts?.body)?new DataView(opts.body.buffer):
opts?.body;return{method,path,...opts,body}}))}getAPIList(path,Page,opts){return this.requestAPIList(Page,{method:"get",path,...opts})}calculateContentLength(body){if(typeof body==="string"){if(typeof Buffer!=="undefined")return Buffer.byteLength(body,"utf8").toString();if(typeof TextEncoder!=="undefined"){const encoder=new TextEncoder;const encoded=encoder.encode(body);return encoded.length.toString()}}else if(ArrayBuffer.isView(body))return body.byteLength.toString();return null}buildRequest(inputOptions,
{retryCount=0}={}){const options={...inputOptions};const {method,path,query,headers:headers={}}=options;const body=ArrayBuffer.isView(options.body)||options.__binaryRequest&&typeof options.body==="string"?options.body:(0,uploads_1.isMultipartBody)(options.body)?options.body.body:options.body?JSON.stringify(options.body,null,2):null;const contentLength=this.calculateContentLength(body);const url=this.buildURL(path,query);if("timeout"in options)validatePositiveInteger("timeout",options.timeout);options.timeout=
options.timeout??this.timeout;const httpAgent=options.httpAgent??this.httpAgent??(0,index_1.getDefaultAgent)(url);const minAgentTimeout=options.timeout+1E3;if(typeof httpAgent?.options?.timeout==="number"&&minAgentTimeout>(httpAgent.options.timeout??0))httpAgent.options.timeout=minAgentTimeout;if(this.idempotencyHeader&&method!=="get"){if(!inputOptions.idempotencyKey)inputOptions.idempotencyKey=this.defaultIdempotencyKey();headers[this.idempotencyHeader]=inputOptions.idempotencyKey}const reqHeaders=
this.buildHeaders({options,headers,contentLength,retryCount});const req={method,...(body&&{body:body}),headers:reqHeaders,...(httpAgent&&{agent:httpAgent}),signal:options.signal??null};return{req,url,timeout:options.timeout}}buildHeaders({options,headers,contentLength,retryCount}){const reqHeaders={};if(contentLength)reqHeaders["content-length"]=contentLength;const defaultHeaders=this.defaultHeaders(options);applyHeadersMut(reqHeaders,defaultHeaders);applyHeadersMut(reqHeaders,headers);if((0,uploads_1.isMultipartBody)(options.body)&&
index_1.kind!=="node")delete reqHeaders["content-type"];if((0,exports.getHeader)(defaultHeaders,"x-stainless-retry-count")===undefined&&(0,exports.getHeader)(headers,"x-stainless-retry-count")===undefined)reqHeaders["x-stainless-retry-count"]=String(retryCount);if((0,exports.getHeader)(defaultHeaders,"x-stainless-timeout")===undefined&&(0,exports.getHeader)(headers,"x-stainless-timeout")===undefined&&options.timeout)reqHeaders["x-stainless-timeout"]=String(Math.trunc(options.timeout/1E3));this.validateHeaders(reqHeaders,
headers);return reqHeaders}async prepareOptions(options){}async prepareRequest(request,{url,options}){}parseHeaders(headers){return!headers?{}:Symbol.iterator in headers?Object.fromEntries(Array.from(headers).map(header=>[...header])):{...headers}}makeStatusError(status,error,message,headers){return error_1.APIError.generate(status,error,message,headers)}request(options,remainingRetries=null){return new APIPromise(this.makeRequest(options,remainingRetries))}async makeRequest(optionsInput,retriesRemaining){const options=
await optionsInput;const maxRetries=options.maxRetries??this.maxRetries;if(retriesRemaining==null)retriesRemaining=maxRetries;await this.prepareOptions(options);const {req,url,timeout}=this.buildRequest(options,{retryCount:maxRetries-retriesRemaining});await this.prepareRequest(req,{url,options});debug("request",url,options,req.headers);if(options.signal?.aborted)throw new error_1.APIUserAbortError;const controller=new AbortController;const response=await this.fetchWithTimeout(url,req,timeout,controller).catch(exports.castToError);
if(response instanceof Error){if(options.signal?.aborted)throw new error_1.APIUserAbortError;if(retriesRemaining)return this.retryRequest(options,retriesRemaining);if(response.name==="AbortError")throw new error_1.APIConnectionTimeoutError;throw new error_1.APIConnectionError({cause:response});}const responseHeaders=(0,exports.createResponseHeaders)(response.headers);if(!response.ok){if(retriesRemaining&&this.shouldRetry(response)){const retryMessage=`retrying, ${retriesRemaining} attempts remaining`;
debug(`response (error; ${retryMessage})`,response.status,url,responseHeaders);return this.retryRequest(options,retriesRemaining,responseHeaders)}const errText=await response.text().catch(e=>(0,exports.castToError)(e).message);const errJSON=(0,exports.safeJSON)(errText);const errMessage=errJSON?undefined:errText;const retryMessage=retriesRemaining?`(error; no more retries left)`:`(error; not retryable)`;debug(`response (error; ${retryMessage})`,response.status,url,responseHeaders,errMessage);const err=
this.makeStatusError(response.status,errJSON,errMessage,responseHeaders);throw err;}return{response,options,controller}}requestAPIList(Page,options){const request=this.makeRequest(options,null);return new PagePromise(this,request,Page)}buildURL(path,query){const url=isAbsoluteURL(path)?new URL(path):new URL(this.baseURL+(this.baseURL.endsWith("/")&&path.startsWith("/")?path.slice(1):path));const defaultQuery=this.defaultQuery();if(!isEmptyObj(defaultQuery))query={...defaultQuery,...query};if(typeof query===
"object"&&query&&!Array.isArray(query))url.search=this.stringifyQuery(query);return url.toString()}stringifyQuery(query){return Object.entries(query).filter(([_,value])=>typeof value!=="undefined").map(([key,value])=>{if(typeof value==="string"||typeof value==="number"||typeof value==="boolean")return`${encodeURIComponent(key)}=${encodeURIComponent(value)}`;if(value===null)return`${encodeURIComponent(key)}=`;throw new error_1.OpenAIError(`Cannot stringify type ${typeof value}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`);
}).join("&")}async fetchWithTimeout(url,init,ms,controller){const {signal,...options}=init||{};if(signal)signal.addEventListener("abort",()=>controller.abort());const timeout=setTimeout(()=>controller.abort(),ms);const fetchOptions={signal:controller.signal,...options};if(fetchOptions.method)fetchOptions.method=fetchOptions.method.toUpperCase();return this.fetch.call(undefined,url,fetchOptions).finally(()=>{clearTimeout(timeout)})}shouldRetry(response){const shouldRetryHeader=response.headers.get("x-should-retry");
if(shouldRetryHeader==="true")return true;if(shouldRetryHeader==="false")return false;if(response.status===408)return true;if(response.status===409)return true;if(response.status===429)return true;if(response.status>=500)return true;return false}async retryRequest(options,retriesRemaining,responseHeaders){let timeoutMillis;const retryAfterMillisHeader=responseHeaders?.["retry-after-ms"];if(retryAfterMillisHeader){const timeoutMs=parseFloat(retryAfterMillisHeader);if(!Number.isNaN(timeoutMs))timeoutMillis=
timeoutMs}const retryAfterHeader=responseHeaders?.["retry-after"];if(retryAfterHeader&&!timeoutMillis){const timeoutSeconds=parseFloat(retryAfterHeader);if(!Number.isNaN(timeoutSeconds))timeoutMillis=timeoutSeconds*1E3;else timeoutMillis=Date.parse(retryAfterHeader)-Date.now()}if(!(timeoutMillis&&0<=timeoutMillis&&timeoutMillis<60*1E3)){const maxRetries=options.maxRetries??this.maxRetries;timeoutMillis=this.calculateDefaultRetryTimeoutMillis(retriesRemaining,maxRetries)}await (0,exports.sleep)(timeoutMillis);
return this.makeRequest(options,retriesRemaining-1)}calculateDefaultRetryTimeoutMillis(retriesRemaining,maxRetries){const initialRetryDelay=.5;const maxRetryDelay=8;const numRetries=maxRetries-retriesRemaining;const sleepSeconds=Math.min(initialRetryDelay*Math.pow(2,numRetries),maxRetryDelay);const jitter=1-Math.random()*.25;return sleepSeconds*jitter*1E3}getUserAgent(){return`${this.constructor.name}/JS ${version_1.VERSION}`}}exports.APIClient=APIClient;class AbstractPage{constructor(client,response,
body,options){_AbstractPage_client.set(this,void 0);__classPrivateFieldSet(this,_AbstractPage_client,client,"f");this.options=options;this.response=response;this.body=body}hasNextPage(){const items=this.getPaginatedItems();if(!items.length)return false;return this.nextPageInfo()!=null}async getNextPage(){const nextInfo=this.nextPageInfo();if(!nextInfo)throw new error_1.OpenAIError("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");const nextOptions={...this.options};
if("params"in nextInfo&&typeof nextOptions.query==="object")nextOptions.query={...nextOptions.query,...nextInfo.params};else if("url"in nextInfo){const params=[...Object.entries(nextOptions.query||{}),...nextInfo.url.searchParams.entries()];for(const [key,value]of params)nextInfo.url.searchParams.set(key,value);nextOptions.query=undefined;nextOptions.path=nextInfo.url.toString()}return await __classPrivateFieldGet(this,_AbstractPage_client,"f").requestAPIList(this.constructor,nextOptions)}async *iterPages(){let page=
this;yield page;while(page.hasNextPage()){page=await page.getNextPage();yield page}}async*[(_AbstractPage_client=new WeakMap,Symbol.asyncIterator)](){for await(const page of this.iterPages())for(const item of page.getPaginatedItems())yield item}}exports.AbstractPage=AbstractPage;class PagePromise extends APIPromise{constructor(client,request,Page){super(request,async props=>new Page(client,props.response,await defaultParseResponse(props),props.options))}async*[Symbol.asyncIterator](){const page=await this;
for await(const item of page)yield item}}exports.PagePromise=PagePromise;const createResponseHeaders=headers=>{return new Proxy(Object.fromEntries(headers.entries()),{get(target,name){const key=name.toString();return target[key.toLowerCase()]||target[key]}})};exports.createResponseHeaders=createResponseHeaders;const requestOptionsKeys={method:true,path:true,query:true,body:true,headers:true,maxRetries:true,stream:true,timeout:true,httpAgent:true,signal:true,idempotencyKey:true,__metadata:true,__binaryRequest:true,
__binaryResponse:true,__streamClass:true};const isRequestOptions=obj=>{return typeof obj==="object"&&obj!==null&&!isEmptyObj(obj)&&Object.keys(obj).every(k=>hasOwn(requestOptionsKeys,k))};exports.isRequestOptions=isRequestOptions;const getPlatformProperties=()=>{if(typeof Deno!=="undefined"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":version_1.VERSION,"X-Stainless-OS":normalizePlatform(Deno.build.os),"X-Stainless-Arch":normalizeArch(Deno.build.arch),"X-Stainless-Runtime":"deno",
"X-Stainless-Runtime-Version":typeof Deno.version==="string"?Deno.version:Deno.version?.deno??"unknown"};if(typeof EdgeRuntime!=="undefined")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":version_1.VERSION,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process!=="undefined"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":version_1.VERSION,
"X-Stainless-OS":normalizePlatform(process.platform),"X-Stainless-Arch":normalizeArch(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const browserInfo=getBrowserInfo();if(browserInfo)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":version_1.VERSION,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${browserInfo.browser}`,"X-Stainless-Runtime-Version":browserInfo.version};return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":version_1.VERSION,
"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function getBrowserInfo(){if(typeof navigator==="undefined"||!navigator)return null;const browserPatterns=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},
{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const {key,pattern}of browserPatterns){const match=pattern.exec(navigator.userAgent);if(match){const major=match[1]||0;const minor=match[2]||0;const patch=match[3]||0;return{browser:key,version:`${major}.${minor}.${patch}`}}}return null}const normalizeArch=arch=>{if(arch==="x32")return"x32";if(arch==="x86_64"||arch==="x64")return"x64";if(arch==="arm")return"arm";if(arch==="aarch64"||arch==="arm64")return"arm64";
if(arch)return`other:${arch}`;return"unknown"};const normalizePlatform=platform=>{platform=platform.toLowerCase();if(platform.includes("ios"))return"iOS";if(platform==="android")return"Android";if(platform==="darwin")return"MacOS";if(platform==="win32")return"Windows";if(platform==="freebsd")return"FreeBSD";if(platform==="openbsd")return"OpenBSD";if(platform==="linux")return"Linux";if(platform)return`Other:${platform}`;return"Unknown"};let _platformHeaders;const getPlatformHeaders=()=>{return _platformHeaders??
(_platformHeaders=getPlatformProperties())};const safeJSON=text=>{try{return JSON.parse(text)}catch(err){return undefined}};exports.safeJSON=safeJSON;const startsWithSchemeRegexp=/^[a-z][a-z0-9+.-]*:/i;const isAbsoluteURL=url=>{return startsWithSchemeRegexp.test(url)};const sleep=ms=>new Promise(resolve=>setTimeout(resolve,ms));exports.sleep=sleep;const validatePositiveInteger=(name,n)=>{if(typeof n!=="number"||!Number.isInteger(n))throw new error_1.OpenAIError(`${name} must be an integer`);if(n<
0)throw new error_1.OpenAIError(`${name} must be a positive integer`);return n};const castToError=err=>{if(err instanceof Error)return err;if(typeof err==="object"&&err!==null)try{return new Error(JSON.stringify(err))}catch{}return new Error(err)};exports.castToError=castToError;const ensurePresent=value=>{if(value==null)throw new error_1.OpenAIError(`Expected a value to be given but received ${value} instead.`);return value};exports.ensurePresent=ensurePresent;const readEnv=env=>{if(typeof process!==
"undefined")return process.env?.[env]?.trim()??undefined;if(typeof Deno!=="undefined")return Deno.env?.get?.(env)?.trim();return undefined};exports.readEnv=readEnv;const coerceInteger=value=>{if(typeof value==="number")return Math.round(value);if(typeof value==="string")return parseInt(value,10);throw new error_1.OpenAIError(`Could not coerce ${value} (type: ${typeof value}) into a number`);};exports.coerceInteger=coerceInteger;const coerceFloat=value=>{if(typeof value==="number")return value;if(typeof value===
"string")return parseFloat(value);throw new error_1.OpenAIError(`Could not coerce ${value} (type: ${typeof value}) into a number`);};exports.coerceFloat=coerceFloat;const coerceBoolean=value=>{if(typeof value==="boolean")return value;if(typeof value==="string")return value==="true";return Boolean(value)};exports.coerceBoolean=coerceBoolean;const maybeCoerceInteger=value=>{if(value===undefined)return undefined;return(0,exports.coerceInteger)(value)};exports.maybeCoerceInteger=maybeCoerceInteger;const maybeCoerceFloat=
value=>{if(value===undefined)return undefined;return(0,exports.coerceFloat)(value)};exports.maybeCoerceFloat=maybeCoerceFloat;const maybeCoerceBoolean=value=>{if(value===undefined)return undefined;return(0,exports.coerceBoolean)(value)};exports.maybeCoerceBoolean=maybeCoerceBoolean;function isEmptyObj(obj){if(!obj)return true;for(const _k in obj)return false;return true}exports.isEmptyObj=isEmptyObj;function hasOwn(obj,key){return Object.prototype.hasOwnProperty.call(obj,key)}exports.hasOwn=hasOwn;
function applyHeadersMut(targetHeaders,newHeaders){for(const k in newHeaders){if(!hasOwn(newHeaders,k))continue;const lowerKey=k.toLowerCase();if(!lowerKey)continue;const val=newHeaders[k];if(val===null)delete targetHeaders[lowerKey];else if(val!==undefined)targetHeaders[lowerKey]=val}}const SENSITIVE_HEADERS=new Set(["authorization","api-key"]);function debug(action,...args){if(typeof process!=="undefined"&&process?.env?.["DEBUG"]==="true"){const modifiedArgs=args.map(arg=>{if(!arg)return arg;if(arg["headers"]){const modifiedArg=
{...arg,headers:{...arg["headers"]}};for(const header in arg["headers"])if(SENSITIVE_HEADERS.has(header.toLowerCase()))modifiedArg["headers"][header]="REDACTED";return modifiedArg}let modifiedArg=null;for(const header in arg)if(SENSITIVE_HEADERS.has(header.toLowerCase())){modifiedArg??(modifiedArg={...arg});modifiedArg[header]="REDACTED"}return modifiedArg??arg});console.log(`OpenAI:DEBUG:${action}`,...modifiedArgs)}}exports.debug=debug;const uuid4=()=>{return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,
c=>{const r=Math.random()*16|0;const v=c==="x"?r:r&3|8;return v.toString(16)})};const isRunningInBrowser=()=>{return typeof window!=="undefined"&&typeof window.document!=="undefined"&&typeof navigator!=="undefined"};exports.isRunningInBrowser=isRunningInBrowser;const isHeadersProtocol=headers=>{return typeof headers?.get==="function"};exports.isHeadersProtocol=isHeadersProtocol;const getRequiredHeader=(headers,header)=>{const foundHeader=(0,exports.getHeader)(headers,header);if(foundHeader===undefined)throw new Error(`Could not find ${header} header`);
return foundHeader};exports.getRequiredHeader=getRequiredHeader;const getHeader=(headers,header)=>{const lowerCasedHeader=header.toLowerCase();if((0,exports.isHeadersProtocol)(headers)){const intercapsHeader=header[0]?.toUpperCase()+header.substring(1).replace(/([^\w])(\w)/g,(_m,g1,g2)=>g1+g2.toUpperCase());for(const key of[header,lowerCasedHeader,header.toUpperCase(),intercapsHeader]){const value=headers.get(key);if(value)return value}}for(const [key,value]of Object.entries(headers))if(key.toLowerCase()===
lowerCasedHeader){if(Array.isArray(value)){if(value.length<=1)return value[0];console.warn(`Received ${value.length} entries for the ${header} header, using the first entry.`);return value[0]}return value}return undefined};exports.getHeader=getHeader;const toBase64=str=>{if(!str)return"";if(typeof Buffer!=="undefined")return Buffer.from(str).toString("base64");if(typeof btoa!=="undefined")return btoa(str);throw new error_1.OpenAIError("Cannot generate b64 string; Expected `Buffer` or `btoa` to be defined");
};exports.toBase64=toBase64;const toFloat32Array=base64Str=>{if(typeof Buffer!=="undefined"){const buf=Buffer.from(base64Str,"base64");return Array.from(new Float32Array(buf.buffer,buf.byteOffset,buf.length/Float32Array.BYTES_PER_ELEMENT))}else{const binaryStr=atob(base64Str);const len=binaryStr.length;const bytes=new Uint8Array(len);for(let i=0;i<len;i++)bytes[i]=binaryStr.charCodeAt(i);return Array.from(new Float32Array(bytes.buffer))}};exports.toFloat32Array=toFloat32Array;function isObj(obj){return obj!=
null&&typeof obj==="object"&&!Array.isArray(obj)}exports.isObj=isObj}).call(this)}).call(this,require("_process"),require("buffer").Buffer)},{"./_shims/index.js":7,"./error.js":12,"./streaming.js":78,"./uploads.js":79,"./version.js":80,"_process":4,"buffer":2}],12:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.ContentFilterFinishReasonError=exports.LengthFinishReasonError=exports.InternalServerError=exports.RateLimitError=exports.UnprocessableEntityError=
exports.ConflictError=exports.NotFoundError=exports.PermissionDeniedError=exports.AuthenticationError=exports.BadRequestError=exports.APIConnectionTimeoutError=exports.APIConnectionError=exports.APIUserAbortError=exports.APIError=exports.OpenAIError=void 0;const core_1=require("./core.js");class OpenAIError extends Error{}exports.OpenAIError=OpenAIError;class APIError extends OpenAIError{constructor(status,error,message,headers){super(`${APIError.makeMessage(status,error,message)}`);this.status=status;
this.headers=headers;this.request_id=headers?.["x-request-id"];this.error=error;const data=error;this.code=data?.["code"];this.param=data?.["param"];this.type=data?.["type"]}static makeMessage(status,error,message){const msg=error?.message?typeof error.message==="string"?error.message:JSON.stringify(error.message):error?JSON.stringify(error):message;if(status&&msg)return`${status} ${msg}`;if(status)return`${status} status code (no body)`;if(msg)return msg;return"(no status code or body)"}static generate(status,
errorResponse,message,headers){if(!status||!headers)return new APIConnectionError({message,cause:(0,core_1.castToError)(errorResponse)});const error=errorResponse?.["error"];if(status===400)return new BadRequestError(status,error,message,headers);if(status===401)return new AuthenticationError(status,error,message,headers);if(status===403)return new PermissionDeniedError(status,error,message,headers);if(status===404)return new NotFoundError(status,error,message,headers);if(status===409)return new ConflictError(status,
error,message,headers);if(status===422)return new UnprocessableEntityError(status,error,message,headers);if(status===429)return new RateLimitError(status,error,message,headers);if(status>=500)return new InternalServerError(status,error,message,headers);return new APIError(status,error,message,headers)}}exports.APIError=APIError;class APIUserAbortError extends APIError{constructor({message}={}){super(undefined,undefined,message||"Request was aborted.",undefined)}}exports.APIUserAbortError=APIUserAbortError;
class APIConnectionError extends APIError{constructor({message,cause}){super(undefined,undefined,message||"Connection error.",undefined);if(cause)this.cause=cause}}exports.APIConnectionError=APIConnectionError;class APIConnectionTimeoutError extends APIConnectionError{constructor({message}={}){super({message:message??"Request timed out."})}}exports.APIConnectionTimeoutError=APIConnectionTimeoutError;class BadRequestError extends APIError{}exports.BadRequestError=BadRequestError;class AuthenticationError extends APIError{}
exports.AuthenticationError=AuthenticationError;class PermissionDeniedError extends APIError{}exports.PermissionDeniedError=PermissionDeniedError;class NotFoundError extends APIError{}exports.NotFoundError=NotFoundError;class ConflictError extends APIError{}exports.ConflictError=ConflictError;class UnprocessableEntityError extends APIError{}exports.UnprocessableEntityError=UnprocessableEntityError;class RateLimitError extends APIError{}exports.RateLimitError=RateLimitError;class InternalServerError extends APIError{}
exports.InternalServerError=InternalServerError;class LengthFinishReasonError extends OpenAIError{constructor(){super(`Could not parse response content as the length limit was reached`)}}exports.LengthFinishReasonError=LengthFinishReasonError;class ContentFilterFinishReasonError extends OpenAIError{constructor(){super(`Could not parse response content as the request was rejected by the content filter`)}}exports.ContentFilterFinishReasonError=ContentFilterFinishReasonError},{"./core.js":11}],13:[function(require,
module,exports){(function(process){(function(){var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){if(k2===undefined)k2=k;var desc=Object.getOwnPropertyDescriptor(m,k);if(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))desc={enumerable:true,get:function(){return m[k]}};Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){if(k2===undefined)k2=k;o[k2]=m[k]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,
"default",{enumerable:true,value:v})}:function(o,v){o["default"]=v});var __importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(mod!=null)for(var k in mod)if(k!=="default"&&Object.prototype.hasOwnProperty.call(mod,k))__createBinding(result,mod,k);__setModuleDefault(result,mod);return result};var _a;Object.defineProperty(exports,"__esModule",{value:true});exports.UnprocessableEntityError=exports.PermissionDeniedError=exports.InternalServerError=exports.AuthenticationError=
exports.BadRequestError=exports.RateLimitError=exports.ConflictError=exports.NotFoundError=exports.APIUserAbortError=exports.APIConnectionTimeoutError=exports.APIConnectionError=exports.APIError=exports.OpenAIError=exports.fileFromPath=exports.toFile=exports.AzureOpenAI=exports.OpenAI=void 0;const qs=__importStar(require("./internal/qs/index.js"));const Core=__importStar(require("./core.js"));const Errors=__importStar(require("./error.js"));const Pagination=__importStar(require("./pagination.js"));
const Uploads=__importStar(require("./uploads.js"));const API=__importStar(require("./resources/index.js"));const batches_1=require("./resources/batches.js");const completions_1=require("./resources/completions.js");const embeddings_1=require("./resources/embeddings.js");const files_1=require("./resources/files.js");const images_1=require("./resources/images.js");const models_1=require("./resources/models.js");const moderations_1=require("./resources/moderations.js");const audio_1=require("./resources/audio/audio.js");
const beta_1=require("./resources/beta/beta.js");const chat_1=require("./resources/chat/chat.js");const evals_1=require("./resources/evals/evals.js");const fine_tuning_1=require("./resources/fine-tuning/fine-tuning.js");const responses_1=require("./resources/responses/responses.js");const uploads_1=require("./resources/uploads/uploads.js");const vector_stores_1=require("./resources/vector-stores/vector-stores.js");const completions_2=require("./resources/chat/completions/completions.js");class OpenAI extends Core.APIClient{constructor({baseURL=
Core.readEnv("OPENAI_BASE_URL"),apiKey=Core.readEnv("OPENAI_API_KEY"),organization=Core.readEnv("OPENAI_ORG_ID")??null,project=Core.readEnv("OPENAI_PROJECT_ID")??null,...opts}={}){if(apiKey===undefined)throw new Errors.OpenAIError("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");const options={apiKey,organization,project,...opts,baseURL:baseURL||`https://api.openai.com/v1`};
if(!options.dangerouslyAllowBrowser&&Core.isRunningInBrowser())throw new Errors.OpenAIError("It looks like you're running in a browser-like environment.\n\nThis is disabled by default, as it risks exposing your secret API credentials to attackers.\nIf you understand the risks and have appropriate mitigations in place,\nyou can set the `dangerouslyAllowBrowser` option to `true`, e.g.,\n\nnew OpenAI({ apiKey, dangerouslyAllowBrowser: true });\n\nhttps://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety\n");
super({baseURL:options.baseURL,timeout:options.timeout??6E5,httpAgent:options.httpAgent,maxRetries:options.maxRetries,fetch:options.fetch});this.completions=new API.Completions(this);this.chat=new API.Chat(this);this.embeddings=new API.Embeddings(this);this.files=new API.Files(this);this.images=new API.Images(this);this.audio=new API.Audio(this);this.moderations=new API.Moderations(this);this.models=new API.Models(this);this.fineTuning=new API.FineTuning(this);this.vectorStores=new API.VectorStores(this);
this.beta=new API.Beta(this);this.batches=new API.Batches(this);this.uploads=new API.Uploads(this);this.responses=new API.Responses(this);this.evals=new API.Evals(this);this._options=options;this.apiKey=apiKey;this.organization=organization;this.project=project}defaultQuery(){return this._options.defaultQuery}defaultHeaders(opts){return{...super.defaultHeaders(opts),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project,...this._options.defaultHeaders}}authHeaders(opts){return{Authorization:`Bearer ${this.apiKey}`}}stringifyQuery(query){return qs.stringify(query,
{arrayFormat:"brackets"})}}exports.OpenAI=OpenAI;_a=OpenAI;OpenAI.OpenAI=_a;OpenAI.DEFAULT_TIMEOUT=6E5;OpenAI.OpenAIError=Errors.OpenAIError;OpenAI.APIError=Errors.APIError;OpenAI.APIConnectionError=Errors.APIConnectionError;OpenAI.APIConnectionTimeoutError=Errors.APIConnectionTimeoutError;OpenAI.APIUserAbortError=Errors.APIUserAbortError;OpenAI.NotFoundError=Errors.NotFoundError;OpenAI.ConflictError=Errors.ConflictError;OpenAI.RateLimitError=Errors.RateLimitError;OpenAI.BadRequestError=Errors.BadRequestError;
OpenAI.AuthenticationError=Errors.AuthenticationError;OpenAI.InternalServerError=Errors.InternalServerError;OpenAI.PermissionDeniedError=Errors.PermissionDeniedError;OpenAI.UnprocessableEntityError=Errors.UnprocessableEntityError;OpenAI.toFile=Uploads.toFile;OpenAI.fileFromPath=Uploads.fileFromPath;OpenAI.Completions=completions_1.Completions;OpenAI.Chat=chat_1.Chat;OpenAI.ChatCompletionsPage=completions_2.ChatCompletionsPage;OpenAI.Embeddings=embeddings_1.Embeddings;OpenAI.Files=files_1.Files;OpenAI.FileObjectsPage=
files_1.FileObjectsPage;OpenAI.Images=images_1.Images;OpenAI.Audio=audio_1.Audio;OpenAI.Moderations=moderations_1.Moderations;OpenAI.Models=models_1.Models;OpenAI.ModelsPage=models_1.ModelsPage;OpenAI.FineTuning=fine_tuning_1.FineTuning;OpenAI.VectorStores=vector_stores_1.VectorStores;OpenAI.VectorStoresPage=vector_stores_1.VectorStoresPage;OpenAI.VectorStoreSearchResponsesPage=vector_stores_1.VectorStoreSearchResponsesPage;OpenAI.Beta=beta_1.Beta;OpenAI.Batches=batches_1.Batches;OpenAI.BatchesPage=
batches_1.BatchesPage;OpenAI.Uploads=uploads_1.Uploads;OpenAI.Responses=responses_1.Responses;OpenAI.Evals=evals_1.Evals;OpenAI.EvalListResponsesPage=evals_1.EvalListResponsesPage;class AzureOpenAI extends OpenAI{constructor({baseURL=Core.readEnv("OPENAI_BASE_URL"),apiKey=Core.readEnv("AZURE_OPENAI_API_KEY"),apiVersion=Core.readEnv("OPENAI_API_VERSION"),endpoint,deployment,azureADTokenProvider,dangerouslyAllowBrowser,...opts}={}){if(!apiVersion)throw new Errors.OpenAIError("The OPENAI_API_VERSION environment variable is missing or empty; either provide it, or instantiate the AzureOpenAI client with an apiVersion option, like new AzureOpenAI({ apiVersion: 'My API Version' }).");
if(typeof azureADTokenProvider==="function")dangerouslyAllowBrowser=true;if(!azureADTokenProvider&&!apiKey)throw new Errors.OpenAIError("Missing credentials. Please pass one of `apiKey` and `azureADTokenProvider`, or set the `AZURE_OPENAI_API_KEY` environment variable.");if(azureADTokenProvider&&apiKey)throw new Errors.OpenAIError("The `apiKey` and `azureADTokenProvider` arguments are mutually exclusive; only one can be passed at a time.");apiKey??(apiKey=API_KEY_SENTINEL);opts.defaultQuery={...opts.defaultQuery,
"api-version":apiVersion};if(!baseURL){if(!endpoint)endpoint=process.env["AZURE_OPENAI_ENDPOINT"];if(!endpoint)throw new Errors.OpenAIError("Must provide one of the `baseURL` or `endpoint` arguments, or the `AZURE_OPENAI_ENDPOINT` environment variable");baseURL=`${endpoint}/openai`}else if(endpoint)throw new Errors.OpenAIError("baseURL and endpoint are mutually exclusive");super({apiKey,baseURL,...opts,...(dangerouslyAllowBrowser!==undefined?{dangerouslyAllowBrowser}:{})});this.apiVersion="";this._azureADTokenProvider=
azureADTokenProvider;this.apiVersion=apiVersion;this.deploymentName=deployment}buildRequest(options,props={}){if(_deployments_endpoints.has(options.path)&&options.method==="post"&&options.body!==undefined){if(!Core.isObj(options.body))throw new Error("Expected request body to be an object");const model=this.deploymentName||options.body["model"]||options.__metadata?.["model"];if(model!==undefined&&!this.baseURL.includes("/deployments"))options.path=`/deployments/${model}${options.path}`}return super.buildRequest(options,
props)}async _getAzureADToken(){if(typeof this._azureADTokenProvider==="function"){const token=await this._azureADTokenProvider();if(!token||typeof token!=="string")throw new Errors.OpenAIError(`Expected 'azureADTokenProvider' argument to return a string but it returned ${token}`);return token}return undefined}authHeaders(opts){return{}}async prepareOptions(opts){if(opts.headers?.["api-key"])return super.prepareOptions(opts);const token=await this._getAzureADToken();opts.headers??(opts.headers={});
if(token)opts.headers["Authorization"]=`Bearer ${token}`;else if(this.apiKey!==API_KEY_SENTINEL)opts.headers["api-key"]=this.apiKey;else throw new Errors.OpenAIError("Unable to handle auth");return super.prepareOptions(opts)}}exports.AzureOpenAI=AzureOpenAI;const _deployments_endpoints=new Set(["/completions","/chat/completions","/embeddings","/audio/transcriptions","/audio/translations","/audio/speech","/images/generations"]);const API_KEY_SENTINEL="<Missing Key>";var uploads_2=require("./uploads.js");
Object.defineProperty(exports,"toFile",{enumerable:true,get:function(){return uploads_2.toFile}});Object.defineProperty(exports,"fileFromPath",{enumerable:true,get:function(){return uploads_2.fileFromPath}});var error_1=require("./error.js");Object.defineProperty(exports,"OpenAIError",{enumerable:true,get:function(){return error_1.OpenAIError}});Object.defineProperty(exports,"APIError",{enumerable:true,get:function(){return error_1.APIError}});Object.defineProperty(exports,"APIConnectionError",{enumerable:true,
get:function(){return error_1.APIConnectionError}});Object.defineProperty(exports,"APIConnectionTimeoutError",{enumerable:true,get:function(){return error_1.APIConnectionTimeoutError}});Object.defineProperty(exports,"APIUserAbortError",{enumerable:true,get:function(){return error_1.APIUserAbortError}});Object.defineProperty(exports,"NotFoundError",{enumerable:true,get:function(){return error_1.NotFoundError}});Object.defineProperty(exports,"ConflictError",{enumerable:true,get:function(){return error_1.ConflictError}});
Object.defineProperty(exports,"RateLimitError",{enumerable:true,get:function(){return error_1.RateLimitError}});Object.defineProperty(exports,"BadRequestError",{enumerable:true,get:function(){return error_1.BadRequestError}});Object.defineProperty(exports,"AuthenticationError",{enumerable:true,get:function(){return error_1.AuthenticationError}});Object.defineProperty(exports,"InternalServerError",{enumerable:true,get:function(){return error_1.InternalServerError}});Object.defineProperty(exports,"PermissionDeniedError",
{enumerable:true,get:function(){return error_1.PermissionDeniedError}});Object.defineProperty(exports,"UnprocessableEntityError",{enumerable:true,get:function(){return error_1.UnprocessableEntityError}});exports=module.exports=OpenAI;module.exports.AzureOpenAI=AzureOpenAI;exports.default=OpenAI}).call(this)}).call(this,require("_process"))},{"./core.js":11,"./error.js":12,"./internal/qs/index.js":16,"./pagination.js":32,"./resources/audio/audio.js":34,"./resources/batches.js":38,"./resources/beta/beta.js":40,
"./resources/chat/chat.js":50,"./resources/chat/completions/completions.js":51,"./resources/completions.js":55,"./resources/embeddings.js":56,"./resources/evals/evals.js":57,"./resources/files.js":60,"./resources/fine-tuning/fine-tuning.js":63,"./resources/images.js":66,"./resources/index.js":67,"./resources/models.js":68,"./resources/moderations.js":69,"./resources/responses/responses.js":71,"./resources/uploads/uploads.js":74,"./resources/vector-stores/vector-stores.js":77,"./uploads.js":79,"_process":4}],
14:[function(require,module,exports){(function(Buffer){(function(){var __classPrivateFieldSet=this&&this.__classPrivateFieldSet||function(receiver,state,value,kind,f){if(kind==="m")throw new TypeError("Private method is not writable");if(kind==="a"&&!f)throw new TypeError("Private accessor was defined without a setter");if(typeof state==="function"?receiver!==state||!f:!state.has(receiver))throw new TypeError("Cannot write private member to an object whose class did not declare it");return kind===
"a"?f.call(receiver,value):f?f.value=value:state.set(receiver,value),value};var __classPrivateFieldGet=this&&this.__classPrivateFieldGet||function(receiver,state,kind,f){if(kind==="a"&&!f)throw new TypeError("Private accessor was defined without a getter");if(typeof state==="function"?receiver!==state||!f:!state.has(receiver))throw new TypeError("Cannot read private member from an object whose class did not declare it");return kind==="m"?f:kind==="a"?f.call(receiver):f?f.value:state.get(receiver)};
var _LineDecoder_carriageReturnIndex;Object.defineProperty(exports,"__esModule",{value:true});exports.findDoubleNewlineIndex=exports.LineDecoder=void 0;const error_1=require("../../error.js");class LineDecoder{constructor(){_LineDecoder_carriageReturnIndex.set(this,void 0);this.buffer=new Uint8Array;__classPrivateFieldSet(this,_LineDecoder_carriageReturnIndex,null,"f")}decode(chunk){if(chunk==null)return[];const binaryChunk=chunk instanceof ArrayBuffer?new Uint8Array(chunk):typeof chunk==="string"?
(new TextEncoder).encode(chunk):chunk;let newData=new Uint8Array(this.buffer.length+binaryChunk.length);newData.set(this.buffer);newData.set(binaryChunk,this.buffer.length);this.buffer=newData;const lines=[];let patternIndex;while((patternIndex=findNewlineIndex(this.buffer,__classPrivateFieldGet(this,_LineDecoder_carriageReturnIndex,"f")))!=null){if(patternIndex.carriage&&__classPrivateFieldGet(this,_LineDecoder_carriageReturnIndex,"f")==null){__classPrivateFieldSet(this,_LineDecoder_carriageReturnIndex,
patternIndex.index,"f");continue}if(__classPrivateFieldGet(this,_LineDecoder_carriageReturnIndex,"f")!=null&&(patternIndex.index!==__classPrivateFieldGet(this,_LineDecoder_carriageReturnIndex,"f")+1||patternIndex.carriage)){lines.push(this.decodeText(this.buffer.slice(0,__classPrivateFieldGet(this,_LineDecoder_carriageReturnIndex,"f")-1)));this.buffer=this.buffer.slice(__classPrivateFieldGet(this,_LineDecoder_carriageReturnIndex,"f"));__classPrivateFieldSet(this,_LineDecoder_carriageReturnIndex,null,
"f");continue}const endIndex=__classPrivateFieldGet(this,_LineDecoder_carriageReturnIndex,"f")!==null?patternIndex.preceding-1:patternIndex.preceding;const line=this.decodeText(this.buffer.slice(0,endIndex));lines.push(line);this.buffer=this.buffer.slice(patternIndex.index);__classPrivateFieldSet(this,_LineDecoder_carriageReturnIndex,null,"f")}return lines}decodeText(bytes){if(bytes==null)return"";if(typeof bytes==="string")return bytes;if(typeof Buffer!=="undefined"){if(bytes instanceof Buffer)return bytes.toString();
if(bytes instanceof Uint8Array)return Buffer.from(bytes).toString();throw new error_1.OpenAIError(`Unexpected: received non-Uint8Array (${bytes.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`);}if(typeof TextDecoder!=="undefined"){if(bytes instanceof Uint8Array||bytes instanceof ArrayBuffer){this.textDecoder??(this.textDecoder=new TextDecoder("utf8"));return this.textDecoder.decode(bytes)}throw new error_1.OpenAIError(`Unexpected: received non-Uint8Array/ArrayBuffer (${bytes.constructor.name}) in a web platform. Please report this error.`);
}throw new error_1.OpenAIError(`Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.`);}flush(){if(!this.buffer.length)return[];return this.decode("\n")}}exports.LineDecoder=LineDecoder;_LineDecoder_carriageReturnIndex=new WeakMap;LineDecoder.NEWLINE_CHARS=new Set(["\n","\r"]);LineDecoder.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function findNewlineIndex(buffer,startIndex){const newline=10;const carriage=13;for(let i=startIndex??0;i<buffer.length;i++){if(buffer[i]===
newline)return{preceding:i,index:i+1,carriage:false};if(buffer[i]===carriage)return{preceding:i,index:i+1,carriage:true}}return null}function findDoubleNewlineIndex(buffer){const newline=10;const carriage=13;for(let i=0;i<buffer.length-1;i++){if(buffer[i]===newline&&buffer[i+1]===newline)return i+2;if(buffer[i]===carriage&&buffer[i+1]===carriage)return i+2;if(buffer[i]===carriage&&buffer[i+1]===newline&&i+3<buffer.length&&buffer[i+2]===carriage&&buffer[i+3]===newline)return i+4}return-1}exports.findDoubleNewlineIndex=
findDoubleNewlineIndex}).call(this)}).call(this,require("buffer").Buffer)},{"../../error.js":12,"buffer":2}],15:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.RFC3986=exports.RFC1738=exports.formatters=exports.default_format=void 0;exports.default_format="RFC3986";exports.formatters={RFC1738:v=>String(v).replace(/%20/g,"+"),RFC3986:v=>String(v)};exports.RFC1738="RFC1738";exports.RFC3986="RFC3986"},{}],16:[function(require,module,exports){Object.defineProperty(exports,
"__esModule",{value:true});exports.formats=exports.stringify=void 0;const formats_1=require("./formats.js");const formats={formatters:formats_1.formatters,RFC1738:formats_1.RFC1738,RFC3986:formats_1.RFC3986,default:formats_1.default_format};exports.formats=formats;var stringify_1=require("./stringify.js");Object.defineProperty(exports,"stringify",{enumerable:true,get:function(){return stringify_1.stringify}})},{"./formats.js":15,"./stringify.js":17}],17:[function(require,module,exports){Object.defineProperty(exports,
"__esModule",{value:true});exports.stringify=void 0;const utils_1=require("./utils.js");const formats_1=require("./formats.js");const has=Object.prototype.hasOwnProperty;const array_prefix_generators={brackets(prefix){return String(prefix)+"[]"},comma:"comma",indices(prefix,key){return String(prefix)+"["+key+"]"},repeat(prefix){return String(prefix)}};const is_array=Array.isArray;const push=Array.prototype.push;const push_to_array=function(arr,value_or_array){push.apply(arr,is_array(value_or_array)?
value_or_array:[value_or_array])};const to_ISO=Date.prototype.toISOString;const defaults={addQueryPrefix:false,allowDots:false,allowEmptyArrays:false,arrayFormat:"indices",charset:"utf-8",charsetSentinel:false,delimiter:"&",encode:true,encodeDotInKeys:false,encoder:utils_1.encode,encodeValuesOnly:false,format:formats_1.default_format,formatter:formats_1.formatters[formats_1.default_format],indices:false,serializeDate(date){return to_ISO.call(date)},skipNulls:false,strictNullHandling:false};function is_non_nullish_primitive(v){return typeof v===
"string"||typeof v==="number"||typeof v==="boolean"||typeof v==="symbol"||typeof v==="bigint"}const sentinel={};function inner_stringify(object,prefix,generateArrayPrefix,commaRoundTrip,allowEmptyArrays,strictNullHandling,skipNulls,encodeDotInKeys,encoder,filter,sort,allowDots,serializeDate,format,formatter,encodeValuesOnly,charset,sideChannel){let obj=object;let tmp_sc=sideChannel;let step=0;let find_flag=false;while((tmp_sc=tmp_sc.get(sentinel))!==void undefined&&!find_flag){const pos=tmp_sc.get(object);
step+=1;if(typeof pos!=="undefined")if(pos===step)throw new RangeError("Cyclic object value");else find_flag=true;if(typeof tmp_sc.get(sentinel)==="undefined")step=0}if(typeof filter==="function")obj=filter(prefix,obj);else if(obj instanceof Date)obj=serializeDate?.(obj);else if(generateArrayPrefix==="comma"&&is_array(obj))obj=(0,utils_1.maybe_map)(obj,function(value){if(value instanceof Date)return serializeDate?.(value);return value});if(obj===null){if(strictNullHandling)return encoder&&!encodeValuesOnly?
encoder(prefix,defaults.encoder,charset,"key",format):prefix;obj=""}if(is_non_nullish_primitive(obj)||(0,utils_1.is_buffer)(obj)){if(encoder){const key_value=encodeValuesOnly?prefix:encoder(prefix,defaults.encoder,charset,"key",format);return[formatter?.(key_value)+"="+formatter?.(encoder(obj,defaults.encoder,charset,"value",format))]}return[formatter?.(prefix)+"="+formatter?.(String(obj))]}const values=[];if(typeof obj==="undefined")return values;let obj_keys;if(generateArrayPrefix==="comma"&&is_array(obj)){if(encodeValuesOnly&&
encoder)obj=(0,utils_1.maybe_map)(obj,encoder);obj_keys=[{value:obj.length>0?obj.join(",")||null:void undefined}]}else if(is_array(filter))obj_keys=filter;else{const keys=Object.keys(obj);obj_keys=sort?keys.sort(sort):keys}const encoded_prefix=encodeDotInKeys?String(prefix).replace(/\./g,"%2E"):String(prefix);const adjusted_prefix=commaRoundTrip&&is_array(obj)&&obj.length===1?encoded_prefix+"[]":encoded_prefix;if(allowEmptyArrays&&is_array(obj)&&obj.length===0)return adjusted_prefix+"[]";for(let j=
0;j<obj_keys.length;++j){const key=obj_keys[j];const value=typeof key==="object"&&typeof key.value!=="undefined"?key.value:obj[key];if(skipNulls&&value===null)continue;const encoded_key=allowDots&&encodeDotInKeys?key.replace(/\./g,"%2E"):key;const key_prefix=is_array(obj)?typeof generateArrayPrefix==="function"?generateArrayPrefix(adjusted_prefix,encoded_key):adjusted_prefix:adjusted_prefix+(allowDots?"."+encoded_key:"["+encoded_key+"]");sideChannel.set(object,step);const valueSideChannel=new WeakMap;
valueSideChannel.set(sentinel,sideChannel);push_to_array(values,inner_stringify(value,key_prefix,generateArrayPrefix,commaRoundTrip,allowEmptyArrays,strictNullHandling,skipNulls,encodeDotInKeys,generateArrayPrefix==="comma"&&encodeValuesOnly&&is_array(obj)?null:encoder,filter,sort,allowDots,serializeDate,format,formatter,encodeValuesOnly,charset,valueSideChannel))}return values}function normalize_stringify_options(opts=defaults){if(typeof opts.allowEmptyArrays!=="undefined"&&typeof opts.allowEmptyArrays!==
"boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof opts.encodeDotInKeys!=="undefined"&&typeof opts.encodeDotInKeys!=="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(opts.encoder!==null&&typeof opts.encoder!=="undefined"&&typeof opts.encoder!=="function")throw new TypeError("Encoder has to be a function.");const charset=opts.charset||defaults.charset;if(typeof opts.charset!=="undefined"&&
opts.charset!=="utf-8"&&opts.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let format=formats_1.default_format;if(typeof opts.format!=="undefined"){if(!has.call(formats_1.formatters,opts.format))throw new TypeError("Unknown format option provided.");format=opts.format}const formatter=formats_1.formatters[format];let filter=defaults.filter;if(typeof opts.filter==="function"||is_array(opts.filter))filter=opts.filter;let arrayFormat;if(opts.arrayFormat&&
opts.arrayFormat in array_prefix_generators)arrayFormat=opts.arrayFormat;else if("indices"in opts)arrayFormat=opts.indices?"indices":"repeat";else arrayFormat=defaults.arrayFormat;if("commaRoundTrip"in opts&&typeof opts.commaRoundTrip!=="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");const allowDots=typeof opts.allowDots==="undefined"?!!opts.encodeDotInKeys===true?true:defaults.allowDots:!!opts.allowDots;return{addQueryPrefix:typeof opts.addQueryPrefix==="boolean"?opts.addQueryPrefix:
defaults.addQueryPrefix,allowDots:allowDots,allowEmptyArrays:typeof opts.allowEmptyArrays==="boolean"?!!opts.allowEmptyArrays:defaults.allowEmptyArrays,arrayFormat:arrayFormat,charset:charset,charsetSentinel:typeof opts.charsetSentinel==="boolean"?opts.charsetSentinel:defaults.charsetSentinel,commaRoundTrip:!!opts.commaRoundTrip,delimiter:typeof opts.delimiter==="undefined"?defaults.delimiter:opts.delimiter,encode:typeof opts.encode==="boolean"?opts.encode:defaults.encode,encodeDotInKeys:typeof opts.encodeDotInKeys===
"boolean"?opts.encodeDotInKeys:defaults.encodeDotInKeys,encoder:typeof opts.encoder==="function"?opts.encoder:defaults.encoder,encodeValuesOnly:typeof opts.encodeValuesOnly==="boolean"?opts.encodeValuesOnly:defaults.encodeValuesOnly,filter:filter,format:format,formatter:formatter,serializeDate:typeof opts.serializeDate==="function"?opts.serializeDate:defaults.serializeDate,skipNulls:typeof opts.skipNulls==="boolean"?opts.skipNulls:defaults.skipNulls,sort:typeof opts.sort==="function"?opts.sort:null,
strictNullHandling:typeof opts.strictNullHandling==="boolean"?opts.strictNullHandling:defaults.strictNullHandling}}function stringify(object,opts={}){let obj=object;const options=normalize_stringify_options(opts);let obj_keys;let filter;if(typeof options.filter==="function"){filter=options.filter;obj=filter("",obj)}else if(is_array(options.filter)){filter=options.filter;obj_keys=filter}const keys=[];if(typeof obj!=="object"||obj===null)return"";const generateArrayPrefix=array_prefix_generators[options.arrayFormat];
const commaRoundTrip=generateArrayPrefix==="comma"&&options.commaRoundTrip;if(!obj_keys)obj_keys=Object.keys(obj);if(options.sort)obj_keys.sort(options.sort);const sideChannel=new WeakMap;for(let i=0;i<obj_keys.length;++i){const key=obj_keys[i];if(options.skipNulls&&obj[key]===null)continue;push_to_array(keys,inner_stringify(obj[key],key,generateArrayPrefix,commaRoundTrip,options.allowEmptyArrays,options.strictNullHandling,options.skipNulls,options.encodeDotInKeys,options.encode?options.encoder:null,
options.filter,options.sort,options.allowDots,options.serializeDate,options.format,options.formatter,options.encodeValuesOnly,options.charset,sideChannel))}const joined=keys.join(options.delimiter);let prefix=options.addQueryPrefix===true?"?":"";if(options.charsetSentinel)if(options.charset==="iso-8859-1")prefix+="utf8=%26%2310003%3B&";else prefix+="utf8=%E2%9C%93&";return joined.length>0?prefix+joined:""}exports.stringify=stringify},{"./formats.js":15,"./utils.js":18}],18:[function(require,module,
exports){Object.defineProperty(exports,"__esModule",{value:true});exports.maybe_map=exports.combine=exports.is_buffer=exports.is_regexp=exports.compact=exports.encode=exports.decode=exports.assign_single_source=exports.merge=void 0;const formats_1=require("./formats.js");const has=Object.prototype.hasOwnProperty;const is_array=Array.isArray;const hex_table=(()=>{const array=[];for(let i=0;i<256;++i)array.push("%"+((i<16?"0":"")+i.toString(16)).toUpperCase());return array})();function compact_queue(queue){while(queue.length>
1){const item=queue.pop();if(!item)continue;const obj=item.obj[item.prop];if(is_array(obj)){const compacted=[];for(let j=0;j<obj.length;++j)if(typeof obj[j]!=="undefined")compacted.push(obj[j]);item.obj[item.prop]=compacted}}}function array_to_object(source,options){const obj=options&&options.plainObjects?Object.create(null):{};for(let i=0;i<source.length;++i)if(typeof source[i]!=="undefined")obj[i]=source[i];return obj}function merge(target,source,options={}){if(!source)return target;if(typeof source!==
"object"){if(is_array(target))target.push(source);else if(target&&typeof target==="object"){if(options&&(options.plainObjects||options.allowPrototypes)||!has.call(Object.prototype,source))target[source]=true}else return[target,source];return target}if(!target||typeof target!=="object")return[target].concat(source);let mergeTarget=target;if(is_array(target)&&!is_array(source))mergeTarget=array_to_object(target,options);if(is_array(target)&&is_array(source)){source.forEach(function(item,i){if(has.call(target,
i)){const targetItem=target[i];if(targetItem&&typeof targetItem==="object"&&item&&typeof item==="object")target[i]=merge(targetItem,item,options);else target.push(item)}else target[i]=item});return target}return Object.keys(source).reduce(function(acc,key){const value=source[key];if(has.call(acc,key))acc[key]=merge(acc[key],value,options);else acc[key]=value;return acc},mergeTarget)}exports.merge=merge;function assign_single_source(target,source){return Object.keys(source).reduce(function(acc,key){acc[key]=
source[key];return acc},target)}exports.assign_single_source=assign_single_source;function decode(str,_,charset){const strWithoutPlus=str.replace(/\+/g," ");if(charset==="iso-8859-1")return strWithoutPlus.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(strWithoutPlus)}catch(e){return strWithoutPlus}}exports.decode=decode;const limit=1024;const encode=(str,_defaultEncoder,charset,_kind,format)=>{if(str.length===0)return str;let string=str;if(typeof str==="symbol")string=Symbol.prototype.toString.call(str);
else if(typeof str!=="string")string=String(str);if(charset==="iso-8859-1")return escape(string).replace(/%u[0-9a-f]{4}/gi,function($0){return"%26%23"+parseInt($0.slice(2),16)+"%3B"});let out="";for(let j=0;j<string.length;j+=limit){const segment=string.length>=limit?string.slice(j,j+limit):string;const arr=[];for(let i=0;i<segment.length;++i){let c=segment.charCodeAt(i);if(c===45||c===46||c===95||c===126||c>=48&&c<=57||c>=65&&c<=90||c>=97&&c<=122||format===formats_1.RFC1738&&(c===40||c===41)){arr[arr.length]=
segment.charAt(i);continue}if(c<128){arr[arr.length]=hex_table[c];continue}if(c<2048){arr[arr.length]=hex_table[192|c>>6]+hex_table[128|c&63];continue}if(c<55296||c>=57344){arr[arr.length]=hex_table[224|c>>12]+hex_table[128|c>>6&63]+hex_table[128|c&63];continue}i+=1;c=65536+((c&1023)<<10|segment.charCodeAt(i)&1023);arr[arr.length]=hex_table[240|c>>18]+hex_table[128|c>>12&63]+hex_table[128|c>>6&63]+hex_table[128|c&63]}out+=arr.join("")}return out};exports.encode=encode;function compact(value){const queue=
[{obj:{o:value},prop:"o"}];const refs=[];for(let i=0;i<queue.length;++i){const item=queue[i];const obj=item.obj[item.prop];const keys=Object.keys(obj);for(let j=0;j<keys.length;++j){const key=keys[j];const val=obj[key];if(typeof val==="object"&&val!==null&&refs.indexOf(val)===-1){queue.push({obj:obj,prop:key});refs.push(val)}}}compact_queue(queue);return value}exports.compact=compact;function is_regexp(obj){return Object.prototype.toString.call(obj)==="[object RegExp]"}exports.is_regexp=is_regexp;
function is_buffer(obj){if(!obj||typeof obj!=="object")return false;return!!(obj.constructor&&obj.constructor.isBuffer&&obj.constructor.isBuffer(obj))}exports.is_buffer=is_buffer;function combine(a,b){return[].concat(a,b)}exports.combine=combine;function maybe_map(val,fn){if(is_array(val)){const mapped=[];for(let i=0;i<val.length;i+=1)mapped.push(fn(val[i]));return mapped}return fn(val)}exports.maybe_map=maybe_map},{"./formats.js":15}],19:[function(require,module,exports){Object.defineProperty(exports,
"__esModule",{value:true});exports.ReadableStreamToAsyncIterable=void 0;function ReadableStreamToAsyncIterable(stream){if(stream[Symbol.asyncIterator])return stream;const reader=stream.getReader();return{async next(){try{const result=await reader.read();if(result?.done)reader.releaseLock();return result}catch(e){reader.releaseLock();throw e;}},async return(){const cancelPromise=reader.cancel();reader.releaseLock();await cancelPromise;return{done:true,value:undefined}},[Symbol.asyncIterator](){return this}}}
exports.ReadableStreamToAsyncIterable=ReadableStreamToAsyncIterable},{}],20:[function(require,module,exports){var __classPrivateFieldGet=this&&this.__classPrivateFieldGet||function(receiver,state,kind,f){if(kind==="a"&&!f)throw new TypeError("Private accessor was defined without a getter");if(typeof state==="function"?receiver!==state||!f:!state.has(receiver))throw new TypeError("Cannot read private member from an object whose class did not declare it");return kind==="m"?f:kind==="a"?f.call(receiver):
f?f.value:state.get(receiver)};var _AbstractChatCompletionRunner_instances,_AbstractChatCompletionRunner_getFinalContent,_AbstractChatCompletionRunner_getFinalMessage,_AbstractChatCompletionRunner_getFinalFunctionCall,_AbstractChatCompletionRunner_getFinalFunctionCallResult,_AbstractChatCompletionRunner_calculateTotalUsage,_AbstractChatCompletionRunner_validateParams,_AbstractChatCompletionRunner_stringifyFunctionCallResult;Object.defineProperty(exports,"__esModule",{value:true});exports.AbstractChatCompletionRunner=
void 0;const error_1=require("../error.js");const RunnableFunction_1=require("./RunnableFunction.js");const chatCompletionUtils_1=require("./chatCompletionUtils.js");const EventStream_1=require("./EventStream.js");const parser_1=require("../lib/parser.js");const DEFAULT_MAX_CHAT_COMPLETIONS=10;class AbstractChatCompletionRunner extends EventStream_1.EventStream{constructor(){super(...arguments);_AbstractChatCompletionRunner_instances.add(this);this._chatCompletions=[];this.messages=[]}_addChatCompletion(chatCompletion){this._chatCompletions.push(chatCompletion);
this._emit("chatCompletion",chatCompletion);const message=chatCompletion.choices[0]?.message;if(message)this._addMessage(message);return chatCompletion}_addMessage(message,emit=true){if(!("content"in message))message.content=null;this.messages.push(message);if(emit){this._emit("message",message);if(((0,chatCompletionUtils_1.isFunctionMessage)(message)||(0,chatCompletionUtils_1.isToolMessage)(message))&&message.content)this._emit("functionCallResult",message.content);else if((0,chatCompletionUtils_1.isAssistantMessage)(message)&&
message.function_call)this._emit("functionCall",message.function_call);else if((0,chatCompletionUtils_1.isAssistantMessage)(message)&&message.tool_calls)for(const tool_call of message.tool_calls)if(tool_call.type==="function")this._emit("functionCall",tool_call.function)}}async finalChatCompletion(){await this.done();const completion=this._chatCompletions[this._chatCompletions.length-1];if(!completion)throw new error_1.OpenAIError("stream ended without producing a ChatCompletion");return completion}async finalContent(){await this.done();
return __classPrivateFieldGet(this,_AbstractChatCompletionRunner_instances,"m",_AbstractChatCompletionRunner_getFinalContent).call(this)}async finalMessage(){await this.done();return __classPrivateFieldGet(this,_AbstractChatCompletionRunner_instances,"m",_AbstractChatCompletionRunner_getFinalMessage).call(this)}async finalFunctionCall(){await this.done();return __classPrivateFieldGet(this,_AbstractChatCompletionRunner_instances,"m",_AbstractChatCompletionRunner_getFinalFunctionCall).call(this)}async finalFunctionCallResult(){await this.done();
return __classPrivateFieldGet(this,_AbstractChatCompletionRunner_instances,"m",_AbstractChatCompletionRunner_getFinalFunctionCallResult).call(this)}async totalUsage(){await this.done();return __classPrivateFieldGet(this,_AbstractChatCompletionRunner_instances,"m",_AbstractChatCompletionRunner_calculateTotalUsage).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){const completion=this._chatCompletions[this._chatCompletions.length-1];if(completion)this._emit("finalChatCompletion",
completion);const finalMessage=__classPrivateFieldGet(this,_AbstractChatCompletionRunner_instances,"m",_AbstractChatCompletionRunner_getFinalMessage).call(this);if(finalMessage)this._emit("finalMessage",finalMessage);const finalContent=__classPrivateFieldGet(this,_AbstractChatCompletionRunner_instances,"m",_AbstractChatCompletionRunner_getFinalContent).call(this);if(finalContent)this._emit("finalContent",finalContent);const finalFunctionCall=__classPrivateFieldGet(this,_AbstractChatCompletionRunner_instances,
"m",_AbstractChatCompletionRunner_getFinalFunctionCall).call(this);if(finalFunctionCall)this._emit("finalFunctionCall",finalFunctionCall);const finalFunctionCallResult=__classPrivateFieldGet(this,_AbstractChatCompletionRunner_instances,"m",_AbstractChatCompletionRunner_getFinalFunctionCallResult).call(this);if(finalFunctionCallResult!=null)this._emit("finalFunctionCallResult",finalFunctionCallResult);if(this._chatCompletions.some(c=>c.usage))this._emit("totalUsage",__classPrivateFieldGet(this,_AbstractChatCompletionRunner_instances,
"m",_AbstractChatCompletionRunner_calculateTotalUsage).call(this))}async _createChatCompletion(client,params,options){const signal=options?.signal;if(signal){if(signal.aborted)this.controller.abort();signal.addEventListener("abort",()=>this.controller.abort())}__classPrivateFieldGet(this,_AbstractChatCompletionRunner_instances,"m",_AbstractChatCompletionRunner_validateParams).call(this,params);const chatCompletion=await client.chat.completions.create({...params,stream:false},{...options,signal:this.controller.signal});
this._connected();return this._addChatCompletion((0,parser_1.parseChatCompletion)(chatCompletion,params))}async _runChatCompletion(client,params,options){for(const message of params.messages)this._addMessage(message,false);return await this._createChatCompletion(client,params,options)}async _runFunctions(client,params,options){const role="function";const {function_call="auto",stream,...restParams}=params;const singleFunctionToCall=typeof function_call!=="string"&&function_call?.name;const {maxChatCompletions=
DEFAULT_MAX_CHAT_COMPLETIONS}=options||{};const functionsByName={};for(const f of params.functions)functionsByName[f.name||f.function.name]=f;const functions=params.functions.map(f=>({name:f.name||f.function.name,parameters:f.parameters,description:f.description}));for(const message of params.messages)this._addMessage(message,false);for(let i=0;i<maxChatCompletions;++i){const chatCompletion=await this._createChatCompletion(client,{...restParams,function_call,functions,messages:[...this.messages]},
options);const message=chatCompletion.choices[0]?.message;if(!message)throw new error_1.OpenAIError(`missing message in ChatCompletion response`);if(!message.function_call)return;const {name,arguments:args}=message.function_call;const fn=functionsByName[name];if(!fn){const content=`Invalid function_call: ${JSON.stringify(name)}. Available options are: ${functions.map(f=>JSON.stringify(f.name)).join(", ")}. Please try again`;this._addMessage({role,name,content});continue}else if(singleFunctionToCall&&
singleFunctionToCall!==name){const content=`Invalid function_call: ${JSON.stringify(name)}. ${JSON.stringify(singleFunctionToCall)} requested. Please try again`;this._addMessage({role,name,content});continue}let parsed;try{parsed=(0,RunnableFunction_1.isRunnableFunctionWithParse)(fn)?await fn.parse(args):args}catch(error){this._addMessage({role,name,content:error instanceof Error?error.message:String(error)});continue}const rawContent=await fn.function(parsed,this);const content=__classPrivateFieldGet(this,
_AbstractChatCompletionRunner_instances,"m",_AbstractChatCompletionRunner_stringifyFunctionCallResult).call(this,rawContent);this._addMessage({role,name,content});if(singleFunctionToCall)return}}async _runTools(client,params,options){const role="tool";const {tool_choice="auto",stream,...restParams}=params;const singleFunctionToCall=typeof tool_choice!=="string"&&tool_choice?.function?.name;const {maxChatCompletions=DEFAULT_MAX_CHAT_COMPLETIONS}=options||{};const inputTools=params.tools.map(tool=>
{if((0,parser_1.isAutoParsableTool)(tool)){if(!tool.$callback)throw new error_1.OpenAIError("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:tool.$callback,name:tool.function.name,description:tool.function.description||"",parameters:tool.function.parameters,parse:tool.$parseRaw,strict:true}}}return tool});const functionsByName={};for(const f of inputTools)if(f.type==="function")functionsByName[f.function.name||f.function.function.name]=
f.function;const tools="tools"in params?inputTools.map(t=>t.type==="function"?{type:"function",function:{name:t.function.name||t.function.function.name,parameters:t.function.parameters,description:t.function.description,strict:t.function.strict}}:t):undefined;for(const message of params.messages)this._addMessage(message,false);for(let i=0;i<maxChatCompletions;++i){const chatCompletion=await this._createChatCompletion(client,{...restParams,tool_choice,tools,messages:[...this.messages]},options);const message=
chatCompletion.choices[0]?.message;if(!message)throw new error_1.OpenAIError(`missing message in ChatCompletion response`);if(!message.tool_calls?.length)return;for(const tool_call of message.tool_calls){if(tool_call.type!=="function")continue;const tool_call_id=tool_call.id;const {name,arguments:args}=tool_call.function;const fn=functionsByName[name];if(!fn){const content=`Invalid tool_call: ${JSON.stringify(name)}. Available options are: ${Object.keys(functionsByName).map(name=>JSON.stringify(name)).join(", ")}. Please try again`;
this._addMessage({role,tool_call_id,content});continue}else if(singleFunctionToCall&&singleFunctionToCall!==name){const content=`Invalid tool_call: ${JSON.stringify(name)}. ${JSON.stringify(singleFunctionToCall)} requested. Please try again`;this._addMessage({role,tool_call_id,content});continue}let parsed;try{parsed=(0,RunnableFunction_1.isRunnableFunctionWithParse)(fn)?await fn.parse(args):args}catch(error){const content=error instanceof Error?error.message:String(error);this._addMessage({role,
tool_call_id,content});continue}const rawContent=await fn.function(parsed,this);const content=__classPrivateFieldGet(this,_AbstractChatCompletionRunner_instances,"m",_AbstractChatCompletionRunner_stringifyFunctionCallResult).call(this,rawContent);this._addMessage({role,tool_call_id,content});if(singleFunctionToCall)return}}return}}exports.AbstractChatCompletionRunner=AbstractChatCompletionRunner;_AbstractChatCompletionRunner_instances=new WeakSet,_AbstractChatCompletionRunner_getFinalContent=function _AbstractChatCompletionRunner_getFinalContent(){return __classPrivateFieldGet(this,
_AbstractChatCompletionRunner_instances,"m",_AbstractChatCompletionRunner_getFinalMessage).call(this).content??null},_AbstractChatCompletionRunner_getFinalMessage=function _AbstractChatCompletionRunner_getFinalMessage(){let i=this.messages.length;while(i-- >0){const message=this.messages[i];if((0,chatCompletionUtils_1.isAssistantMessage)(message)){const {function_call,...rest}=message;const ret={...rest,content:message.content??null,refusal:message.refusal??null};if(function_call)ret.function_call=
function_call;return ret}}throw new error_1.OpenAIError("stream ended without producing a ChatCompletionMessage with role=assistant");},_AbstractChatCompletionRunner_getFinalFunctionCall=function _AbstractChatCompletionRunner_getFinalFunctionCall(){for(let i=this.messages.length-1;i>=0;i--){const message=this.messages[i];if((0,chatCompletionUtils_1.isAssistantMessage)(message)&&message?.function_call)return message.function_call;if((0,chatCompletionUtils_1.isAssistantMessage)(message)&&message?.tool_calls?.length)return message.tool_calls.at(-1)?.function}return},
_AbstractChatCompletionRunner_getFinalFunctionCallResult=function _AbstractChatCompletionRunner_getFinalFunctionCallResult(){for(let i=this.messages.length-1;i>=0;i--){const message=this.messages[i];if((0,chatCompletionUtils_1.isFunctionMessage)(message)&&message.content!=null)return message.content;if((0,chatCompletionUtils_1.isToolMessage)(message)&&message.content!=null&&typeof message.content==="string"&&this.messages.some(x=>x.role==="assistant"&&x.tool_calls?.some(y=>y.type==="function"&&y.id===
message.tool_call_id)))return message.content}return},_AbstractChatCompletionRunner_calculateTotalUsage=function _AbstractChatCompletionRunner_calculateTotalUsage(){const total={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const {usage}of this._chatCompletions)if(usage){total.completion_tokens+=usage.completion_tokens;total.prompt_tokens+=usage.prompt_tokens;total.total_tokens+=usage.total_tokens}return total},_AbstractChatCompletionRunner_validateParams=function _AbstractChatCompletionRunner_validateParams(params){if(params.n!=
null&&params.n>1)throw new error_1.OpenAIError("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.");},_AbstractChatCompletionRunner_stringifyFunctionCallResult=function _AbstractChatCompletionRunner_stringifyFunctionCallResult(rawContent){return typeof rawContent==="string"?rawContent:rawContent===undefined?"undefined":JSON.stringify(rawContent)}},{"../error.js":12,"../lib/parser.js":30,"./EventStream.js":25,"./RunnableFunction.js":27,
"./chatCompletionUtils.js":29}],21:[function(require,module,exports){var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){if(k2===undefined)k2=k;var desc=Object.getOwnPropertyDescriptor(m,k);if(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))desc={enumerable:true,get:function(){return m[k]}};Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){if(k2===undefined)k2=k;o[k2]=m[k]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?
function(o,v){Object.defineProperty(o,"default",{enumerable:true,value:v})}:function(o,v){o["default"]=v});var __importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(mod!=null)for(var k in mod)if(k!=="default"&&Object.prototype.hasOwnProperty.call(mod,k))__createBinding(result,mod,k);__setModuleDefault(result,mod);return result};var __classPrivateFieldGet=this&&this.__classPrivateFieldGet||function(receiver,state,kind,f){if(kind==="a"&&!f)throw new TypeError("Private accessor was defined without a getter");
if(typeof state==="function"?receiver!==state||!f:!state.has(receiver))throw new TypeError("Cannot read private member from an object whose class did not declare it");return kind==="m"?f:kind==="a"?f.call(receiver):f?f.value:state.get(receiver)};var __classPrivateFieldSet=this&&this.__classPrivateFieldSet||function(receiver,state,value,kind,f){if(kind==="m")throw new TypeError("Private method is not writable");if(kind==="a"&&!f)throw new TypeError("Private accessor was defined without a setter");
if(typeof state==="function"?receiver!==state||!f:!state.has(receiver))throw new TypeError("Cannot write private member to an object whose class did not declare it");return kind==="a"?f.call(receiver,value):f?f.value=value:state.set(receiver,value),value};var _AssistantStream_instances,_AssistantStream_events,_AssistantStream_runStepSnapshots,_AssistantStream_messageSnapshots,_AssistantStream_messageSnapshot,_AssistantStream_finalRun,_AssistantStream_currentContentIndex,_AssistantStream_currentContent,
_AssistantStream_currentToolCallIndex,_AssistantStream_currentToolCall,_AssistantStream_currentEvent,_AssistantStream_currentRunSnapshot,_AssistantStream_currentRunStepSnapshot,_AssistantStream_addEvent,_AssistantStream_endRequest,_AssistantStream_handleMessage,_AssistantStream_handleRunStep,_AssistantStream_handleEvent,_AssistantStream_accumulateRunStep,_AssistantStream_accumulateMessage,_AssistantStream_accumulateContent,_AssistantStream_handleRun;Object.defineProperty(exports,"__esModule",{value:true});
exports.AssistantStream=void 0;const Core=__importStar(require("../core.js"));const streaming_1=require("../streaming.js");const error_1=require("../error.js");const EventStream_1=require("./EventStream.js");class AssistantStream extends EventStream_1.EventStream{constructor(){super(...arguments);_AssistantStream_instances.add(this);_AssistantStream_events.set(this,[]);_AssistantStream_runStepSnapshots.set(this,{});_AssistantStream_messageSnapshots.set(this,{});_AssistantStream_messageSnapshot.set(this,
void 0);_AssistantStream_finalRun.set(this,void 0);_AssistantStream_currentContentIndex.set(this,void 0);_AssistantStream_currentContent.set(this,void 0);_AssistantStream_currentToolCallIndex.set(this,void 0);_AssistantStream_currentToolCall.set(this,void 0);_AssistantStream_currentEvent.set(this,void 0);_AssistantStream_currentRunSnapshot.set(this,void 0);_AssistantStream_currentRunStepSnapshot.set(this,void 0)}[(_AssistantStream_events=new WeakMap,_AssistantStream_runStepSnapshots=new WeakMap,_AssistantStream_messageSnapshots=
new WeakMap,_AssistantStream_messageSnapshot=new WeakMap,_AssistantStream_finalRun=new WeakMap,_AssistantStream_currentContentIndex=new WeakMap,_AssistantStream_currentContent=new WeakMap,_AssistantStream_currentToolCallIndex=new WeakMap,_AssistantStream_currentToolCall=new WeakMap,_AssistantStream_currentEvent=new WeakMap,_AssistantStream_currentRunSnapshot=new WeakMap,_AssistantStream_currentRunStepSnapshot=new WeakMap,_AssistantStream_instances=new WeakSet,Symbol.asyncIterator)](){const pushQueue=
[];const readQueue=[];let done=false;this.on("event",event=>{const reader=readQueue.shift();if(reader)reader.resolve(event);else pushQueue.push(event)});this.on("end",()=>{done=true;for(const reader of readQueue)reader.resolve(undefined);readQueue.length=0});this.on("abort",err=>{done=true;for(const reader of readQueue)reader.reject(err);readQueue.length=0});this.on("error",err=>{done=true;for(const reader of readQueue)reader.reject(err);readQueue.length=0});return{next:async()=>{if(!pushQueue.length){if(done)return{value:undefined,
done:true};return(new Promise((resolve,reject)=>readQueue.push({resolve,reject}))).then(chunk=>chunk?{value:chunk,done:false}:{value:undefined,done:true})}const chunk=pushQueue.shift();return{value:chunk,done:false}},return:async()=>{this.abort();return{value:undefined,done:true}}}}static fromReadableStream(stream){const runner=new AssistantStream;runner._run(()=>runner._fromReadableStream(stream));return runner}async _fromReadableStream(readableStream,options){const signal=options?.signal;if(signal){if(signal.aborted)this.controller.abort();
signal.addEventListener("abort",()=>this.controller.abort())}this._connected();const stream=streaming_1.Stream.fromReadableStream(readableStream,this.controller);for await(const event of stream)__classPrivateFieldGet(this,_AssistantStream_instances,"m",_AssistantStream_addEvent).call(this,event);if(stream.controller.signal?.aborted)throw new error_1.APIUserAbortError;return this._addRun(__classPrivateFieldGet(this,_AssistantStream_instances,"m",_AssistantStream_endRequest).call(this))}toReadableStream(){const stream=
new streaming_1.Stream(this[Symbol.asyncIterator].bind(this),this.controller);return stream.toReadableStream()}static createToolAssistantStream(threadId,runId,runs,params,options){const runner=new AssistantStream;runner._run(()=>runner._runToolAssistantStream(threadId,runId,runs,params,{...options,headers:{...options?.headers,"X-Stainless-Helper-Method":"stream"}}));return runner}async _createToolAssistantStream(run,threadId,runId,params,options){const signal=options?.signal;if(signal){if(signal.aborted)this.controller.abort();
signal.addEventListener("abort",()=>this.controller.abort())}const body={...params,stream:true};const stream=await run.submitToolOutputs(threadId,runId,body,{...options,signal:this.controller.signal});this._connected();for await(const event of stream)__classPrivateFieldGet(this,_AssistantStream_instances,"m",_AssistantStream_addEvent).call(this,event);if(stream.controller.signal?.aborted)throw new error_1.APIUserAbortError;return this._addRun(__classPrivateFieldGet(this,_AssistantStream_instances,
"m",_AssistantStream_endRequest).call(this))}static createThreadAssistantStream(params,thread,options){const runner=new AssistantStream;runner._run(()=>runner._threadAssistantStream(params,thread,{...options,headers:{...options?.headers,"X-Stainless-Helper-Method":"stream"}}));return runner}static createAssistantStream(threadId,runs,params,options){const runner=new AssistantStream;runner._run(()=>runner._runAssistantStream(threadId,runs,params,{...options,headers:{...options?.headers,"X-Stainless-Helper-Method":"stream"}}));
return runner}currentEvent(){return __classPrivateFieldGet(this,_AssistantStream_currentEvent,"f")}currentRun(){return __classPrivateFieldGet(this,_AssistantStream_currentRunSnapshot,"f")}currentMessageSnapshot(){return __classPrivateFieldGet(this,_AssistantStream_messageSnapshot,"f")}currentRunStepSnapshot(){return __classPrivateFieldGet(this,_AssistantStream_currentRunStepSnapshot,"f")}async finalRunSteps(){await this.done();return Object.values(__classPrivateFieldGet(this,_AssistantStream_runStepSnapshots,
"f"))}async finalMessages(){await this.done();return Object.values(__classPrivateFieldGet(this,_AssistantStream_messageSnapshots,"f"))}async finalRun(){await this.done();if(!__classPrivateFieldGet(this,_AssistantStream_finalRun,"f"))throw Error("Final run was not received.");return __classPrivateFieldGet(this,_AssistantStream_finalRun,"f")}async _createThreadAssistantStream(thread,params,options){const signal=options?.signal;if(signal){if(signal.aborted)this.controller.abort();signal.addEventListener("abort",
()=>this.controller.abort())}const body={...params,stream:true};const stream=await thread.createAndRun(body,{...options,signal:this.controller.signal});this._connected();for await(const event of stream)__classPrivateFieldGet(this,_AssistantStream_instances,"m",_AssistantStream_addEvent).call(this,event);if(stream.controller.signal?.aborted)throw new error_1.APIUserAbortError;return this._addRun(__classPrivateFieldGet(this,_AssistantStream_instances,"m",_AssistantStream_endRequest).call(this))}async _createAssistantStream(run,
threadId,params,options){const signal=options?.signal;if(signal){if(signal.aborted)this.controller.abort();signal.addEventListener("abort",()=>this.controller.abort())}const body={...params,stream:true};const stream=await run.create(threadId,body,{...options,signal:this.controller.signal});this._connected();for await(const event of stream)__classPrivateFieldGet(this,_AssistantStream_instances,"m",_AssistantStream_addEvent).call(this,event);if(stream.controller.signal?.aborted)throw new error_1.APIUserAbortError;
return this._addRun(__classPrivateFieldGet(this,_AssistantStream_instances,"m",_AssistantStream_endRequest).call(this))}static accumulateDelta(acc,delta){for(const [key,deltaValue]of Object.entries(delta)){if(!acc.hasOwnProperty(key)){acc[key]=deltaValue;continue}let accValue=acc[key];if(accValue===null||accValue===undefined){acc[key]=deltaValue;continue}if(key==="index"||key==="type"){acc[key]=deltaValue;continue}if(typeof accValue==="string"&&typeof deltaValue==="string")accValue+=deltaValue;else if(typeof accValue===
"number"&&typeof deltaValue==="number")accValue+=deltaValue;else if(Core.isObj(accValue)&&Core.isObj(deltaValue))accValue=this.accumulateDelta(accValue,deltaValue);else if(Array.isArray(accValue)&&Array.isArray(deltaValue)){if(accValue.every(x=>typeof x==="string"||typeof x==="number")){accValue.push(...deltaValue);continue}for(const deltaEntry of deltaValue){if(!Core.isObj(deltaEntry))throw new Error(`Expected array delta entry to be an object but got: ${deltaEntry}`);const index=deltaEntry["index"];
if(index==null){console.error(deltaEntry);throw new Error("Expected array delta entry to have an `index` property");}if(typeof index!=="number")throw new Error(`Expected array delta entry \`index\` property to be a number but got ${index}`);const accEntry=accValue[index];if(accEntry==null)accValue.push(deltaEntry);else accValue[index]=this.accumulateDelta(accEntry,deltaEntry)}continue}else throw Error(`Unhandled record type: ${key}, deltaValue: ${deltaValue}, accValue: ${accValue}`);acc[key]=accValue}return acc}_addRun(run){return run}async _threadAssistantStream(params,
thread,options){return await this._createThreadAssistantStream(thread,params,options)}async _runAssistantStream(threadId,runs,params,options){return await this._createAssistantStream(runs,threadId,params,options)}async _runToolAssistantStream(threadId,runId,runs,params,options){return await this._createToolAssistantStream(runs,threadId,runId,params,options)}}exports.AssistantStream=AssistantStream;_AssistantStream_addEvent=function _AssistantStream_addEvent(event){if(this.ended)return;__classPrivateFieldSet(this,
_AssistantStream_currentEvent,event,"f");__classPrivateFieldGet(this,_AssistantStream_instances,"m",_AssistantStream_handleEvent).call(this,event);switch(event.event){case "thread.created":break;case "thread.run.created":case "thread.run.queued":case "thread.run.in_progress":case "thread.run.requires_action":case "thread.run.completed":case "thread.run.incomplete":case "thread.run.failed":case "thread.run.cancelling":case "thread.run.cancelled":case "thread.run.expired":__classPrivateFieldGet(this,
_AssistantStream_instances,"m",_AssistantStream_handleRun).call(this,event);break;case "thread.run.step.created":case "thread.run.step.in_progress":case "thread.run.step.delta":case "thread.run.step.completed":case "thread.run.step.failed":case "thread.run.step.cancelled":case "thread.run.step.expired":__classPrivateFieldGet(this,_AssistantStream_instances,"m",_AssistantStream_handleRunStep).call(this,event);break;case "thread.message.created":case "thread.message.in_progress":case "thread.message.delta":case "thread.message.completed":case "thread.message.incomplete":__classPrivateFieldGet(this,
_AssistantStream_instances,"m",_AssistantStream_handleMessage).call(this,event);break;case "error":throw new Error("Encountered an error event in event processing - errors should be processed earlier");default:assertNever(event)}},_AssistantStream_endRequest=function _AssistantStream_endRequest(){if(this.ended)throw new error_1.OpenAIError(`stream has ended, this shouldn't happen`);if(!__classPrivateFieldGet(this,_AssistantStream_finalRun,"f"))throw Error("Final run has not been received");return __classPrivateFieldGet(this,
_AssistantStream_finalRun,"f")},_AssistantStream_handleMessage=function _AssistantStream_handleMessage(event){const [accumulatedMessage,newContent]=__classPrivateFieldGet(this,_AssistantStream_instances,"m",_AssistantStream_accumulateMessage).call(this,event,__classPrivateFieldGet(this,_AssistantStream_messageSnapshot,"f"));__classPrivateFieldSet(this,_AssistantStream_messageSnapshot,accumulatedMessage,"f");__classPrivateFieldGet(this,_AssistantStream_messageSnapshots,"f")[accumulatedMessage.id]=
accumulatedMessage;for(const content of newContent){const snapshotContent=accumulatedMessage.content[content.index];if(snapshotContent?.type=="text")this._emit("textCreated",snapshotContent.text)}switch(event.event){case "thread.message.created":this._emit("messageCreated",event.data);break;case "thread.message.in_progress":break;case "thread.message.delta":this._emit("messageDelta",event.data.delta,accumulatedMessage);if(event.data.delta.content)for(const content of event.data.delta.content){if(content.type==
"text"&&content.text){let textDelta=content.text;let snapshot=accumulatedMessage.content[content.index];if(snapshot&&snapshot.type=="text")this._emit("textDelta",textDelta,snapshot.text);else throw Error("The snapshot associated with this text delta is not text or missing");}if(content.index!=__classPrivateFieldGet(this,_AssistantStream_currentContentIndex,"f")){if(__classPrivateFieldGet(this,_AssistantStream_currentContent,"f"))switch(__classPrivateFieldGet(this,_AssistantStream_currentContent,"f").type){case "text":this._emit("textDone",
__classPrivateFieldGet(this,_AssistantStream_currentContent,"f").text,__classPrivateFieldGet(this,_AssistantStream_messageSnapshot,"f"));break;case "image_file":this._emit("imageFileDone",__classPrivateFieldGet(this,_AssistantStream_currentContent,"f").image_file,__classPrivateFieldGet(this,_AssistantStream_messageSnapshot,"f"));break}__classPrivateFieldSet(this,_AssistantStream_currentContentIndex,content.index,"f")}__classPrivateFieldSet(this,_AssistantStream_currentContent,accumulatedMessage.content[content.index],
"f")}break;case "thread.message.completed":case "thread.message.incomplete":if(__classPrivateFieldGet(this,_AssistantStream_currentContentIndex,"f")!==undefined){const currentContent=event.data.content[__classPrivateFieldGet(this,_AssistantStream_currentContentIndex,"f")];if(currentContent)switch(currentContent.type){case "image_file":this._emit("imageFileDone",currentContent.image_file,__classPrivateFieldGet(this,_AssistantStream_messageSnapshot,"f"));break;case "text":this._emit("textDone",currentContent.text,
__classPrivateFieldGet(this,_AssistantStream_messageSnapshot,"f"));break}}if(__classPrivateFieldGet(this,_AssistantStream_messageSnapshot,"f"))this._emit("messageDone",event.data);__classPrivateFieldSet(this,_AssistantStream_messageSnapshot,undefined,"f")}},_AssistantStream_handleRunStep=function _AssistantStream_handleRunStep(event){const accumulatedRunStep=__classPrivateFieldGet(this,_AssistantStream_instances,"m",_AssistantStream_accumulateRunStep).call(this,event);__classPrivateFieldSet(this,
_AssistantStream_currentRunStepSnapshot,accumulatedRunStep,"f");switch(event.event){case "thread.run.step.created":this._emit("runStepCreated",event.data);break;case "thread.run.step.delta":const delta=event.data.delta;if(delta.step_details&&delta.step_details.type=="tool_calls"&&delta.step_details.tool_calls&&accumulatedRunStep.step_details.type=="tool_calls")for(const toolCall of delta.step_details.tool_calls)if(toolCall.index==__classPrivateFieldGet(this,_AssistantStream_currentToolCallIndex,"f"))this._emit("toolCallDelta",
toolCall,accumulatedRunStep.step_details.tool_calls[toolCall.index]);else{if(__classPrivateFieldGet(this,_AssistantStream_currentToolCall,"f"))this._emit("toolCallDone",__classPrivateFieldGet(this,_AssistantStream_currentToolCall,"f"));__classPrivateFieldSet(this,_AssistantStream_currentToolCallIndex,toolCall.index,"f");__classPrivateFieldSet(this,_AssistantStream_currentToolCall,accumulatedRunStep.step_details.tool_calls[toolCall.index],"f");if(__classPrivateFieldGet(this,_AssistantStream_currentToolCall,
"f"))this._emit("toolCallCreated",__classPrivateFieldGet(this,_AssistantStream_currentToolCall,"f"))}this._emit("runStepDelta",event.data.delta,accumulatedRunStep);break;case "thread.run.step.completed":case "thread.run.step.failed":case "thread.run.step.cancelled":case "thread.run.step.expired":__classPrivateFieldSet(this,_AssistantStream_currentRunStepSnapshot,undefined,"f");const details=event.data.step_details;if(details.type=="tool_calls")if(__classPrivateFieldGet(this,_AssistantStream_currentToolCall,
"f")){this._emit("toolCallDone",__classPrivateFieldGet(this,_AssistantStream_currentToolCall,"f"));__classPrivateFieldSet(this,_AssistantStream_currentToolCall,undefined,"f")}this._emit("runStepDone",event.data,accumulatedRunStep);break;case "thread.run.step.in_progress":break}},_AssistantStream_handleEvent=function _AssistantStream_handleEvent(event){__classPrivateFieldGet(this,_AssistantStream_events,"f").push(event);this._emit("event",event)},_AssistantStream_accumulateRunStep=function _AssistantStream_accumulateRunStep(event){switch(event.event){case "thread.run.step.created":__classPrivateFieldGet(this,
_AssistantStream_runStepSnapshots,"f")[event.data.id]=event.data;return event.data;case "thread.run.step.delta":let snapshot=__classPrivateFieldGet(this,_AssistantStream_runStepSnapshots,"f")[event.data.id];if(!snapshot)throw Error("Received a RunStepDelta before creation of a snapshot");let data=event.data;if(data.delta){const accumulated=AssistantStream.accumulateDelta(snapshot,data.delta);__classPrivateFieldGet(this,_AssistantStream_runStepSnapshots,"f")[event.data.id]=accumulated}return __classPrivateFieldGet(this,
_AssistantStream_runStepSnapshots,"f")[event.data.id];case "thread.run.step.completed":case "thread.run.step.failed":case "thread.run.step.cancelled":case "thread.run.step.expired":case "thread.run.step.in_progress":__classPrivateFieldGet(this,_AssistantStream_runStepSnapshots,"f")[event.data.id]=event.data;break}if(__classPrivateFieldGet(this,_AssistantStream_runStepSnapshots,"f")[event.data.id])return __classPrivateFieldGet(this,_AssistantStream_runStepSnapshots,"f")[event.data.id];throw new Error("No snapshot available");
},_AssistantStream_accumulateMessage=function _AssistantStream_accumulateMessage(event,snapshot){let newContent=[];switch(event.event){case "thread.message.created":return[event.data,newContent];case "thread.message.delta":if(!snapshot)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let data=event.data;if(data.delta.content)for(const contentElement of data.delta.content)if(contentElement.index in snapshot.content){let currentContent=snapshot.content[contentElement.index];
snapshot.content[contentElement.index]=__classPrivateFieldGet(this,_AssistantStream_instances,"m",_AssistantStream_accumulateContent).call(this,contentElement,currentContent)}else{snapshot.content[contentElement.index]=contentElement;newContent.push(contentElement)}return[snapshot,newContent];case "thread.message.in_progress":case "thread.message.completed":case "thread.message.incomplete":if(snapshot)return[snapshot,newContent];else throw Error("Received thread message event with no existing snapshot");
}throw Error("Tried to accumulate a non-message event");},_AssistantStream_accumulateContent=function _AssistantStream_accumulateContent(contentElement,currentContent){return AssistantStream.accumulateDelta(currentContent,contentElement)},_AssistantStream_handleRun=function _AssistantStream_handleRun(event){__classPrivateFieldSet(this,_AssistantStream_currentRunSnapshot,event.data,"f");switch(event.event){case "thread.run.created":break;case "thread.run.queued":break;case "thread.run.in_progress":break;
case "thread.run.requires_action":case "thread.run.cancelled":case "thread.run.failed":case "thread.run.completed":case "thread.run.expired":__classPrivateFieldSet(this,_AssistantStream_finalRun,event.data,"f");if(__classPrivateFieldGet(this,_AssistantStream_currentToolCall,"f")){this._emit("toolCallDone",__classPrivateFieldGet(this,_AssistantStream_currentToolCall,"f"));__classPrivateFieldSet(this,_AssistantStream_currentToolCall,undefined,"f")}break;case "thread.run.cancelling":break}};function assertNever(_x){}
},{"../core.js":11,"../error.js":12,"../streaming.js":78,"./EventStream.js":25}],22:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.ChatCompletionRunner=void 0;const AbstractChatCompletionRunner_1=require("./AbstractChatCompletionRunner.js");const chatCompletionUtils_1=require("./chatCompletionUtils.js");class ChatCompletionRunner extends AbstractChatCompletionRunner_1.AbstractChatCompletionRunner{static runFunctions(client,params,options){const runner=
new ChatCompletionRunner;const opts={...options,headers:{...options?.headers,"X-Stainless-Helper-Method":"runFunctions"}};runner._run(()=>runner._runFunctions(client,params,opts));return runner}static runTools(client,params,options){const runner=new ChatCompletionRunner;const opts={...options,headers:{...options?.headers,"X-Stainless-Helper-Method":"runTools"}};runner._run(()=>runner._runTools(client,params,opts));return runner}_addMessage(message,emit=true){super._addMessage(message,emit);if((0,chatCompletionUtils_1.isAssistantMessage)(message)&&
message.content)this._emit("content",message.content)}}exports.ChatCompletionRunner=ChatCompletionRunner},{"./AbstractChatCompletionRunner.js":20,"./chatCompletionUtils.js":29}],23:[function(require,module,exports){var __classPrivateFieldSet=this&&this.__classPrivateFieldSet||function(receiver,state,value,kind,f){if(kind==="m")throw new TypeError("Private method is not writable");if(kind==="a"&&!f)throw new TypeError("Private accessor was defined without a setter");if(typeof state==="function"?receiver!==
state||!f:!state.has(receiver))throw new TypeError("Cannot write private member to an object whose class did not declare it");return kind==="a"?f.call(receiver,value):f?f.value=value:state.set(receiver,value),value};var __classPrivateFieldGet=this&&this.__classPrivateFieldGet||function(receiver,state,kind,f){if(kind==="a"&&!f)throw new TypeError("Private accessor was defined without a getter");if(typeof state==="function"?receiver!==state||!f:!state.has(receiver))throw new TypeError("Cannot read private member from an object whose class did not declare it");
return kind==="m"?f:kind==="a"?f.call(receiver):f?f.value:state.get(receiver)};var _ChatCompletionStream_instances,_ChatCompletionStream_params,_ChatCompletionStream_choiceEventStates,_ChatCompletionStream_currentChatCompletionSnapshot,_ChatCompletionStream_beginRequest,_ChatCompletionStream_getChoiceEventState,_ChatCompletionStream_addChunk,_ChatCompletionStream_emitToolCallDoneEvent,_ChatCompletionStream_emitContentDoneEvents,_ChatCompletionStream_endRequest,_ChatCompletionStream_getAutoParseableResponseFormat,
_ChatCompletionStream_accumulateChatCompletion;Object.defineProperty(exports,"__esModule",{value:true});exports.ChatCompletionStream=void 0;const error_1=require("../error.js");const AbstractChatCompletionRunner_1=require("./AbstractChatCompletionRunner.js");const streaming_1=require("../streaming.js");const parser_1=require("../lib/parser.js");const parser_2=require("../_vendor/partial-json-parser/parser.js");class ChatCompletionStream extends AbstractChatCompletionRunner_1.AbstractChatCompletionRunner{constructor(params){super();
_ChatCompletionStream_instances.add(this);_ChatCompletionStream_params.set(this,void 0);_ChatCompletionStream_choiceEventStates.set(this,void 0);_ChatCompletionStream_currentChatCompletionSnapshot.set(this,void 0);__classPrivateFieldSet(this,_ChatCompletionStream_params,params,"f");__classPrivateFieldSet(this,_ChatCompletionStream_choiceEventStates,[],"f")}get currentChatCompletionSnapshot(){return __classPrivateFieldGet(this,_ChatCompletionStream_currentChatCompletionSnapshot,"f")}static fromReadableStream(stream){const runner=
new ChatCompletionStream(null);runner._run(()=>runner._fromReadableStream(stream));return runner}static createChatCompletion(client,params,options){const runner=new ChatCompletionStream(params);runner._run(()=>runner._runChatCompletion(client,{...params,stream:true},{...options,headers:{...options?.headers,"X-Stainless-Helper-Method":"stream"}}));return runner}async _createChatCompletion(client,params,options){super._createChatCompletion;const signal=options?.signal;if(signal){if(signal.aborted)this.controller.abort();
signal.addEventListener("abort",()=>this.controller.abort())}__classPrivateFieldGet(this,_ChatCompletionStream_instances,"m",_ChatCompletionStream_beginRequest).call(this);const stream=await client.chat.completions.create({...params,stream:true},{...options,signal:this.controller.signal});this._connected();for await(const chunk of stream)__classPrivateFieldGet(this,_ChatCompletionStream_instances,"m",_ChatCompletionStream_addChunk).call(this,chunk);if(stream.controller.signal?.aborted)throw new error_1.APIUserAbortError;
return this._addChatCompletion(__classPrivateFieldGet(this,_ChatCompletionStream_instances,"m",_ChatCompletionStream_endRequest).call(this))}async _fromReadableStream(readableStream,options){const signal=options?.signal;if(signal){if(signal.aborted)this.controller.abort();signal.addEventListener("abort",()=>this.controller.abort())}__classPrivateFieldGet(this,_ChatCompletionStream_instances,"m",_ChatCompletionStream_beginRequest).call(this);this._connected();const stream=streaming_1.Stream.fromReadableStream(readableStream,
this.controller);let chatId;for await(const chunk of stream){if(chatId&&chatId!==chunk.id)this._addChatCompletion(__classPrivateFieldGet(this,_ChatCompletionStream_instances,"m",_ChatCompletionStream_endRequest).call(this));__classPrivateFieldGet(this,_ChatCompletionStream_instances,"m",_ChatCompletionStream_addChunk).call(this,chunk);chatId=chunk.id}if(stream.controller.signal?.aborted)throw new error_1.APIUserAbortError;return this._addChatCompletion(__classPrivateFieldGet(this,_ChatCompletionStream_instances,
"m",_ChatCompletionStream_endRequest).call(this))}[(_ChatCompletionStream_params=new WeakMap,_ChatCompletionStream_choiceEventStates=new WeakMap,_ChatCompletionStream_currentChatCompletionSnapshot=new WeakMap,_ChatCompletionStream_instances=new WeakSet,_ChatCompletionStream_beginRequest=function _ChatCompletionStream_beginRequest(){if(this.ended)return;__classPrivateFieldSet(this,_ChatCompletionStream_currentChatCompletionSnapshot,undefined,"f")},_ChatCompletionStream_getChoiceEventState=function _ChatCompletionStream_getChoiceEventState(choice){let state=
__classPrivateFieldGet(this,_ChatCompletionStream_choiceEventStates,"f")[choice.index];if(state)return state;state={content_done:false,refusal_done:false,logprobs_content_done:false,logprobs_refusal_done:false,done_tool_calls:new Set,current_tool_call_index:null};__classPrivateFieldGet(this,_ChatCompletionStream_choiceEventStates,"f")[choice.index]=state;return state},_ChatCompletionStream_addChunk=function _ChatCompletionStream_addChunk(chunk){if(this.ended)return;const completion=__classPrivateFieldGet(this,
_ChatCompletionStream_instances,"m",_ChatCompletionStream_accumulateChatCompletion).call(this,chunk);this._emit("chunk",chunk,completion);for(const choice of chunk.choices){const choiceSnapshot=completion.choices[choice.index];if(choice.delta.content!=null&&choiceSnapshot.message?.role==="assistant"&&choiceSnapshot.message?.content){this._emit("content",choice.delta.content,choiceSnapshot.message.content);this._emit("content.delta",{delta:choice.delta.content,snapshot:choiceSnapshot.message.content,
parsed:choiceSnapshot.message.parsed})}if(choice.delta.refusal!=null&&choiceSnapshot.message?.role==="assistant"&&choiceSnapshot.message?.refusal)this._emit("refusal.delta",{delta:choice.delta.refusal,snapshot:choiceSnapshot.message.refusal});if(choice.logprobs?.content!=null&&choiceSnapshot.message?.role==="assistant")this._emit("logprobs.content.delta",{content:choice.logprobs?.content,snapshot:choiceSnapshot.logprobs?.content??[]});if(choice.logprobs?.refusal!=null&&choiceSnapshot.message?.role===
"assistant")this._emit("logprobs.refusal.delta",{refusal:choice.logprobs?.refusal,snapshot:choiceSnapshot.logprobs?.refusal??[]});const state=__classPrivateFieldGet(this,_ChatCompletionStream_instances,"m",_ChatCompletionStream_getChoiceEventState).call(this,choiceSnapshot);if(choiceSnapshot.finish_reason){__classPrivateFieldGet(this,_ChatCompletionStream_instances,"m",_ChatCompletionStream_emitContentDoneEvents).call(this,choiceSnapshot);if(state.current_tool_call_index!=null)__classPrivateFieldGet(this,
_ChatCompletionStream_instances,"m",_ChatCompletionStream_emitToolCallDoneEvent).call(this,choiceSnapshot,state.current_tool_call_index)}for(const toolCall of choice.delta.tool_calls??[]){if(state.current_tool_call_index!==toolCall.index){__classPrivateFieldGet(this,_ChatCompletionStream_instances,"m",_ChatCompletionStream_emitContentDoneEvents).call(this,choiceSnapshot);if(state.current_tool_call_index!=null)__classPrivateFieldGet(this,_ChatCompletionStream_instances,"m",_ChatCompletionStream_emitToolCallDoneEvent).call(this,
choiceSnapshot,state.current_tool_call_index)}state.current_tool_call_index=toolCall.index}for(const toolCallDelta of choice.delta.tool_calls??[]){const toolCallSnapshot=choiceSnapshot.message.tool_calls?.[toolCallDelta.index];if(!toolCallSnapshot?.type)continue;if(toolCallSnapshot?.type==="function")this._emit("tool_calls.function.arguments.delta",{name:toolCallSnapshot.function?.name,index:toolCallDelta.index,arguments:toolCallSnapshot.function.arguments,parsed_arguments:toolCallSnapshot.function.parsed_arguments,
arguments_delta:toolCallDelta.function?.arguments??""});else assertNever(toolCallSnapshot?.type)}}},_ChatCompletionStream_emitToolCallDoneEvent=function _ChatCompletionStream_emitToolCallDoneEvent(choiceSnapshot,toolCallIndex){const state=__classPrivateFieldGet(this,_ChatCompletionStream_instances,"m",_ChatCompletionStream_getChoiceEventState).call(this,choiceSnapshot);if(state.done_tool_calls.has(toolCallIndex))return;const toolCallSnapshot=choiceSnapshot.message.tool_calls?.[toolCallIndex];if(!toolCallSnapshot)throw new Error("no tool call snapshot");
if(!toolCallSnapshot.type)throw new Error("tool call snapshot missing `type`");if(toolCallSnapshot.type==="function"){const inputTool=__classPrivateFieldGet(this,_ChatCompletionStream_params,"f")?.tools?.find(tool=>tool.type==="function"&&tool.function.name===toolCallSnapshot.function.name);this._emit("tool_calls.function.arguments.done",{name:toolCallSnapshot.function.name,index:toolCallIndex,arguments:toolCallSnapshot.function.arguments,parsed_arguments:(0,parser_1.isAutoParsableTool)(inputTool)?
inputTool.$parseRaw(toolCallSnapshot.function.arguments):inputTool?.function.strict?JSON.parse(toolCallSnapshot.function.arguments):null})}else assertNever(toolCallSnapshot.type)},_ChatCompletionStream_emitContentDoneEvents=function _ChatCompletionStream_emitContentDoneEvents(choiceSnapshot){const state=__classPrivateFieldGet(this,_ChatCompletionStream_instances,"m",_ChatCompletionStream_getChoiceEventState).call(this,choiceSnapshot);if(choiceSnapshot.message.content&&!state.content_done){state.content_done=
true;const responseFormat=__classPrivateFieldGet(this,_ChatCompletionStream_instances,"m",_ChatCompletionStream_getAutoParseableResponseFormat).call(this);this._emit("content.done",{content:choiceSnapshot.message.content,parsed:responseFormat?responseFormat.$parseRaw(choiceSnapshot.message.content):null})}if(choiceSnapshot.message.refusal&&!state.refusal_done){state.refusal_done=true;this._emit("refusal.done",{refusal:choiceSnapshot.message.refusal})}if(choiceSnapshot.logprobs?.content&&!state.logprobs_content_done){state.logprobs_content_done=
true;this._emit("logprobs.content.done",{content:choiceSnapshot.logprobs.content})}if(choiceSnapshot.logprobs?.refusal&&!state.logprobs_refusal_done){state.logprobs_refusal_done=true;this._emit("logprobs.refusal.done",{refusal:choiceSnapshot.logprobs.refusal})}},_ChatCompletionStream_endRequest=function _ChatCompletionStream_endRequest(){if(this.ended)throw new error_1.OpenAIError(`stream has ended, this shouldn't happen`);const snapshot=__classPrivateFieldGet(this,_ChatCompletionStream_currentChatCompletionSnapshot,
"f");if(!snapshot)throw new error_1.OpenAIError(`request ended without sending any chunks`);__classPrivateFieldSet(this,_ChatCompletionStream_currentChatCompletionSnapshot,undefined,"f");__classPrivateFieldSet(this,_ChatCompletionStream_choiceEventStates,[],"f");return finalizeChatCompletion(snapshot,__classPrivateFieldGet(this,_ChatCompletionStream_params,"f"))},_ChatCompletionStream_getAutoParseableResponseFormat=function _ChatCompletionStream_getAutoParseableResponseFormat(){const responseFormat=
__classPrivateFieldGet(this,_ChatCompletionStream_params,"f")?.response_format;if((0,parser_1.isAutoParsableResponseFormat)(responseFormat))return responseFormat;return null},_ChatCompletionStream_accumulateChatCompletion=function _ChatCompletionStream_accumulateChatCompletion(chunk){var _a,_b,_c,_d;let snapshot=__classPrivateFieldGet(this,_ChatCompletionStream_currentChatCompletionSnapshot,"f");const {choices,...rest}=chunk;if(!snapshot)snapshot=__classPrivateFieldSet(this,_ChatCompletionStream_currentChatCompletionSnapshot,
{...rest,choices:[]},"f");else Object.assign(snapshot,rest);for(const {delta,finish_reason,index,logprobs=null,...other}of chunk.choices){let choice=snapshot.choices[index];if(!choice)choice=snapshot.choices[index]={finish_reason,index,message:{},logprobs,...other};if(logprobs)if(!choice.logprobs)choice.logprobs=Object.assign({},logprobs);else{const {content,refusal,...rest}=logprobs;assertIsEmpty(rest);Object.assign(choice.logprobs,rest);if(content){(_a=choice.logprobs).content??(_a.content=[]);
choice.logprobs.content.push(...content)}if(refusal){(_b=choice.logprobs).refusal??(_b.refusal=[]);choice.logprobs.refusal.push(...refusal)}}if(finish_reason){choice.finish_reason=finish_reason;if(__classPrivateFieldGet(this,_ChatCompletionStream_params,"f")&&(0,parser_1.hasAutoParseableInput)(__classPrivateFieldGet(this,_ChatCompletionStream_params,"f"))){if(finish_reason==="length")throw new error_1.LengthFinishReasonError;if(finish_reason==="content_filter")throw new error_1.ContentFilterFinishReasonError;
}}Object.assign(choice,other);if(!delta)continue;const {content,refusal,function_call,role,tool_calls,...rest}=delta;assertIsEmpty(rest);Object.assign(choice.message,rest);if(refusal)choice.message.refusal=(choice.message.refusal||"")+refusal;if(role)choice.message.role=role;if(function_call)if(!choice.message.function_call)choice.message.function_call=function_call;else{if(function_call.name)choice.message.function_call.name=function_call.name;if(function_call.arguments){(_c=choice.message.function_call).arguments??
(_c.arguments="");choice.message.function_call.arguments+=function_call.arguments}}if(content){choice.message.content=(choice.message.content||"")+content;if(!choice.message.refusal&&__classPrivateFieldGet(this,_ChatCompletionStream_instances,"m",_ChatCompletionStream_getAutoParseableResponseFormat).call(this))choice.message.parsed=(0,parser_2.partialParse)(choice.message.content)}if(tool_calls){if(!choice.message.tool_calls)choice.message.tool_calls=[];for(const {index,id,type,function:fn,...rest}of tool_calls){const tool_call=
(_d=choice.message.tool_calls)[index]??(_d[index]={});Object.assign(tool_call,rest);if(id)tool_call.id=id;if(type)tool_call.type=type;if(fn)tool_call.function??(tool_call.function={name:fn.name??"",arguments:""});if(fn?.name)tool_call.function.name=fn.name;if(fn?.arguments){tool_call.function.arguments+=fn.arguments;if((0,parser_1.shouldParseToolCall)(__classPrivateFieldGet(this,_ChatCompletionStream_params,"f"),tool_call))tool_call.function.parsed_arguments=(0,parser_2.partialParse)(tool_call.function.arguments)}}}}return snapshot},
Symbol.asyncIterator)](){const pushQueue=[];const readQueue=[];let done=false;this.on("chunk",chunk=>{const reader=readQueue.shift();if(reader)reader.resolve(chunk);else pushQueue.push(chunk)});this.on("end",()=>{done=true;for(const reader of readQueue)reader.resolve(undefined);readQueue.length=0});this.on("abort",err=>{done=true;for(const reader of readQueue)reader.reject(err);readQueue.length=0});this.on("error",err=>{done=true;for(const reader of readQueue)reader.reject(err);readQueue.length=0});
return{next:async()=>{if(!pushQueue.length){if(done)return{value:undefined,done:true};return(new Promise((resolve,reject)=>readQueue.push({resolve,reject}))).then(chunk=>chunk?{value:chunk,done:false}:{value:undefined,done:true})}const chunk=pushQueue.shift();return{value:chunk,done:false}},return:async()=>{this.abort();return{value:undefined,done:true}}}}toReadableStream(){const stream=new streaming_1.Stream(this[Symbol.asyncIterator].bind(this),this.controller);return stream.toReadableStream()}}
exports.ChatCompletionStream=ChatCompletionStream;function finalizeChatCompletion(snapshot,params){const {id,choices,created,model,system_fingerprint,...rest}=snapshot;const completion={...rest,id,choices:choices.map(({message,finish_reason,index,logprobs,...choiceRest})=>{if(!finish_reason)throw new error_1.OpenAIError(`missing finish_reason for choice ${index}`);const {content=null,function_call,tool_calls,...messageRest}=message;const role=message.role;if(!role)throw new error_1.OpenAIError(`missing role for choice ${index}`);
if(function_call){const {arguments:args,name}=function_call;if(args==null)throw new error_1.OpenAIError(`missing function_call.arguments for choice ${index}`);if(!name)throw new error_1.OpenAIError(`missing function_call.name for choice ${index}`);return{...choiceRest,message:{content,function_call:{arguments:args,name},role,refusal:message.refusal??null},finish_reason,index,logprobs}}if(tool_calls)return{...choiceRest,index,finish_reason,logprobs,message:{...messageRest,role,content,refusal:message.refusal??
null,tool_calls:tool_calls.map((tool_call,i)=>{const {function:fn,type,id,...toolRest}=tool_call;const {arguments:args,name,...fnRest}=fn||{};if(id==null)throw new error_1.OpenAIError(`missing choices[${index}].tool_calls[${i}].id\n${str(snapshot)}`);if(type==null)throw new error_1.OpenAIError(`missing choices[${index}].tool_calls[${i}].type\n${str(snapshot)}`);if(name==null)throw new error_1.OpenAIError(`missing choices[${index}].tool_calls[${i}].function.name\n${str(snapshot)}`);if(args==null)throw new error_1.OpenAIError(`missing choices[${index}].tool_calls[${i}].function.arguments\n${str(snapshot)}`);
return{...toolRest,id,type,function:{...fnRest,name,arguments:args}}})}};return{...choiceRest,message:{...messageRest,content,role,refusal:message.refusal??null},finish_reason,index,logprobs}}),created,model,object:"chat.completion",...(system_fingerprint?{system_fingerprint}:{})};return(0,parser_1.maybeParseChatCompletion)(completion,params)}function str(x){return JSON.stringify(x)}function assertIsEmpty(obj){return}function assertNever(_x){}},{"../_vendor/partial-json-parser/parser.js":10,"../error.js":12,
"../lib/parser.js":30,"../streaming.js":78,"./AbstractChatCompletionRunner.js":20}],24:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.ChatCompletionStreamingRunner=void 0;const ChatCompletionStream_1=require("./ChatCompletionStream.js");class ChatCompletionStreamingRunner extends ChatCompletionStream_1.ChatCompletionStream{static fromReadableStream(stream){const runner=new ChatCompletionStreamingRunner(null);runner._run(()=>runner._fromReadableStream(stream));
return runner}static runFunctions(client,params,options){const runner=new ChatCompletionStreamingRunner(null);const opts={...options,headers:{...options?.headers,"X-Stainless-Helper-Method":"runFunctions"}};runner._run(()=>runner._runFunctions(client,params,opts));return runner}static runTools(client,params,options){const runner=new ChatCompletionStreamingRunner(params);const opts={...options,headers:{...options?.headers,"X-Stainless-Helper-Method":"runTools"}};runner._run(()=>runner._runTools(client,
params,opts));return runner}}exports.ChatCompletionStreamingRunner=ChatCompletionStreamingRunner},{"./ChatCompletionStream.js":23}],25:[function(require,module,exports){var __classPrivateFieldSet=this&&this.__classPrivateFieldSet||function(receiver,state,value,kind,f){if(kind==="m")throw new TypeError("Private method is not writable");if(kind==="a"&&!f)throw new TypeError("Private accessor was defined without a setter");if(typeof state==="function"?receiver!==state||!f:!state.has(receiver))throw new TypeError("Cannot write private member to an object whose class did not declare it");
return kind==="a"?f.call(receiver,value):f?f.value=value:state.set(receiver,value),value};var __classPrivateFieldGet=this&&this.__classPrivateFieldGet||function(receiver,state,kind,f){if(kind==="a"&&!f)throw new TypeError("Private accessor was defined without a getter");if(typeof state==="function"?receiver!==state||!f:!state.has(receiver))throw new TypeError("Cannot read private member from an object whose class did not declare it");return kind==="m"?f:kind==="a"?f.call(receiver):f?f.value:state.get(receiver)};
var _EventStream_instances,_EventStream_connectedPromise,_EventStream_resolveConnectedPromise,_EventStream_rejectConnectedPromise,_EventStream_endPromise,_EventStream_resolveEndPromise,_EventStream_rejectEndPromise,_EventStream_listeners,_EventStream_ended,_EventStream_errored,_EventStream_aborted,_EventStream_catchingPromiseCreated,_EventStream_handleError;Object.defineProperty(exports,"__esModule",{value:true});exports.EventStream=void 0;const error_1=require("../error.js");class EventStream{constructor(){_EventStream_instances.add(this);
this.controller=new AbortController;_EventStream_connectedPromise.set(this,void 0);_EventStream_resolveConnectedPromise.set(this,()=>{});_EventStream_rejectConnectedPromise.set(this,()=>{});_EventStream_endPromise.set(this,void 0);_EventStream_resolveEndPromise.set(this,()=>{});_EventStream_rejectEndPromise.set(this,()=>{});_EventStream_listeners.set(this,{});_EventStream_ended.set(this,false);_EventStream_errored.set(this,false);_EventStream_aborted.set(this,false);_EventStream_catchingPromiseCreated.set(this,
false);__classPrivateFieldSet(this,_EventStream_connectedPromise,new Promise((resolve,reject)=>{__classPrivateFieldSet(this,_EventStream_resolveConnectedPromise,resolve,"f");__classPrivateFieldSet(this,_EventStream_rejectConnectedPromise,reject,"f")}),"f");__classPrivateFieldSet(this,_EventStream_endPromise,new Promise((resolve,reject)=>{__classPrivateFieldSet(this,_EventStream_resolveEndPromise,resolve,"f");__classPrivateFieldSet(this,_EventStream_rejectEndPromise,reject,"f")}),"f");__classPrivateFieldGet(this,
_EventStream_connectedPromise,"f").catch(()=>{});__classPrivateFieldGet(this,_EventStream_endPromise,"f").catch(()=>{})}_run(executor){setTimeout(()=>{executor().then(()=>{this._emitFinal();this._emit("end")},__classPrivateFieldGet(this,_EventStream_instances,"m",_EventStream_handleError).bind(this))},0)}_connected(){if(this.ended)return;__classPrivateFieldGet(this,_EventStream_resolveConnectedPromise,"f").call(this);this._emit("connect")}get ended(){return __classPrivateFieldGet(this,_EventStream_ended,
"f")}get errored(){return __classPrivateFieldGet(this,_EventStream_errored,"f")}get aborted(){return __classPrivateFieldGet(this,_EventStream_aborted,"f")}abort(){this.controller.abort()}on(event,listener){const listeners=__classPrivateFieldGet(this,_EventStream_listeners,"f")[event]||(__classPrivateFieldGet(this,_EventStream_listeners,"f")[event]=[]);listeners.push({listener});return this}off(event,listener){const listeners=__classPrivateFieldGet(this,_EventStream_listeners,"f")[event];if(!listeners)return this;
const index=listeners.findIndex(l=>l.listener===listener);if(index>=0)listeners.splice(index,1);return this}once(event,listener){const listeners=__classPrivateFieldGet(this,_EventStream_listeners,"f")[event]||(__classPrivateFieldGet(this,_EventStream_listeners,"f")[event]=[]);listeners.push({listener,once:true});return this}emitted(event){return new Promise((resolve,reject)=>{__classPrivateFieldSet(this,_EventStream_catchingPromiseCreated,true,"f");if(event!=="error")this.once("error",reject);this.once(event,
resolve)})}async done(){__classPrivateFieldSet(this,_EventStream_catchingPromiseCreated,true,"f");await __classPrivateFieldGet(this,_EventStream_endPromise,"f")}_emit(event,...args){if(__classPrivateFieldGet(this,_EventStream_ended,"f"))return;if(event==="end"){__classPrivateFieldSet(this,_EventStream_ended,true,"f");__classPrivateFieldGet(this,_EventStream_resolveEndPromise,"f").call(this)}const listeners=__classPrivateFieldGet(this,_EventStream_listeners,"f")[event];if(listeners){__classPrivateFieldGet(this,
_EventStream_listeners,"f")[event]=listeners.filter(l=>!l.once);listeners.forEach(({listener})=>listener(...args))}if(event==="abort"){const error=args[0];if(!__classPrivateFieldGet(this,_EventStream_catchingPromiseCreated,"f")&&!listeners?.length)Promise.reject(error);__classPrivateFieldGet(this,_EventStream_rejectConnectedPromise,"f").call(this,error);__classPrivateFieldGet(this,_EventStream_rejectEndPromise,"f").call(this,error);this._emit("end");return}if(event==="error"){const error=args[0];
if(!__classPrivateFieldGet(this,_EventStream_catchingPromiseCreated,"f")&&!listeners?.length)Promise.reject(error);__classPrivateFieldGet(this,_EventStream_rejectConnectedPromise,"f").call(this,error);__classPrivateFieldGet(this,_EventStream_rejectEndPromise,"f").call(this,error);this._emit("end")}}_emitFinal(){}}exports.EventStream=EventStream;_EventStream_connectedPromise=new WeakMap,_EventStream_resolveConnectedPromise=new WeakMap,_EventStream_rejectConnectedPromise=new WeakMap,_EventStream_endPromise=
new WeakMap,_EventStream_resolveEndPromise=new WeakMap,_EventStream_rejectEndPromise=new WeakMap,_EventStream_listeners=new WeakMap,_EventStream_ended=new WeakMap,_EventStream_errored=new WeakMap,_EventStream_aborted=new WeakMap,_EventStream_catchingPromiseCreated=new WeakMap,_EventStream_instances=new WeakSet,_EventStream_handleError=function _EventStream_handleError(error){__classPrivateFieldSet(this,_EventStream_errored,true,"f");if(error instanceof Error&&error.name==="AbortError")error=new error_1.APIUserAbortError;
if(error instanceof error_1.APIUserAbortError){__classPrivateFieldSet(this,_EventStream_aborted,true,"f");return this._emit("abort",error)}if(error instanceof error_1.OpenAIError)return this._emit("error",error);if(error instanceof Error){const openAIError=new error_1.OpenAIError(error.message);openAIError.cause=error;return this._emit("error",openAIError)}return this._emit("error",new error_1.OpenAIError(String(error)))}},{"../error.js":12}],26:[function(require,module,exports){Object.defineProperty(exports,
"__esModule",{value:true});exports.addOutputText=exports.validateInputTools=exports.shouldParseToolCall=exports.isAutoParsableTool=exports.makeParseableResponseTool=exports.hasAutoParseableInput=exports.parseResponse=exports.maybeParseResponse=void 0;const error_1=require("../error.js");const parser_1=require("../lib/parser.js");function maybeParseResponse(response,params){if(!params||!hasAutoParseableInput(params))return{...response,output_parsed:null,output:response.output.map(item=>{if(item.type===
"function_call")return{...item,parsed_arguments:null};if(item.type==="message")return{...item,content:item.content.map(content=>({...content,parsed:null}))};else return item})};return parseResponse(response,params)}exports.maybeParseResponse=maybeParseResponse;function parseResponse(response,params){const output=response.output.map(item=>{if(item.type==="function_call")return{...item,parsed_arguments:parseToolCall(params,item)};if(item.type==="message"){const content=item.content.map(content=>{if(content.type===
"output_text")return{...content,parsed:parseTextFormat(params,content.text)};return content});return{...item,content}}return item});const parsed=Object.assign({},response,{output});if(!Object.getOwnPropertyDescriptor(response,"output_text"))addOutputText(parsed);Object.defineProperty(parsed,"output_parsed",{enumerable:true,get(){for(const output of parsed.output){if(output.type!=="message")continue;for(const content of output.content)if(content.type==="output_text"&&content.parsed!==null)return content.parsed}return null}});
return parsed}exports.parseResponse=parseResponse;function parseTextFormat(params,content){if(params.text?.format?.type!=="json_schema")return null;if("$parseRaw"in params.text?.format){const text_format=params.text?.format;return text_format.$parseRaw(content)}return JSON.parse(content)}function hasAutoParseableInput(params){if((0,parser_1.isAutoParsableResponseFormat)(params.text?.format))return true;return false}exports.hasAutoParseableInput=hasAutoParseableInput;function makeParseableResponseTool(tool,
{parser,callback}){const obj={...tool};Object.defineProperties(obj,{$brand:{value:"auto-parseable-tool",enumerable:false},$parseRaw:{value:parser,enumerable:false},$callback:{value:callback,enumerable:false}});return obj}exports.makeParseableResponseTool=makeParseableResponseTool;function isAutoParsableTool(tool){return tool?.["$brand"]==="auto-parseable-tool"}exports.isAutoParsableTool=isAutoParsableTool;function getInputToolByName(input_tools,name){return input_tools.find(tool=>tool.type==="function"&&
tool.name===name)}function parseToolCall(params,toolCall){const inputTool=getInputToolByName(params.tools??[],toolCall.name);return{...toolCall,...toolCall,parsed_arguments:isAutoParsableTool(inputTool)?inputTool.$parseRaw(toolCall.arguments):inputTool?.strict?JSON.parse(toolCall.arguments):null}}function shouldParseToolCall(params,toolCall){if(!params)return false;const inputTool=getInputToolByName(params.tools??[],toolCall.name);return isAutoParsableTool(inputTool)||inputTool?.strict||false}exports.shouldParseToolCall=
shouldParseToolCall;function validateInputTools(tools){for(const tool of tools??[]){if(tool.type!=="function")throw new error_1.OpenAIError(`Currently only \`function\` tool types support auto-parsing; Received \`${tool.type}\``);if(tool.function.strict!==true)throw new error_1.OpenAIError(`The \`${tool.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`);}}exports.validateInputTools=validateInputTools;function addOutputText(rsp){const texts=[];
for(const output of rsp.output){if(output.type!=="message")continue;for(const content of output.content)if(content.type==="output_text")texts.push(content.text)}rsp.output_text=texts.join("")}exports.addOutputText=addOutputText},{"../error.js":12,"../lib/parser.js":30}],27:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.ParsingToolFunction=exports.ParsingFunction=exports.isRunnableFunctionWithParse=void 0;function isRunnableFunctionWithParse(fn){return typeof fn.parse===
"function"}exports.isRunnableFunctionWithParse=isRunnableFunctionWithParse;class ParsingFunction{constructor(input){this.function=input.function;this.parse=input.parse;this.parameters=input.parameters;this.description=input.description;this.name=input.name}}exports.ParsingFunction=ParsingFunction;class ParsingToolFunction{constructor(input){this.type="function";this.function=input}}exports.ParsingToolFunction=ParsingToolFunction},{}],28:[function(require,module,exports){Object.defineProperty(exports,
"__esModule",{value:true});exports.allSettledWithThrow=void 0;const allSettledWithThrow=async promises=>{const results=await Promise.allSettled(promises);const rejected=results.filter(result=>result.status==="rejected");if(rejected.length){for(const result of rejected)console.error(result.reason);throw new Error(`${rejected.length} promise(s) failed - see the above errors`);}const values=[];for(const result of results)if(result.status==="fulfilled")values.push(result.value);return values};exports.allSettledWithThrow=
allSettledWithThrow},{}],29:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.isPresent=exports.isToolMessage=exports.isFunctionMessage=exports.isAssistantMessage=void 0;const isAssistantMessage=message=>{return message?.role==="assistant"};exports.isAssistantMessage=isAssistantMessage;const isFunctionMessage=message=>{return message?.role==="function"};exports.isFunctionMessage=isFunctionMessage;const isToolMessage=message=>{return message?.role===
"tool"};exports.isToolMessage=isToolMessage;function isPresent(obj){return obj!=null}exports.isPresent=isPresent},{}],30:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.validateInputTools=exports.hasAutoParseableInput=exports.shouldParseToolCall=exports.parseChatCompletion=exports.maybeParseChatCompletion=exports.isAutoParsableTool=exports.makeParseableTool=exports.isAutoParsableResponseFormat=exports.makeParseableTextFormat=exports.makeParseableResponseFormat=
void 0;const error_1=require("../error.js");function makeParseableResponseFormat(response_format,parser){const obj={...response_format};Object.defineProperties(obj,{$brand:{value:"auto-parseable-response-format",enumerable:false},$parseRaw:{value:parser,enumerable:false}});return obj}exports.makeParseableResponseFormat=makeParseableResponseFormat;function makeParseableTextFormat(response_format,parser){const obj={...response_format};Object.defineProperties(obj,{$brand:{value:"auto-parseable-response-format",
enumerable:false},$parseRaw:{value:parser,enumerable:false}});return obj}exports.makeParseableTextFormat=makeParseableTextFormat;function isAutoParsableResponseFormat(response_format){return response_format?.["$brand"]==="auto-parseable-response-format"}exports.isAutoParsableResponseFormat=isAutoParsableResponseFormat;function makeParseableTool(tool,{parser,callback}){const obj={...tool};Object.defineProperties(obj,{$brand:{value:"auto-parseable-tool",enumerable:false},$parseRaw:{value:parser,enumerable:false},
$callback:{value:callback,enumerable:false}});return obj}exports.makeParseableTool=makeParseableTool;function isAutoParsableTool(tool){return tool?.["$brand"]==="auto-parseable-tool"}exports.isAutoParsableTool=isAutoParsableTool;function maybeParseChatCompletion(completion,params){if(!params||!hasAutoParseableInput(params))return{...completion,choices:completion.choices.map(choice=>({...choice,message:{...choice.message,parsed:null,...(choice.message.tool_calls?{tool_calls:choice.message.tool_calls}:
undefined)}}))};return parseChatCompletion(completion,params)}exports.maybeParseChatCompletion=maybeParseChatCompletion;function parseChatCompletion(completion,params){const choices=completion.choices.map(choice=>{if(choice.finish_reason==="length")throw new error_1.LengthFinishReasonError;if(choice.finish_reason==="content_filter")throw new error_1.ContentFilterFinishReasonError;return{...choice,message:{...choice.message,...(choice.message.tool_calls?{tool_calls:choice.message.tool_calls?.map(toolCall=>
parseToolCall(params,toolCall))??undefined}:undefined),parsed:choice.message.content&&!choice.message.refusal?parseResponseFormat(params,choice.message.content):null}}});return{...completion,choices}}exports.parseChatCompletion=parseChatCompletion;function parseResponseFormat(params,content){if(params.response_format?.type!=="json_schema")return null;if(params.response_format?.type==="json_schema"){if("$parseRaw"in params.response_format){const response_format=params.response_format;return response_format.$parseRaw(content)}return JSON.parse(content)}return null}
function parseToolCall(params,toolCall){const inputTool=params.tools?.find(inputTool=>inputTool.function?.name===toolCall.function.name);return{...toolCall,function:{...toolCall.function,parsed_arguments:isAutoParsableTool(inputTool)?inputTool.$parseRaw(toolCall.function.arguments):inputTool?.function.strict?JSON.parse(toolCall.function.arguments):null}}}function shouldParseToolCall(params,toolCall){if(!params)return false;const inputTool=params.tools?.find(inputTool=>inputTool.function?.name===toolCall.function.name);
return isAutoParsableTool(inputTool)||inputTool?.function.strict||false}exports.shouldParseToolCall=shouldParseToolCall;function hasAutoParseableInput(params){if(isAutoParsableResponseFormat(params.response_format))return true;return params.tools?.some(t=>isAutoParsableTool(t)||t.type==="function"&&t.function.strict===true)??false}exports.hasAutoParseableInput=hasAutoParseableInput;function validateInputTools(tools){for(const tool of tools??[]){if(tool.type!=="function")throw new error_1.OpenAIError(`Currently only \`function\` tool types support auto-parsing; Received \`${tool.type}\``);
if(tool.function.strict!==true)throw new error_1.OpenAIError(`The \`${tool.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`);}}exports.validateInputTools=validateInputTools},{"../error.js":12}],31:[function(require,module,exports){var __classPrivateFieldSet=this&&this.__classPrivateFieldSet||function(receiver,state,value,kind,f){if(kind==="m")throw new TypeError("Private method is not writable");if(kind==="a"&&!f)throw new TypeError("Private accessor was defined without a setter");
if(typeof state==="function"?receiver!==state||!f:!state.has(receiver))throw new TypeError("Cannot write private member to an object whose class did not declare it");return kind==="a"?f.call(receiver,value):f?f.value=value:state.set(receiver,value),value};var __classPrivateFieldGet=this&&this.__classPrivateFieldGet||function(receiver,state,kind,f){if(kind==="a"&&!f)throw new TypeError("Private accessor was defined without a getter");if(typeof state==="function"?receiver!==state||!f:!state.has(receiver))throw new TypeError("Cannot read private member from an object whose class did not declare it");
return kind==="m"?f:kind==="a"?f.call(receiver):f?f.value:state.get(receiver)};var _ResponseStream_instances,_ResponseStream_params,_ResponseStream_currentResponseSnapshot,_ResponseStream_finalResponse,_ResponseStream_beginRequest,_ResponseStream_addEvent,_ResponseStream_endRequest,_ResponseStream_accumulateResponse;Object.defineProperty(exports,"__esModule",{value:true});exports.ResponseStream=void 0;const error_1=require("../../error.js");const EventStream_1=require("../EventStream.js");const ResponsesParser_1=
require("../ResponsesParser.js");class ResponseStream extends EventStream_1.EventStream{constructor(params){super();_ResponseStream_instances.add(this);_ResponseStream_params.set(this,void 0);_ResponseStream_currentResponseSnapshot.set(this,void 0);_ResponseStream_finalResponse.set(this,void 0);__classPrivateFieldSet(this,_ResponseStream_params,params,"f")}static createResponse(client,params,options){const runner=new ResponseStream(params);runner._run(()=>runner._createResponse(client,params,{...options,
headers:{...options?.headers,"X-Stainless-Helper-Method":"stream"}}));return runner}async _createResponse(client,params,options){const signal=options?.signal;if(signal){if(signal.aborted)this.controller.abort();signal.addEventListener("abort",()=>this.controller.abort())}__classPrivateFieldGet(this,_ResponseStream_instances,"m",_ResponseStream_beginRequest).call(this);const stream=await client.responses.create({...params,stream:true},{...options,signal:this.controller.signal});this._connected();for await(const event of stream)__classPrivateFieldGet(this,
_ResponseStream_instances,"m",_ResponseStream_addEvent).call(this,event);if(stream.controller.signal?.aborted)throw new error_1.APIUserAbortError;return __classPrivateFieldGet(this,_ResponseStream_instances,"m",_ResponseStream_endRequest).call(this)}[(_ResponseStream_params=new WeakMap,_ResponseStream_currentResponseSnapshot=new WeakMap,_ResponseStream_finalResponse=new WeakMap,_ResponseStream_instances=new WeakSet,_ResponseStream_beginRequest=function _ResponseStream_beginRequest(){if(this.ended)return;
__classPrivateFieldSet(this,_ResponseStream_currentResponseSnapshot,undefined,"f")},_ResponseStream_addEvent=function _ResponseStream_addEvent(event){if(this.ended)return;const response=__classPrivateFieldGet(this,_ResponseStream_instances,"m",_ResponseStream_accumulateResponse).call(this,event);this._emit("event",event);switch(event.type){case "response.output_text.delta":{const output=response.output[event.output_index];if(!output)throw new error_1.OpenAIError(`missing output at index ${event.output_index}`);
if(output.type==="message"){const content=output.content[event.content_index];if(!content)throw new error_1.OpenAIError(`missing content at index ${event.content_index}`);if(content.type!=="output_text")throw new error_1.OpenAIError(`expected content to be 'output_text', got ${content.type}`);this._emit("response.output_text.delta",{...event,snapshot:content.text})}break}case "response.function_call_arguments.delta":{const output=response.output[event.output_index];if(!output)throw new error_1.OpenAIError(`missing output at index ${event.output_index}`);
if(output.type==="function_call")this._emit("response.function_call_arguments.delta",{...event,snapshot:output.arguments});break}default:this._emit(event.type,event);break}},_ResponseStream_endRequest=function _ResponseStream_endRequest(){if(this.ended)throw new error_1.OpenAIError(`stream has ended, this shouldn't happen`);const snapshot=__classPrivateFieldGet(this,_ResponseStream_currentResponseSnapshot,"f");if(!snapshot)throw new error_1.OpenAIError(`request ended without sending any events`);
__classPrivateFieldSet(this,_ResponseStream_currentResponseSnapshot,undefined,"f");const parsedResponse=finalizeResponse(snapshot,__classPrivateFieldGet(this,_ResponseStream_params,"f"));__classPrivateFieldSet(this,_ResponseStream_finalResponse,parsedResponse,"f");return parsedResponse},_ResponseStream_accumulateResponse=function _ResponseStream_accumulateResponse(event){let snapshot=__classPrivateFieldGet(this,_ResponseStream_currentResponseSnapshot,"f");if(!snapshot){if(event.type!=="response.created")throw new error_1.OpenAIError(`When snapshot hasn't been set yet, expected 'response.created' event, got ${event.type}`);
snapshot=__classPrivateFieldSet(this,_ResponseStream_currentResponseSnapshot,event.response,"f");return snapshot}switch(event.type){case "response.output_item.added":{snapshot.output.push(event.item);break}case "response.content_part.added":{const output=snapshot.output[event.output_index];if(!output)throw new error_1.OpenAIError(`missing output at index ${event.output_index}`);if(output.type==="message")output.content.push(event.part);break}case "response.output_text.delta":{const output=snapshot.output[event.output_index];
if(!output)throw new error_1.OpenAIError(`missing output at index ${event.output_index}`);if(output.type==="message"){const content=output.content[event.content_index];if(!content)throw new error_1.OpenAIError(`missing content at index ${event.content_index}`);if(content.type!=="output_text")throw new error_1.OpenAIError(`expected content to be 'output_text', got ${content.type}`);content.text+=event.delta}break}case "response.function_call_arguments.delta":{const output=snapshot.output[event.output_index];
if(!output)throw new error_1.OpenAIError(`missing output at index ${event.output_index}`);if(output.type==="function_call")output.arguments+=event.delta;break}case "response.completed":{__classPrivateFieldSet(this,_ResponseStream_currentResponseSnapshot,event.response,"f");break}}return snapshot},Symbol.asyncIterator)](){const pushQueue=[];const readQueue=[];let done=false;this.on("event",event=>{const reader=readQueue.shift();if(reader)reader.resolve(event);else pushQueue.push(event)});this.on("end",
()=>{done=true;for(const reader of readQueue)reader.resolve(undefined);readQueue.length=0});this.on("abort",err=>{done=true;for(const reader of readQueue)reader.reject(err);readQueue.length=0});this.on("error",err=>{done=true;for(const reader of readQueue)reader.reject(err);readQueue.length=0});return{next:async()=>{if(!pushQueue.length){if(done)return{value:undefined,done:true};return(new Promise((resolve,reject)=>readQueue.push({resolve,reject}))).then(event=>event?{value:event,done:false}:{value:undefined,
done:true})}const event=pushQueue.shift();return{value:event,done:false}},return:async()=>{this.abort();return{value:undefined,done:true}}}}async finalResponse(){await this.done();const response=__classPrivateFieldGet(this,_ResponseStream_finalResponse,"f");if(!response)throw new error_1.OpenAIError("stream ended without producing a ChatCompletion");return response}}exports.ResponseStream=ResponseStream;function finalizeResponse(snapshot,params){return(0,ResponsesParser_1.maybeParseResponse)(snapshot,
params)}},{"../../error.js":12,"../EventStream.js":25,"../ResponsesParser.js":26}],32:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.CursorPage=exports.Page=void 0;const core_1=require("./core.js");class Page extends core_1.AbstractPage{constructor(client,response,body,options){super(client,response,body,options);this.data=body.data||[];this.object=body.object}getPaginatedItems(){return this.data??[]}nextPageParams(){return null}nextPageInfo(){return null}}
exports.Page=Page;class CursorPage extends core_1.AbstractPage{constructor(client,response,body,options){super(client,response,body,options);this.data=body.data||[];this.has_more=body.has_more||false}getPaginatedItems(){return this.data??[]}hasNextPage(){if(this.has_more===false)return false;return super.hasNextPage()}nextPageParams(){const info=this.nextPageInfo();if(!info)return null;if("params"in info)return info.params;const params=Object.fromEntries(info.url.searchParams);if(!Object.keys(params).length)return null;
return params}nextPageInfo(){const data=this.getPaginatedItems();if(!data.length)return null;const id=data[data.length-1]?.id;if(!id)return null;return{params:{after:id}}}}exports.CursorPage=CursorPage},{"./core.js":11}],33:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.APIResource=void 0;class APIResource{constructor(client){this._client=client}}exports.APIResource=APIResource},{}],34:[function(require,module,exports){var __createBinding=this&&
this.__createBinding||(Object.create?function(o,m,k,k2){if(k2===undefined)k2=k;var desc=Object.getOwnPropertyDescriptor(m,k);if(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))desc={enumerable:true,get:function(){return m[k]}};Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){if(k2===undefined)k2=k;o[k2]=m[k]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:true,value:v})}:function(o,v){o["default"]=
v});var __importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(mod!=null)for(var k in mod)if(k!=="default"&&Object.prototype.hasOwnProperty.call(mod,k))__createBinding(result,mod,k);__setModuleDefault(result,mod);return result};Object.defineProperty(exports,"__esModule",{value:true});exports.Audio=void 0;const resource_1=require("../../resource.js");const SpeechAPI=__importStar(require("./speech.js"));const speech_1=require("./speech.js");const TranscriptionsAPI=
__importStar(require("./transcriptions.js"));const transcriptions_1=require("./transcriptions.js");const TranslationsAPI=__importStar(require("./translations.js"));const translations_1=require("./translations.js");class Audio extends resource_1.APIResource{constructor(){super(...arguments);this.transcriptions=new TranscriptionsAPI.Transcriptions(this._client);this.translations=new TranslationsAPI.Translations(this._client);this.speech=new SpeechAPI.Speech(this._client)}}exports.Audio=Audio;Audio.Transcriptions=
transcriptions_1.Transcriptions;Audio.Translations=translations_1.Translations;Audio.Speech=speech_1.Speech},{"../../resource.js":33,"./speech.js":35,"./transcriptions.js":36,"./translations.js":37}],35:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.Speech=void 0;const resource_1=require("../../resource.js");class Speech extends resource_1.APIResource{create(body,options){return this._client.post("/audio/speech",{body,...options,headers:{Accept:"application/octet-stream",
...options?.headers},__binaryResponse:true})}}exports.Speech=Speech},{"../../resource.js":33}],36:[function(require,module,exports){var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){if(k2===undefined)k2=k;var desc=Object.getOwnPropertyDescriptor(m,k);if(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))desc={enumerable:true,get:function(){return m[k]}};Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){if(k2===undefined)k2=k;o[k2]=m[k]});var __setModuleDefault=
this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:true,value:v})}:function(o,v){o["default"]=v});var __importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(mod!=null)for(var k in mod)if(k!=="default"&&Object.prototype.hasOwnProperty.call(mod,k))__createBinding(result,mod,k);__setModuleDefault(result,mod);return result};Object.defineProperty(exports,"__esModule",{value:true});exports.Transcriptions=
void 0;const resource_1=require("../../resource.js");const Core=__importStar(require("../../core.js"));class Transcriptions extends resource_1.APIResource{create(body,options){return this._client.post("/audio/transcriptions",Core.multipartFormRequestOptions({body,...options,stream:body.stream??false,__metadata:{model:body.model}}))}}exports.Transcriptions=Transcriptions},{"../../core.js":11,"../../resource.js":33}],37:[function(require,module,exports){var __createBinding=this&&this.__createBinding||
(Object.create?function(o,m,k,k2){if(k2===undefined)k2=k;var desc=Object.getOwnPropertyDescriptor(m,k);if(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))desc={enumerable:true,get:function(){return m[k]}};Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){if(k2===undefined)k2=k;o[k2]=m[k]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:true,value:v})}:function(o,v){o["default"]=v});var __importStar=
this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(mod!=null)for(var k in mod)if(k!=="default"&&Object.prototype.hasOwnProperty.call(mod,k))__createBinding(result,mod,k);__setModuleDefault(result,mod);return result};Object.defineProperty(exports,"__esModule",{value:true});exports.Translations=void 0;const resource_1=require("../../resource.js");const Core=__importStar(require("../../core.js"));class Translations extends resource_1.APIResource{create(body,options){return this._client.post("/audio/translations",
Core.multipartFormRequestOptions({body,...options,__metadata:{model:body.model}}))}}exports.Translations=Translations},{"../../core.js":11,"../../resource.js":33}],38:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.BatchesPage=exports.Batches=void 0;const resource_1=require("../resource.js");const core_1=require("../core.js");const pagination_1=require("../pagination.js");class Batches extends resource_1.APIResource{create(body,options){return this._client.post("/batches",
{body,...options})}retrieve(batchId,options){return this._client.get(`/batches/${batchId}`,options)}list(query={},options){if((0,core_1.isRequestOptions)(query))return this.list({},query);return this._client.getAPIList("/batches",BatchesPage,{query,...options})}cancel(batchId,options){return this._client.post(`/batches/${batchId}/cancel`,options)}}exports.Batches=Batches;class BatchesPage extends pagination_1.CursorPage{}exports.BatchesPage=BatchesPage;Batches.BatchesPage=BatchesPage},{"../core.js":11,
"../pagination.js":32,"../resource.js":33}],39:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.AssistantsPage=exports.Assistants=void 0;const resource_1=require("../../resource.js");const core_1=require("../../core.js");const pagination_1=require("../../pagination.js");class Assistants extends resource_1.APIResource{create(body,options){return this._client.post("/assistants",{body,...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}retrieve(assistantId,
options){return this._client.get(`/assistants/${assistantId}`,{...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}update(assistantId,body,options){return this._client.post(`/assistants/${assistantId}`,{body,...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}list(query={},options){if((0,core_1.isRequestOptions)(query))return this.list({},query);return this._client.getAPIList("/assistants",AssistantsPage,{query,...options,headers:{"OpenAI-Beta":"assistants=v2",
...options?.headers}})}del(assistantId,options){return this._client.delete(`/assistants/${assistantId}`,{...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}}exports.Assistants=Assistants;class AssistantsPage extends pagination_1.CursorPage{}exports.AssistantsPage=AssistantsPage;Assistants.AssistantsPage=AssistantsPage},{"../../core.js":11,"../../pagination.js":32,"../../resource.js":33}],40:[function(require,module,exports){var __createBinding=this&&this.__createBinding||(Object.create?
function(o,m,k,k2){if(k2===undefined)k2=k;var desc=Object.getOwnPropertyDescriptor(m,k);if(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))desc={enumerable:true,get:function(){return m[k]}};Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){if(k2===undefined)k2=k;o[k2]=m[k]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:true,value:v})}:function(o,v){o["default"]=v});var __importStar=this&&this.__importStar||
function(mod){if(mod&&mod.__esModule)return mod;var result={};if(mod!=null)for(var k in mod)if(k!=="default"&&Object.prototype.hasOwnProperty.call(mod,k))__createBinding(result,mod,k);__setModuleDefault(result,mod);return result};Object.defineProperty(exports,"__esModule",{value:true});exports.Beta=void 0;const resource_1=require("../../resource.js");const AssistantsAPI=__importStar(require("./assistants.js"));const ChatAPI=__importStar(require("./chat/chat.js"));const assistants_1=require("./assistants.js");
const RealtimeAPI=__importStar(require("./realtime/realtime.js"));const realtime_1=require("./realtime/realtime.js");const ThreadsAPI=__importStar(require("./threads/threads.js"));const threads_1=require("./threads/threads.js");const chat_1=require("./chat/chat.js");class Beta extends resource_1.APIResource{constructor(){super(...arguments);this.realtime=new RealtimeAPI.Realtime(this._client);this.chat=new ChatAPI.Chat(this._client);this.assistants=new AssistantsAPI.Assistants(this._client);this.threads=
new ThreadsAPI.Threads(this._client)}}exports.Beta=Beta;Beta.Realtime=realtime_1.Realtime;Beta.Assistants=assistants_1.Assistants;Beta.AssistantsPage=assistants_1.AssistantsPage;Beta.Threads=threads_1.Threads},{"../../resource.js":33,"./assistants.js":39,"./chat/chat.js":41,"./realtime/realtime.js":43,"./threads/threads.js":49}],41:[function(require,module,exports){var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){if(k2===undefined)k2=k;var desc=Object.getOwnPropertyDescriptor(m,
k);if(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))desc={enumerable:true,get:function(){return m[k]}};Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){if(k2===undefined)k2=k;o[k2]=m[k]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:true,value:v})}:function(o,v){o["default"]=v});var __importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(mod!=
null)for(var k in mod)if(k!=="default"&&Object.prototype.hasOwnProperty.call(mod,k))__createBinding(result,mod,k);__setModuleDefault(result,mod);return result};Object.defineProperty(exports,"__esModule",{value:true});exports.Chat=void 0;const resource_1=require("../../../resource.js");const CompletionsAPI=__importStar(require("./completions.js"));class Chat extends resource_1.APIResource{constructor(){super(...arguments);this.completions=new CompletionsAPI.Completions(this._client)}}exports.Chat=
Chat;(function(Chat){Chat.Completions=CompletionsAPI.Completions})(Chat=exports.Chat||(exports.Chat={}))},{"../../../resource.js":33,"./completions.js":42}],42:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.Completions=exports.ChatCompletionRunner=exports.ChatCompletionStream=exports.ParsingToolFunction=exports.ParsingFunction=exports.ChatCompletionStreamingRunner=void 0;const resource_1=require("../../../resource.js");const ChatCompletionRunner_1=
require("../../../lib/ChatCompletionRunner.js");const ChatCompletionStreamingRunner_1=require("../../../lib/ChatCompletionStreamingRunner.js");const ChatCompletionStream_1=require("../../../lib/ChatCompletionStream.js");const parser_1=require("../../../lib/parser.js");var ChatCompletionStreamingRunner_2=require("../../../lib/ChatCompletionStreamingRunner.js");Object.defineProperty(exports,"ChatCompletionStreamingRunner",{enumerable:true,get:function(){return ChatCompletionStreamingRunner_2.ChatCompletionStreamingRunner}});
var RunnableFunction_1=require("../../../lib/RunnableFunction.js");Object.defineProperty(exports,"ParsingFunction",{enumerable:true,get:function(){return RunnableFunction_1.ParsingFunction}});Object.defineProperty(exports,"ParsingToolFunction",{enumerable:true,get:function(){return RunnableFunction_1.ParsingToolFunction}});var ChatCompletionStream_2=require("../../../lib/ChatCompletionStream.js");Object.defineProperty(exports,"ChatCompletionStream",{enumerable:true,get:function(){return ChatCompletionStream_2.ChatCompletionStream}});
var ChatCompletionRunner_2=require("../../../lib/ChatCompletionRunner.js");Object.defineProperty(exports,"ChatCompletionRunner",{enumerable:true,get:function(){return ChatCompletionRunner_2.ChatCompletionRunner}});class Completions extends resource_1.APIResource{parse(body,options){(0,parser_1.validateInputTools)(body.tools);return this._client.chat.completions.create(body,{...options,headers:{...options?.headers,"X-Stainless-Helper-Method":"beta.chat.completions.parse"}})._thenUnwrap(completion=>
(0,parser_1.parseChatCompletion)(completion,body))}runFunctions(body,options){if(body.stream)return ChatCompletionStreamingRunner_1.ChatCompletionStreamingRunner.runFunctions(this._client,body,options);return ChatCompletionRunner_1.ChatCompletionRunner.runFunctions(this._client,body,options)}runTools(body,options){if(body.stream)return ChatCompletionStreamingRunner_1.ChatCompletionStreamingRunner.runTools(this._client,body,options);return ChatCompletionRunner_1.ChatCompletionRunner.runTools(this._client,
body,options)}stream(body,options){return ChatCompletionStream_1.ChatCompletionStream.createChatCompletion(this._client,body,options)}}exports.Completions=Completions},{"../../../lib/ChatCompletionRunner.js":22,"../../../lib/ChatCompletionStream.js":23,"../../../lib/ChatCompletionStreamingRunner.js":24,"../../../lib/RunnableFunction.js":27,"../../../lib/parser.js":30,"../../../resource.js":33}],43:[function(require,module,exports){var __createBinding=this&&this.__createBinding||(Object.create?function(o,
m,k,k2){if(k2===undefined)k2=k;var desc=Object.getOwnPropertyDescriptor(m,k);if(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))desc={enumerable:true,get:function(){return m[k]}};Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){if(k2===undefined)k2=k;o[k2]=m[k]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:true,value:v})}:function(o,v){o["default"]=v});var __importStar=this&&this.__importStar||
function(mod){if(mod&&mod.__esModule)return mod;var result={};if(mod!=null)for(var k in mod)if(k!=="default"&&Object.prototype.hasOwnProperty.call(mod,k))__createBinding(result,mod,k);__setModuleDefault(result,mod);return result};Object.defineProperty(exports,"__esModule",{value:true});exports.Realtime=void 0;const resource_1=require("../../../resource.js");const SessionsAPI=__importStar(require("./sessions.js"));const sessions_1=require("./sessions.js");const TranscriptionSessionsAPI=__importStar(require("./transcription-sessions.js"));
const transcription_sessions_1=require("./transcription-sessions.js");class Realtime extends resource_1.APIResource{constructor(){super(...arguments);this.sessions=new SessionsAPI.Sessions(this._client);this.transcriptionSessions=new TranscriptionSessionsAPI.TranscriptionSessions(this._client)}}exports.Realtime=Realtime;Realtime.Sessions=sessions_1.Sessions;Realtime.TranscriptionSessions=transcription_sessions_1.TranscriptionSessions},{"../../../resource.js":33,"./sessions.js":44,"./transcription-sessions.js":45}],
44:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.Sessions=void 0;const resource_1=require("../../../resource.js");class Sessions extends resource_1.APIResource{create(body,options){return this._client.post("/realtime/sessions",{body,...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}}exports.Sessions=Sessions},{"../../../resource.js":33}],45:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:true});
exports.TranscriptionSessions=void 0;const resource_1=require("../../../resource.js");class TranscriptionSessions extends resource_1.APIResource{create(body,options){return this._client.post("/realtime/transcription_sessions",{body,...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}}exports.TranscriptionSessions=TranscriptionSessions},{"../../../resource.js":33}],46:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.MessagesPage=
exports.Messages=void 0;const resource_1=require("../../../resource.js");const core_1=require("../../../core.js");const pagination_1=require("../../../pagination.js");class Messages extends resource_1.APIResource{create(threadId,body,options){return this._client.post(`/threads/${threadId}/messages`,{body,...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}retrieve(threadId,messageId,options){return this._client.get(`/threads/${threadId}/messages/${messageId}`,{...options,headers:{"OpenAI-Beta":"assistants=v2",
...options?.headers}})}update(threadId,messageId,body,options){return this._client.post(`/threads/${threadId}/messages/${messageId}`,{body,...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}list(threadId,query={},options){if((0,core_1.isRequestOptions)(query))return this.list(threadId,{},query);return this._client.getAPIList(`/threads/${threadId}/messages`,MessagesPage,{query,...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}del(threadId,messageId,options){return this._client.delete(`/threads/${threadId}/messages/${messageId}`,
{...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}}exports.Messages=Messages;class MessagesPage extends pagination_1.CursorPage{}exports.MessagesPage=MessagesPage;Messages.MessagesPage=MessagesPage},{"../../../core.js":11,"../../../pagination.js":32,"../../../resource.js":33}],47:[function(require,module,exports){var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){if(k2===undefined)k2=k;var desc=Object.getOwnPropertyDescriptor(m,k);if(!desc||("get"in
desc?!m.__esModule:desc.writable||desc.configurable))desc={enumerable:true,get:function(){return m[k]}};Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){if(k2===undefined)k2=k;o[k2]=m[k]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:true,value:v})}:function(o,v){o["default"]=v});var __importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(mod!=null)for(var k in mod)if(k!==
"default"&&Object.prototype.hasOwnProperty.call(mod,k))__createBinding(result,mod,k);__setModuleDefault(result,mod);return result};Object.defineProperty(exports,"__esModule",{value:true});exports.RunsPage=exports.Runs=void 0;const resource_1=require("../../../../resource.js");const core_1=require("../../../../core.js");const AssistantStream_1=require("../../../../lib/AssistantStream.js");const core_2=require("../../../../core.js");const StepsAPI=__importStar(require("./steps.js"));const steps_1=require("./steps.js");
const pagination_1=require("../../../../pagination.js");class Runs extends resource_1.APIResource{constructor(){super(...arguments);this.steps=new StepsAPI.Steps(this._client)}create(threadId,params,options){const {include,...body}=params;return this._client.post(`/threads/${threadId}/runs`,{query:{include},body,...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers},stream:params.stream??false})}retrieve(threadId,runId,options){return this._client.get(`/threads/${threadId}/runs/${runId}`,
{...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}update(threadId,runId,body,options){return this._client.post(`/threads/${threadId}/runs/${runId}`,{body,...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}list(threadId,query={},options){if((0,core_1.isRequestOptions)(query))return this.list(threadId,{},query);return this._client.getAPIList(`/threads/${threadId}/runs`,RunsPage,{query,...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}cancel(threadId,
runId,options){return this._client.post(`/threads/${threadId}/runs/${runId}/cancel`,{...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}async createAndPoll(threadId,body,options){const run=await this.create(threadId,body,options);return await this.poll(threadId,run.id,options)}createAndStream(threadId,body,options){return AssistantStream_1.AssistantStream.createAssistantStream(threadId,this._client.beta.threads.runs,body,options)}async poll(threadId,runId,options){const headers=
{...options?.headers,"X-Stainless-Poll-Helper":"true"};if(options?.pollIntervalMs)headers["X-Stainless-Custom-Poll-Interval"]=options.pollIntervalMs.toString();while(true){const {data:run,response}=await this.retrieve(threadId,runId,{...options,headers:{...options?.headers,...headers}}).withResponse();switch(run.status){case "queued":case "in_progress":case "cancelling":let sleepInterval=5E3;if(options?.pollIntervalMs)sleepInterval=options.pollIntervalMs;else{const headerInterval=response.headers.get("openai-poll-after-ms");
if(headerInterval){const headerIntervalMs=parseInt(headerInterval);if(!isNaN(headerIntervalMs))sleepInterval=headerIntervalMs}}await (0,core_2.sleep)(sleepInterval);break;case "requires_action":case "incomplete":case "cancelled":case "completed":case "failed":case "expired":return run}}}stream(threadId,body,options){return AssistantStream_1.AssistantStream.createAssistantStream(threadId,this._client.beta.threads.runs,body,options)}submitToolOutputs(threadId,runId,body,options){return this._client.post(`/threads/${threadId}/runs/${runId}/submit_tool_outputs`,
{body,...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers},stream:body.stream??false})}async submitToolOutputsAndPoll(threadId,runId,body,options){const run=await this.submitToolOutputs(threadId,runId,body,options);return await this.poll(threadId,run.id,options)}submitToolOutputsStream(threadId,runId,body,options){return AssistantStream_1.AssistantStream.createToolAssistantStream(threadId,runId,this._client.beta.threads.runs,body,options)}}exports.Runs=Runs;class RunsPage extends pagination_1.CursorPage{}
exports.RunsPage=RunsPage;Runs.RunsPage=RunsPage;Runs.Steps=steps_1.Steps;Runs.RunStepsPage=steps_1.RunStepsPage},{"../../../../core.js":11,"../../../../lib/AssistantStream.js":21,"../../../../pagination.js":32,"../../../../resource.js":33,"./steps.js":48}],48:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.RunStepsPage=exports.Steps=void 0;const resource_1=require("../../../../resource.js");const core_1=require("../../../../core.js");const pagination_1=
require("../../../../pagination.js");class Steps extends resource_1.APIResource{retrieve(threadId,runId,stepId,query={},options){if((0,core_1.isRequestOptions)(query))return this.retrieve(threadId,runId,stepId,{},query);return this._client.get(`/threads/${threadId}/runs/${runId}/steps/${stepId}`,{query,...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}list(threadId,runId,query={},options){if((0,core_1.isRequestOptions)(query))return this.list(threadId,runId,{},query);return this._client.getAPIList(`/threads/${threadId}/runs/${runId}/steps`,
RunStepsPage,{query,...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}}exports.Steps=Steps;class RunStepsPage extends pagination_1.CursorPage{}exports.RunStepsPage=RunStepsPage;Steps.RunStepsPage=RunStepsPage},{"../../../../core.js":11,"../../../../pagination.js":32,"../../../../resource.js":33}],49:[function(require,module,exports){var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){if(k2===undefined)k2=k;var desc=Object.getOwnPropertyDescriptor(m,
k);if(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))desc={enumerable:true,get:function(){return m[k]}};Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){if(k2===undefined)k2=k;o[k2]=m[k]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:true,value:v})}:function(o,v){o["default"]=v});var __importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(mod!=
null)for(var k in mod)if(k!=="default"&&Object.prototype.hasOwnProperty.call(mod,k))__createBinding(result,mod,k);__setModuleDefault(result,mod);return result};Object.defineProperty(exports,"__esModule",{value:true});exports.Threads=void 0;const resource_1=require("../../../resource.js");const core_1=require("../../../core.js");const AssistantStream_1=require("../../../lib/AssistantStream.js");const MessagesAPI=__importStar(require("./messages.js"));const messages_1=require("./messages.js");const RunsAPI=
__importStar(require("./runs/runs.js"));const runs_1=require("./runs/runs.js");class Threads extends resource_1.APIResource{constructor(){super(...arguments);this.runs=new RunsAPI.Runs(this._client);this.messages=new MessagesAPI.Messages(this._client)}create(body={},options){if((0,core_1.isRequestOptions)(body))return this.create({},body);return this._client.post("/threads",{body,...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}retrieve(threadId,options){return this._client.get(`/threads/${threadId}`,
{...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}update(threadId,body,options){return this._client.post(`/threads/${threadId}`,{body,...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}del(threadId,options){return this._client.delete(`/threads/${threadId}`,{...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}createAndRun(body,options){return this._client.post("/threads/runs",{body,...options,headers:{"OpenAI-Beta":"assistants=v2",
...options?.headers},stream:body.stream??false})}async createAndRunPoll(body,options){const run=await this.createAndRun(body,options);return await this.runs.poll(run.thread_id,run.id,options)}createAndRunStream(body,options){return AssistantStream_1.AssistantStream.createThreadAssistantStream(body,this._client.beta.threads,options)}}exports.Threads=Threads;Threads.Runs=runs_1.Runs;Threads.RunsPage=runs_1.RunsPage;Threads.Messages=messages_1.Messages;Threads.MessagesPage=messages_1.MessagesPage},{"../../../core.js":11,
"../../../lib/AssistantStream.js":21,"../../../resource.js":33,"./messages.js":46,"./runs/runs.js":47}],50:[function(require,module,exports){var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){if(k2===undefined)k2=k;var desc=Object.getOwnPropertyDescriptor(m,k);if(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))desc={enumerable:true,get:function(){return m[k]}};Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){if(k2===undefined)k2=k;o[k2]=m[k]});
var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:true,value:v})}:function(o,v){o["default"]=v});var __importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(mod!=null)for(var k in mod)if(k!=="default"&&Object.prototype.hasOwnProperty.call(mod,k))__createBinding(result,mod,k);__setModuleDefault(result,mod);return result};Object.defineProperty(exports,"__esModule",{value:true});
exports.Chat=void 0;const resource_1=require("../../resource.js");const CompletionsAPI=__importStar(require("./completions/completions.js"));const completions_1=require("./completions/completions.js");class Chat extends resource_1.APIResource{constructor(){super(...arguments);this.completions=new CompletionsAPI.Completions(this._client)}}exports.Chat=Chat;Chat.Completions=completions_1.Completions;Chat.ChatCompletionsPage=completions_1.ChatCompletionsPage},{"../../resource.js":33,"./completions/completions.js":51}],
51:[function(require,module,exports){var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){if(k2===undefined)k2=k;var desc=Object.getOwnPropertyDescriptor(m,k);if(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))desc={enumerable:true,get:function(){return m[k]}};Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){if(k2===undefined)k2=k;o[k2]=m[k]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,
"default",{enumerable:true,value:v})}:function(o,v){o["default"]=v});var __importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(mod!=null)for(var k in mod)if(k!=="default"&&Object.prototype.hasOwnProperty.call(mod,k))__createBinding(result,mod,k);__setModuleDefault(result,mod);return result};Object.defineProperty(exports,"__esModule",{value:true});exports.ChatCompletionStoreMessagesPage=exports.ChatCompletionsPage=exports.Completions=void 0;const resource_1=
require("../../../resource.js");const core_1=require("../../../core.js");const MessagesAPI=__importStar(require("./messages.js"));const messages_1=require("./messages.js");const pagination_1=require("../../../pagination.js");class Completions extends resource_1.APIResource{constructor(){super(...arguments);this.messages=new MessagesAPI.Messages(this._client)}create(body,options){return this._client.post("/chat/completions",{body,...options,stream:body.stream??false})}retrieve(completionId,options){return this._client.get(`/chat/completions/${completionId}`,
options)}update(completionId,body,options){return this._client.post(`/chat/completions/${completionId}`,{body,...options})}list(query={},options){if((0,core_1.isRequestOptions)(query))return this.list({},query);return this._client.getAPIList("/chat/completions",ChatCompletionsPage,{query,...options})}del(completionId,options){return this._client.delete(`/chat/completions/${completionId}`,options)}}exports.Completions=Completions;class ChatCompletionsPage extends pagination_1.CursorPage{}exports.ChatCompletionsPage=
ChatCompletionsPage;class ChatCompletionStoreMessagesPage extends pagination_1.CursorPage{}exports.ChatCompletionStoreMessagesPage=ChatCompletionStoreMessagesPage;Completions.ChatCompletionsPage=ChatCompletionsPage;Completions.Messages=messages_1.Messages},{"../../../core.js":11,"../../../pagination.js":32,"../../../resource.js":33,"./messages.js":53}],52:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.Messages=exports.Completions=exports.ChatCompletionsPage=
exports.ChatCompletionStoreMessagesPage=void 0;var completions_1=require("./completions.js");Object.defineProperty(exports,"ChatCompletionStoreMessagesPage",{enumerable:true,get:function(){return completions_1.ChatCompletionStoreMessagesPage}});Object.defineProperty(exports,"ChatCompletionsPage",{enumerable:true,get:function(){return completions_1.ChatCompletionsPage}});Object.defineProperty(exports,"Completions",{enumerable:true,get:function(){return completions_1.Completions}});var messages_1=require("./messages.js");
Object.defineProperty(exports,"Messages",{enumerable:true,get:function(){return messages_1.Messages}})},{"./completions.js":51,"./messages.js":53}],53:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.ChatCompletionStoreMessagesPage=exports.Messages=void 0;const resource_1=require("../../../resource.js");const core_1=require("../../../core.js");const completions_1=require("./completions.js");Object.defineProperty(exports,"ChatCompletionStoreMessagesPage",
{enumerable:true,get:function(){return completions_1.ChatCompletionStoreMessagesPage}});class Messages extends resource_1.APIResource{list(completionId,query={},options){if((0,core_1.isRequestOptions)(query))return this.list(completionId,{},query);return this._client.getAPIList(`/chat/completions/${completionId}/messages`,completions_1.ChatCompletionStoreMessagesPage,{query,...options})}}exports.Messages=Messages},{"../../../core.js":11,"../../../resource.js":33,"./completions.js":51}],54:[function(require,
module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.Completions=exports.ChatCompletionsPage=exports.ChatCompletionStoreMessagesPage=exports.Chat=void 0;var chat_1=require("./chat.js");Object.defineProperty(exports,"Chat",{enumerable:true,get:function(){return chat_1.Chat}});var index_1=require("./completions/index.js");Object.defineProperty(exports,"ChatCompletionStoreMessagesPage",{enumerable:true,get:function(){return index_1.ChatCompletionStoreMessagesPage}});Object.defineProperty(exports,
"ChatCompletionsPage",{enumerable:true,get:function(){return index_1.ChatCompletionsPage}});Object.defineProperty(exports,"Completions",{enumerable:true,get:function(){return index_1.Completions}})},{"./chat.js":50,"./completions/index.js":52}],55:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.Completions=void 0;const resource_1=require("../resource.js");class Completions extends resource_1.APIResource{create(body,options){return this._client.post("/completions",
{body,...options,stream:body.stream??false})}}exports.Completions=Completions},{"../resource.js":33}],56:[function(require,module,exports){var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){if(k2===undefined)k2=k;var desc=Object.getOwnPropertyDescriptor(m,k);if(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))desc={enumerable:true,get:function(){return m[k]}};Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){if(k2===undefined)k2=k;o[k2]=m[k]});
var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:true,value:v})}:function(o,v){o["default"]=v});var __importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(mod!=null)for(var k in mod)if(k!=="default"&&Object.prototype.hasOwnProperty.call(mod,k))__createBinding(result,mod,k);__setModuleDefault(result,mod);return result};Object.defineProperty(exports,"__esModule",{value:true});
exports.Embeddings=void 0;const resource_1=require("../resource.js");const Core=__importStar(require("../core.js"));class Embeddings extends resource_1.APIResource{create(body,options){const hasUserProvidedEncodingFormat=!!body.encoding_format;let encoding_format=hasUserProvidedEncodingFormat?body.encoding_format:"base64";if(hasUserProvidedEncodingFormat)Core.debug("Request","User defined encoding_format:",body.encoding_format);const response=this._client.post("/embeddings",{body:{...body,encoding_format:encoding_format},
...options});if(hasUserProvidedEncodingFormat)return response;Core.debug("response","Decoding base64 embeddings to float32 array");return response._thenUnwrap(response=>{if(response&&response.data)response.data.forEach(embeddingBase64Obj=>{const embeddingBase64Str=embeddingBase64Obj.embedding;embeddingBase64Obj.embedding=Core.toFloat32Array(embeddingBase64Str)});return response})}}exports.Embeddings=Embeddings},{"../core.js":11,"../resource.js":33}],57:[function(require,module,exports){var __createBinding=
this&&this.__createBinding||(Object.create?function(o,m,k,k2){if(k2===undefined)k2=k;var desc=Object.getOwnPropertyDescriptor(m,k);if(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))desc={enumerable:true,get:function(){return m[k]}};Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){if(k2===undefined)k2=k;o[k2]=m[k]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:true,value:v})}:function(o,v){o["default"]=
v});var __importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(mod!=null)for(var k in mod)if(k!=="default"&&Object.prototype.hasOwnProperty.call(mod,k))__createBinding(result,mod,k);__setModuleDefault(result,mod);return result};Object.defineProperty(exports,"__esModule",{value:true});exports.EvalListResponsesPage=exports.Evals=void 0;const resource_1=require("../../resource.js");const core_1=require("../../core.js");const RunsAPI=__importStar(require("./runs/runs.js"));
const runs_1=require("./runs/runs.js");const pagination_1=require("../../pagination.js");class Evals extends resource_1.APIResource{constructor(){super(...arguments);this.runs=new RunsAPI.Runs(this._client)}create(body,options){return this._client.post("/evals",{body,...options})}retrieve(evalId,options){return this._client.get(`/evals/${evalId}`,options)}update(evalId,body,options){return this._client.post(`/evals/${evalId}`,{body,...options})}list(query={},options){if((0,core_1.isRequestOptions)(query))return this.list({},
query);return this._client.getAPIList("/evals",EvalListResponsesPage,{query,...options})}del(evalId,options){return this._client.delete(`/evals/${evalId}`,options)}}exports.Evals=Evals;class EvalListResponsesPage extends pagination_1.CursorPage{}exports.EvalListResponsesPage=EvalListResponsesPage;Evals.EvalListResponsesPage=EvalListResponsesPage;Evals.Runs=runs_1.Runs;Evals.RunListResponsesPage=runs_1.RunListResponsesPage},{"../../core.js":11,"../../pagination.js":32,"../../resource.js":33,"./runs/runs.js":59}],
58:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.OutputItemListResponsesPage=exports.OutputItems=void 0;const resource_1=require("../../../resource.js");const core_1=require("../../../core.js");const pagination_1=require("../../../pagination.js");class OutputItems extends resource_1.APIResource{retrieve(evalId,runId,outputItemId,options){return this._client.get(`/evals/${evalId}/runs/${runId}/output_items/${outputItemId}`,options)}list(evalId,runId,
query={},options){if((0,core_1.isRequestOptions)(query))return this.list(evalId,runId,{},query);return this._client.getAPIList(`/evals/${evalId}/runs/${runId}/output_items`,OutputItemListResponsesPage,{query,...options})}}exports.OutputItems=OutputItems;class OutputItemListResponsesPage extends pagination_1.CursorPage{}exports.OutputItemListResponsesPage=OutputItemListResponsesPage;OutputItems.OutputItemListResponsesPage=OutputItemListResponsesPage},{"../../../core.js":11,"../../../pagination.js":32,
"../../../resource.js":33}],59:[function(require,module,exports){var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){if(k2===undefined)k2=k;var desc=Object.getOwnPropertyDescriptor(m,k);if(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))desc={enumerable:true,get:function(){return m[k]}};Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){if(k2===undefined)k2=k;o[k2]=m[k]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,
v){Object.defineProperty(o,"default",{enumerable:true,value:v})}:function(o,v){o["default"]=v});var __importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(mod!=null)for(var k in mod)if(k!=="default"&&Object.prototype.hasOwnProperty.call(mod,k))__createBinding(result,mod,k);__setModuleDefault(result,mod);return result};Object.defineProperty(exports,"__esModule",{value:true});exports.RunListResponsesPage=exports.Runs=void 0;const resource_1=require("../../../resource.js");
const core_1=require("../../../core.js");const OutputItemsAPI=__importStar(require("./output-items.js"));const output_items_1=require("./output-items.js");const pagination_1=require("../../../pagination.js");class Runs extends resource_1.APIResource{constructor(){super(...arguments);this.outputItems=new OutputItemsAPI.OutputItems(this._client)}create(evalId,body,options){return this._client.post(`/evals/${evalId}/runs`,{body,...options})}retrieve(evalId,runId,options){return this._client.get(`/evals/${evalId}/runs/${runId}`,
options)}list(evalId,query={},options){if((0,core_1.isRequestOptions)(query))return this.list(evalId,{},query);return this._client.getAPIList(`/evals/${evalId}/runs`,RunListResponsesPage,{query,...options})}del(evalId,runId,options){return this._client.delete(`/evals/${evalId}/runs/${runId}`,options)}cancel(evalId,runId,options){return this._client.post(`/evals/${evalId}/runs/${runId}`,options)}}exports.Runs=Runs;class RunListResponsesPage extends pagination_1.CursorPage{}exports.RunListResponsesPage=
RunListResponsesPage;Runs.RunListResponsesPage=RunListResponsesPage;Runs.OutputItems=output_items_1.OutputItems;Runs.OutputItemListResponsesPage=output_items_1.OutputItemListResponsesPage},{"../../../core.js":11,"../../../pagination.js":32,"../../../resource.js":33,"./output-items.js":58}],60:[function(require,module,exports){var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){if(k2===undefined)k2=k;var desc=Object.getOwnPropertyDescriptor(m,k);if(!desc||("get"in desc?
!m.__esModule:desc.writable||desc.configurable))desc={enumerable:true,get:function(){return m[k]}};Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){if(k2===undefined)k2=k;o[k2]=m[k]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:true,value:v})}:function(o,v){o["default"]=v});var __importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(mod!=null)for(var k in mod)if(k!==
"default"&&Object.prototype.hasOwnProperty.call(mod,k))__createBinding(result,mod,k);__setModuleDefault(result,mod);return result};Object.defineProperty(exports,"__esModule",{value:true});exports.FileObjectsPage=exports.Files=void 0;const resource_1=require("../resource.js");const core_1=require("../core.js");const core_2=require("../core.js");const error_1=require("../error.js");const Core=__importStar(require("../core.js"));const pagination_1=require("../pagination.js");class Files extends resource_1.APIResource{create(body,
options){return this._client.post("/files",Core.multipartFormRequestOptions({body,...options}))}retrieve(fileId,options){return this._client.get(`/files/${fileId}`,options)}list(query={},options){if((0,core_1.isRequestOptions)(query))return this.list({},query);return this._client.getAPIList("/files",FileObjectsPage,{query,...options})}del(fileId,options){return this._client.delete(`/files/${fileId}`,options)}content(fileId,options){return this._client.get(`/files/${fileId}/content`,{...options,headers:{Accept:"application/binary",
...options?.headers},__binaryResponse:true})}retrieveContent(fileId,options){return this._client.get(`/files/${fileId}/content`,options)}async waitForProcessing(id,{pollInterval=5E3,maxWait=30*60*1E3}={}){const TERMINAL_STATES=new Set(["processed","error","deleted"]);const start=Date.now();let file=await this.retrieve(id);while(!file.status||!TERMINAL_STATES.has(file.status)){await (0,core_2.sleep)(pollInterval);file=await this.retrieve(id);if(Date.now()-start>maxWait)throw new error_1.APIConnectionTimeoutError({message:`Giving up on waiting for file ${id} to finish processing after ${maxWait} milliseconds.`});
}return file}}exports.Files=Files;class FileObjectsPage extends pagination_1.CursorPage{}exports.FileObjectsPage=FileObjectsPage;Files.FileObjectsPage=FileObjectsPage},{"../core.js":11,"../error.js":12,"../pagination.js":32,"../resource.js":33}],61:[function(require,module,exports){var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){if(k2===undefined)k2=k;var desc=Object.getOwnPropertyDescriptor(m,k);if(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))desc=
{enumerable:true,get:function(){return m[k]}};Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){if(k2===undefined)k2=k;o[k2]=m[k]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:true,value:v})}:function(o,v){o["default"]=v});var __importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(mod!=null)for(var k in mod)if(k!=="default"&&Object.prototype.hasOwnProperty.call(mod,
k))__createBinding(result,mod,k);__setModuleDefault(result,mod);return result};Object.defineProperty(exports,"__esModule",{value:true});exports.Checkpoints=void 0;const resource_1=require("../../../resource.js");const PermissionsAPI=__importStar(require("./permissions.js"));const permissions_1=require("./permissions.js");class Checkpoints extends resource_1.APIResource{constructor(){super(...arguments);this.permissions=new PermissionsAPI.Permissions(this._client)}}exports.Checkpoints=Checkpoints;
Checkpoints.Permissions=permissions_1.Permissions;Checkpoints.PermissionCreateResponsesPage=permissions_1.PermissionCreateResponsesPage},{"../../../resource.js":33,"./permissions.js":62}],62:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.PermissionCreateResponsesPage=exports.Permissions=void 0;const resource_1=require("../../../resource.js");const core_1=require("../../../core.js");const pagination_1=require("../../../pagination.js");class Permissions extends resource_1.APIResource{create(fineTunedModelCheckpoint,
body,options){return this._client.getAPIList(`/fine_tuning/checkpoints/${fineTunedModelCheckpoint}/permissions`,PermissionCreateResponsesPage,{body,method:"post",...options})}retrieve(fineTunedModelCheckpoint,query={},options){if((0,core_1.isRequestOptions)(query))return this.retrieve(fineTunedModelCheckpoint,{},query);return this._client.get(`/fine_tuning/checkpoints/${fineTunedModelCheckpoint}/permissions`,{query,...options})}del(fineTunedModelCheckpoint,options){return this._client.delete(`/fine_tuning/checkpoints/${fineTunedModelCheckpoint}/permissions`,
options)}}exports.Permissions=Permissions;class PermissionCreateResponsesPage extends pagination_1.Page{}exports.PermissionCreateResponsesPage=PermissionCreateResponsesPage;Permissions.PermissionCreateResponsesPage=PermissionCreateResponsesPage},{"../../../core.js":11,"../../../pagination.js":32,"../../../resource.js":33}],63:[function(require,module,exports){var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){if(k2===undefined)k2=k;var desc=Object.getOwnPropertyDescriptor(m,
k);if(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))desc={enumerable:true,get:function(){return m[k]}};Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){if(k2===undefined)k2=k;o[k2]=m[k]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:true,value:v})}:function(o,v){o["default"]=v});var __importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(mod!=
null)for(var k in mod)if(k!=="default"&&Object.prototype.hasOwnProperty.call(mod,k))__createBinding(result,mod,k);__setModuleDefault(result,mod);return result};Object.defineProperty(exports,"__esModule",{value:true});exports.FineTuning=void 0;const resource_1=require("../../resource.js");const CheckpointsAPI=__importStar(require("./checkpoints/checkpoints.js"));const checkpoints_1=require("./checkpoints/checkpoints.js");const JobsAPI=__importStar(require("./jobs/jobs.js"));const jobs_1=require("./jobs/jobs.js");
class FineTuning extends resource_1.APIResource{constructor(){super(...arguments);this.jobs=new JobsAPI.Jobs(this._client);this.checkpoints=new CheckpointsAPI.Checkpoints(this._client)}}exports.FineTuning=FineTuning;FineTuning.Jobs=jobs_1.Jobs;FineTuning.FineTuningJobsPage=jobs_1.FineTuningJobsPage;FineTuning.FineTuningJobEventsPage=jobs_1.FineTuningJobEventsPage;FineTuning.Checkpoints=checkpoints_1.Checkpoints},{"../../resource.js":33,"./checkpoints/checkpoints.js":61,"./jobs/jobs.js":65}],64:[function(require,
module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.FineTuningJobCheckpointsPage=exports.Checkpoints=void 0;const resource_1=require("../../../resource.js");const core_1=require("../../../core.js");const pagination_1=require("../../../pagination.js");class Checkpoints extends resource_1.APIResource{list(fineTuningJobId,query={},options){if((0,core_1.isRequestOptions)(query))return this.list(fineTuningJobId,{},query);return this._client.getAPIList(`/fine_tuning/jobs/${fineTuningJobId}/checkpoints`,
FineTuningJobCheckpointsPage,{query,...options})}}exports.Checkpoints=Checkpoints;class FineTuningJobCheckpointsPage extends pagination_1.CursorPage{}exports.FineTuningJobCheckpointsPage=FineTuningJobCheckpointsPage;Checkpoints.FineTuningJobCheckpointsPage=FineTuningJobCheckpointsPage},{"../../../core.js":11,"../../../pagination.js":32,"../../../resource.js":33}],65:[function(require,module,exports){var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){if(k2===undefined)k2=
k;var desc=Object.getOwnPropertyDescriptor(m,k);if(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))desc={enumerable:true,get:function(){return m[k]}};Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){if(k2===undefined)k2=k;o[k2]=m[k]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:true,value:v})}:function(o,v){o["default"]=v});var __importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;
var result={};if(mod!=null)for(var k in mod)if(k!=="default"&&Object.prototype.hasOwnProperty.call(mod,k))__createBinding(result,mod,k);__setModuleDefault(result,mod);return result};Object.defineProperty(exports,"__esModule",{value:true});exports.FineTuningJobEventsPage=exports.FineTuningJobsPage=exports.Jobs=void 0;const resource_1=require("../../../resource.js");const core_1=require("../../../core.js");const CheckpointsAPI=__importStar(require("./checkpoints.js"));const checkpoints_1=require("./checkpoints.js");
const pagination_1=require("../../../pagination.js");class Jobs extends resource_1.APIResource{constructor(){super(...arguments);this.checkpoints=new CheckpointsAPI.Checkpoints(this._client)}create(body,options){return this._client.post("/fine_tuning/jobs",{body,...options})}retrieve(fineTuningJobId,options){return this._client.get(`/fine_tuning/jobs/${fineTuningJobId}`,options)}list(query={},options){if((0,core_1.isRequestOptions)(query))return this.list({},query);return this._client.getAPIList("/fine_tuning/jobs",
FineTuningJobsPage,{query,...options})}cancel(fineTuningJobId,options){return this._client.post(`/fine_tuning/jobs/${fineTuningJobId}/cancel`,options)}listEvents(fineTuningJobId,query={},options){if((0,core_1.isRequestOptions)(query))return this.listEvents(fineTuningJobId,{},query);return this._client.getAPIList(`/fine_tuning/jobs/${fineTuningJobId}/events`,FineTuningJobEventsPage,{query,...options})}}exports.Jobs=Jobs;class FineTuningJobsPage extends pagination_1.CursorPage{}exports.FineTuningJobsPage=
FineTuningJobsPage;class FineTuningJobEventsPage extends pagination_1.CursorPage{}exports.FineTuningJobEventsPage=FineTuningJobEventsPage;Jobs.FineTuningJobsPage=FineTuningJobsPage;Jobs.FineTuningJobEventsPage=FineTuningJobEventsPage;Jobs.Checkpoints=checkpoints_1.Checkpoints;Jobs.FineTuningJobCheckpointsPage=checkpoints_1.FineTuningJobCheckpointsPage},{"../../../core.js":11,"../../../pagination.js":32,"../../../resource.js":33,"./checkpoints.js":64}],66:[function(require,module,exports){var __createBinding=
this&&this.__createBinding||(Object.create?function(o,m,k,k2){if(k2===undefined)k2=k;var desc=Object.getOwnPropertyDescriptor(m,k);if(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))desc={enumerable:true,get:function(){return m[k]}};Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){if(k2===undefined)k2=k;o[k2]=m[k]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:true,value:v})}:function(o,v){o["default"]=
v});var __importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(mod!=null)for(var k in mod)if(k!=="default"&&Object.prototype.hasOwnProperty.call(mod,k))__createBinding(result,mod,k);__setModuleDefault(result,mod);return result};Object.defineProperty(exports,"__esModule",{value:true});exports.Images=void 0;const resource_1=require("../resource.js");const Core=__importStar(require("../core.js"));class Images extends resource_1.APIResource{createVariation(body,
options){return this._client.post("/images/variations",Core.multipartFormRequestOptions({body,...options}))}edit(body,options){return this._client.post("/images/edits",Core.multipartFormRequestOptions({body,...options}))}generate(body,options){return this._client.post("/images/generations",{body,...options})}}exports.Images=Images},{"../core.js":11,"../resource.js":33}],67:[function(require,module,exports){var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){if(k2===undefined)k2=
k;var desc=Object.getOwnPropertyDescriptor(m,k);if(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))desc={enumerable:true,get:function(){return m[k]}};Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){if(k2===undefined)k2=k;o[k2]=m[k]});var __exportStar=this&&this.__exportStar||function(m,exports){for(var p in m)if(p!=="default"&&!Object.prototype.hasOwnProperty.call(exports,p))__createBinding(exports,m,p)};Object.defineProperty(exports,"__esModule",{value:true});exports.VectorStores=
exports.VectorStoreSearchResponsesPage=exports.VectorStoresPage=exports.Uploads=exports.Responses=exports.Moderations=exports.Models=exports.ModelsPage=exports.Images=exports.FineTuning=exports.Files=exports.FileObjectsPage=exports.Evals=exports.EvalListResponsesPage=exports.Embeddings=exports.Completions=exports.Beta=exports.Batches=exports.BatchesPage=exports.Audio=void 0;__exportStar(require("./chat/index.js"),exports);__exportStar(require("./shared.js"),exports);var audio_1=require("./audio/audio.js");
Object.defineProperty(exports,"Audio",{enumerable:true,get:function(){return audio_1.Audio}});var batches_1=require("./batches.js");Object.defineProperty(exports,"BatchesPage",{enumerable:true,get:function(){return batches_1.BatchesPage}});Object.defineProperty(exports,"Batches",{enumerable:true,get:function(){return batches_1.Batches}});var beta_1=require("./beta/beta.js");Object.defineProperty(exports,"Beta",{enumerable:true,get:function(){return beta_1.Beta}});var completions_1=require("./completions.js");
Object.defineProperty(exports,"Completions",{enumerable:true,get:function(){return completions_1.Completions}});var embeddings_1=require("./embeddings.js");Object.defineProperty(exports,"Embeddings",{enumerable:true,get:function(){return embeddings_1.Embeddings}});var evals_1=require("./evals/evals.js");Object.defineProperty(exports,"EvalListResponsesPage",{enumerable:true,get:function(){return evals_1.EvalListResponsesPage}});Object.defineProperty(exports,"Evals",{enumerable:true,get:function(){return evals_1.Evals}});
var files_1=require("./files.js");Object.defineProperty(exports,"FileObjectsPage",{enumerable:true,get:function(){return files_1.FileObjectsPage}});Object.defineProperty(exports,"Files",{enumerable:true,get:function(){return files_1.Files}});var fine_tuning_1=require("./fine-tuning/fine-tuning.js");Object.defineProperty(exports,"FineTuning",{enumerable:true,get:function(){return fine_tuning_1.FineTuning}});var images_1=require("./images.js");Object.defineProperty(exports,"Images",{enumerable:true,
get:function(){return images_1.Images}});var models_1=require("./models.js");Object.defineProperty(exports,"ModelsPage",{enumerable:true,get:function(){return models_1.ModelsPage}});Object.defineProperty(exports,"Models",{enumerable:true,get:function(){return models_1.Models}});var moderations_1=require("./moderations.js");Object.defineProperty(exports,"Moderations",{enumerable:true,get:function(){return moderations_1.Moderations}});var responses_1=require("./responses/responses.js");Object.defineProperty(exports,
"Responses",{enumerable:true,get:function(){return responses_1.Responses}});var uploads_1=require("./uploads/uploads.js");Object.defineProperty(exports,"Uploads",{enumerable:true,get:function(){return uploads_1.Uploads}});var vector_stores_1=require("./vector-stores/vector-stores.js");Object.defineProperty(exports,"VectorStoresPage",{enumerable:true,get:function(){return vector_stores_1.VectorStoresPage}});Object.defineProperty(exports,"VectorStoreSearchResponsesPage",{enumerable:true,get:function(){return vector_stores_1.VectorStoreSearchResponsesPage}});
Object.defineProperty(exports,"VectorStores",{enumerable:true,get:function(){return vector_stores_1.VectorStores}})},{"./audio/audio.js":34,"./batches.js":38,"./beta/beta.js":40,"./chat/index.js":54,"./completions.js":55,"./embeddings.js":56,"./evals/evals.js":57,"./files.js":60,"./fine-tuning/fine-tuning.js":63,"./images.js":66,"./models.js":68,"./moderations.js":69,"./responses/responses.js":71,"./shared.js":72,"./uploads/uploads.js":74,"./vector-stores/vector-stores.js":77}],68:[function(require,
module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.ModelsPage=exports.Models=void 0;const resource_1=require("../resource.js");const pagination_1=require("../pagination.js");class Models extends resource_1.APIResource{retrieve(model,options){return this._client.get(`/models/${model}`,options)}list(options){return this._client.getAPIList("/models",ModelsPage,options)}del(model,options){return this._client.delete(`/models/${model}`,options)}}exports.Models=Models;class ModelsPage extends pagination_1.Page{}
exports.ModelsPage=ModelsPage;Models.ModelsPage=ModelsPage},{"../pagination.js":32,"../resource.js":33}],69:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.Moderations=void 0;const resource_1=require("../resource.js");class Moderations extends resource_1.APIResource{create(body,options){return this._client.post("/moderations",{body,...options})}}exports.Moderations=Moderations},{"../resource.js":33}],70:[function(require,module,exports){Object.defineProperty(exports,
"__esModule",{value:true});exports.ResponseItemsPage=exports.InputItems=void 0;const resource_1=require("../../resource.js");const core_1=require("../../core.js");const responses_1=require("./responses.js");Object.defineProperty(exports,"ResponseItemsPage",{enumerable:true,get:function(){return responses_1.ResponseItemsPage}});class InputItems extends resource_1.APIResource{list(responseId,query={},options){if((0,core_1.isRequestOptions)(query))return this.list(responseId,{},query);return this._client.getAPIList(`/responses/${responseId}/input_items`,
responses_1.ResponseItemsPage,{query,...options})}}exports.InputItems=InputItems},{"../../core.js":11,"../../resource.js":33,"./responses.js":71}],71:[function(require,module,exports){var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){if(k2===undefined)k2=k;var desc=Object.getOwnPropertyDescriptor(m,k);if(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))desc={enumerable:true,get:function(){return m[k]}};Object.defineProperty(o,k2,desc)}:function(o,
m,k,k2){if(k2===undefined)k2=k;o[k2]=m[k]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:true,value:v})}:function(o,v){o["default"]=v});var __importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(mod!=null)for(var k in mod)if(k!=="default"&&Object.prototype.hasOwnProperty.call(mod,k))__createBinding(result,mod,k);__setModuleDefault(result,mod);return result};Object.defineProperty(exports,
"__esModule",{value:true});exports.ResponseItemsPage=exports.Responses=void 0;const ResponsesParser_1=require("../../lib/ResponsesParser.js");const core_1=require("../../core.js");const resource_1=require("../../resource.js");const InputItemsAPI=__importStar(require("./input-items.js"));const input_items_1=require("./input-items.js");const ResponseStream_1=require("../../lib/responses/ResponseStream.js");const pagination_1=require("../../pagination.js");class Responses extends resource_1.APIResource{constructor(){super(...arguments);
this.inputItems=new InputItemsAPI.InputItems(this._client)}create(body,options){return this._client.post("/responses",{body,...options,stream:body.stream??false})._thenUnwrap(rsp=>{if("object"in rsp&&rsp.object==="response")(0,ResponsesParser_1.addOutputText)(rsp);return rsp})}retrieve(responseId,query={},options){if((0,core_1.isRequestOptions)(query))return this.retrieve(responseId,{},query);return this._client.get(`/responses/${responseId}`,{query,...options})}del(responseId,options){return this._client.delete(`/responses/${responseId}`,
{...options,headers:{Accept:"*/*",...options?.headers}})}parse(body,options){return this._client.responses.create(body,options)._thenUnwrap(response=>(0,ResponsesParser_1.parseResponse)(response,body))}stream(body,options){return ResponseStream_1.ResponseStream.createResponse(this._client,body,options)}}exports.Responses=Responses;class ResponseItemsPage extends pagination_1.CursorPage{}exports.ResponseItemsPage=ResponseItemsPage;Responses.InputItems=input_items_1.InputItems},{"../../core.js":11,
"../../lib/ResponsesParser.js":26,"../../lib/responses/ResponseStream.js":31,"../../pagination.js":32,"../../resource.js":33,"./input-items.js":70}],72:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:true})},{}],73:[function(require,module,exports){var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){if(k2===undefined)k2=k;var desc=Object.getOwnPropertyDescriptor(m,k);if(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))desc=
{enumerable:true,get:function(){return m[k]}};Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){if(k2===undefined)k2=k;o[k2]=m[k]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:true,value:v})}:function(o,v){o["default"]=v});var __importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(mod!=null)for(var k in mod)if(k!=="default"&&Object.prototype.hasOwnProperty.call(mod,
k))__createBinding(result,mod,k);__setModuleDefault(result,mod);return result};Object.defineProperty(exports,"__esModule",{value:true});exports.Parts=void 0;const resource_1=require("../../resource.js");const Core=__importStar(require("../../core.js"));class Parts extends resource_1.APIResource{create(uploadId,body,options){return this._client.post(`/uploads/${uploadId}/parts`,Core.multipartFormRequestOptions({body,...options}))}}exports.Parts=Parts},{"../../core.js":11,"../../resource.js":33}],74:[function(require,
module,exports){var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){if(k2===undefined)k2=k;var desc=Object.getOwnPropertyDescriptor(m,k);if(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))desc={enumerable:true,get:function(){return m[k]}};Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){if(k2===undefined)k2=k;o[k2]=m[k]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:true,
value:v})}:function(o,v){o["default"]=v});var __importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(mod!=null)for(var k in mod)if(k!=="default"&&Object.prototype.hasOwnProperty.call(mod,k))__createBinding(result,mod,k);__setModuleDefault(result,mod);return result};Object.defineProperty(exports,"__esModule",{value:true});exports.Uploads=void 0;const resource_1=require("../../resource.js");const PartsAPI=__importStar(require("./parts.js"));const parts_1=
require("./parts.js");class Uploads extends resource_1.APIResource{constructor(){super(...arguments);this.parts=new PartsAPI.Parts(this._client)}create(body,options){return this._client.post("/uploads",{body,...options})}cancel(uploadId,options){return this._client.post(`/uploads/${uploadId}/cancel`,options)}complete(uploadId,body,options){return this._client.post(`/uploads/${uploadId}/complete`,{body,...options})}}exports.Uploads=Uploads;Uploads.Parts=parts_1.Parts},{"../../resource.js":33,"./parts.js":73}],
75:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.VectorStoreFilesPage=exports.FileBatches=void 0;const resource_1=require("../../resource.js");const core_1=require("../../core.js");const core_2=require("../../core.js");const Util_1=require("../../lib/Util.js");const files_1=require("./files.js");Object.defineProperty(exports,"VectorStoreFilesPage",{enumerable:true,get:function(){return files_1.VectorStoreFilesPage}});class FileBatches extends resource_1.APIResource{create(vectorStoreId,
body,options){return this._client.post(`/vector_stores/${vectorStoreId}/file_batches`,{body,...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}retrieve(vectorStoreId,batchId,options){return this._client.get(`/vector_stores/${vectorStoreId}/file_batches/${batchId}`,{...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}cancel(vectorStoreId,batchId,options){return this._client.post(`/vector_stores/${vectorStoreId}/file_batches/${batchId}/cancel`,{...options,
headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}async createAndPoll(vectorStoreId,body,options){const batch=await this.create(vectorStoreId,body);return await this.poll(vectorStoreId,batch.id,options)}listFiles(vectorStoreId,batchId,query={},options){if((0,core_1.isRequestOptions)(query))return this.listFiles(vectorStoreId,batchId,{},query);return this._client.getAPIList(`/vector_stores/${vectorStoreId}/file_batches/${batchId}/files`,files_1.VectorStoreFilesPage,{query,...options,headers:{"OpenAI-Beta":"assistants=v2",
...options?.headers}})}async poll(vectorStoreId,batchId,options){const headers={...options?.headers,"X-Stainless-Poll-Helper":"true"};if(options?.pollIntervalMs)headers["X-Stainless-Custom-Poll-Interval"]=options.pollIntervalMs.toString();while(true){const {data:batch,response}=await this.retrieve(vectorStoreId,batchId,{...options,headers}).withResponse();switch(batch.status){case "in_progress":let sleepInterval=5E3;if(options?.pollIntervalMs)sleepInterval=options.pollIntervalMs;else{const headerInterval=
response.headers.get("openai-poll-after-ms");if(headerInterval){const headerIntervalMs=parseInt(headerInterval);if(!isNaN(headerIntervalMs))sleepInterval=headerIntervalMs}}await (0,core_2.sleep)(sleepInterval);break;case "failed":case "cancelled":case "completed":return batch}}}async uploadAndPoll(vectorStoreId,{files,fileIds=[]},options){if(files==null||files.length==0)throw new Error(`No \`files\` provided to process. If you've already uploaded files you should use \`.createAndPoll()\` instead`);
const configuredConcurrency=options?.maxConcurrency??5;const concurrencyLimit=Math.min(configuredConcurrency,files.length);const client=this._client;const fileIterator=files.values();const allFileIds=[...fileIds];async function processFiles(iterator){for(let item of iterator){const fileObj=await client.files.create({file:item,purpose:"assistants"},options);allFileIds.push(fileObj.id)}}const workers=Array(concurrencyLimit).fill(fileIterator).map(processFiles);await (0,Util_1.allSettledWithThrow)(workers);
return await this.createAndPoll(vectorStoreId,{file_ids:allFileIds})}}exports.FileBatches=FileBatches},{"../../core.js":11,"../../lib/Util.js":28,"../../resource.js":33,"./files.js":76}],76:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.FileContentResponsesPage=exports.VectorStoreFilesPage=exports.Files=void 0;const resource_1=require("../../resource.js");const core_1=require("../../core.js");const pagination_1=require("../../pagination.js");class Files extends resource_1.APIResource{create(vectorStoreId,
body,options){return this._client.post(`/vector_stores/${vectorStoreId}/files`,{body,...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}retrieve(vectorStoreId,fileId,options){return this._client.get(`/vector_stores/${vectorStoreId}/files/${fileId}`,{...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}update(vectorStoreId,fileId,body,options){return this._client.post(`/vector_stores/${vectorStoreId}/files/${fileId}`,{body,...options,headers:{"OpenAI-Beta":"assistants=v2",
...options?.headers}})}list(vectorStoreId,query={},options){if((0,core_1.isRequestOptions)(query))return this.list(vectorStoreId,{},query);return this._client.getAPIList(`/vector_stores/${vectorStoreId}/files`,VectorStoreFilesPage,{query,...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}del(vectorStoreId,fileId,options){return this._client.delete(`/vector_stores/${vectorStoreId}/files/${fileId}`,{...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}async createAndPoll(vectorStoreId,
body,options){const file=await this.create(vectorStoreId,body,options);return await this.poll(vectorStoreId,file.id,options)}async poll(vectorStoreId,fileId,options){const headers={...options?.headers,"X-Stainless-Poll-Helper":"true"};if(options?.pollIntervalMs)headers["X-Stainless-Custom-Poll-Interval"]=options.pollIntervalMs.toString();while(true){const fileResponse=await this.retrieve(vectorStoreId,fileId,{...options,headers}).withResponse();const file=fileResponse.data;switch(file.status){case "in_progress":let sleepInterval=
5E3;if(options?.pollIntervalMs)sleepInterval=options.pollIntervalMs;else{const headerInterval=fileResponse.response.headers.get("openai-poll-after-ms");if(headerInterval){const headerIntervalMs=parseInt(headerInterval);if(!isNaN(headerIntervalMs))sleepInterval=headerIntervalMs}}await (0,core_1.sleep)(sleepInterval);break;case "failed":case "completed":return file}}}async upload(vectorStoreId,file,options){const fileInfo=await this._client.files.create({file:file,purpose:"assistants"},options);return this.create(vectorStoreId,
{file_id:fileInfo.id},options)}async uploadAndPoll(vectorStoreId,file,options){const fileInfo=await this.upload(vectorStoreId,file,options);return await this.poll(vectorStoreId,fileInfo.id,options)}content(vectorStoreId,fileId,options){return this._client.getAPIList(`/vector_stores/${vectorStoreId}/files/${fileId}/content`,FileContentResponsesPage,{...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}}exports.Files=Files;class VectorStoreFilesPage extends pagination_1.CursorPage{}
exports.VectorStoreFilesPage=VectorStoreFilesPage;class FileContentResponsesPage extends pagination_1.Page{}exports.FileContentResponsesPage=FileContentResponsesPage;Files.VectorStoreFilesPage=VectorStoreFilesPage;Files.FileContentResponsesPage=FileContentResponsesPage},{"../../core.js":11,"../../pagination.js":32,"../../resource.js":33}],77:[function(require,module,exports){var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){if(k2===undefined)k2=k;var desc=Object.getOwnPropertyDescriptor(m,
k);if(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable))desc={enumerable:true,get:function(){return m[k]}};Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){if(k2===undefined)k2=k;o[k2]=m[k]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:true,value:v})}:function(o,v){o["default"]=v});var __importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(mod!=
null)for(var k in mod)if(k!=="default"&&Object.prototype.hasOwnProperty.call(mod,k))__createBinding(result,mod,k);__setModuleDefault(result,mod);return result};Object.defineProperty(exports,"__esModule",{value:true});exports.VectorStoreSearchResponsesPage=exports.VectorStoresPage=exports.VectorStores=void 0;const resource_1=require("../../resource.js");const core_1=require("../../core.js");const FileBatchesAPI=__importStar(require("./file-batches.js"));const file_batches_1=require("./file-batches.js");
const FilesAPI=__importStar(require("./files.js"));const files_1=require("./files.js");const pagination_1=require("../../pagination.js");class VectorStores extends resource_1.APIResource{constructor(){super(...arguments);this.files=new FilesAPI.Files(this._client);this.fileBatches=new FileBatchesAPI.FileBatches(this._client)}create(body,options){return this._client.post("/vector_stores",{body,...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}retrieve(vectorStoreId,options){return this._client.get(`/vector_stores/${vectorStoreId}`,
{...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}update(vectorStoreId,body,options){return this._client.post(`/vector_stores/${vectorStoreId}`,{body,...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}list(query={},options){if((0,core_1.isRequestOptions)(query))return this.list({},query);return this._client.getAPIList("/vector_stores",VectorStoresPage,{query,...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}del(vectorStoreId,options){return this._client.delete(`/vector_stores/${vectorStoreId}`,
{...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}search(vectorStoreId,body,options){return this._client.getAPIList(`/vector_stores/${vectorStoreId}/search`,VectorStoreSearchResponsesPage,{body,method:"post",...options,headers:{"OpenAI-Beta":"assistants=v2",...options?.headers}})}}exports.VectorStores=VectorStores;class VectorStoresPage extends pagination_1.CursorPage{}exports.VectorStoresPage=VectorStoresPage;class VectorStoreSearchResponsesPage extends pagination_1.Page{}
exports.VectorStoreSearchResponsesPage=VectorStoreSearchResponsesPage;VectorStores.VectorStoresPage=VectorStoresPage;VectorStores.VectorStoreSearchResponsesPage=VectorStoreSearchResponsesPage;VectorStores.Files=files_1.Files;VectorStores.VectorStoreFilesPage=files_1.VectorStoreFilesPage;VectorStores.FileContentResponsesPage=files_1.FileContentResponsesPage;VectorStores.FileBatches=file_batches_1.FileBatches},{"../../core.js":11,"../../pagination.js":32,"../../resource.js":33,"./file-batches.js":75,
"./files.js":76}],78:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports._iterSSEMessages=exports.Stream=void 0;const index_1=require("./_shims/index.js");const error_1=require("./error.js");const line_1=require("./internal/decoders/line.js");const stream_utils_1=require("./internal/stream-utils.js");const core_1=require("./core.js");const error_2=require("./error.js");class Stream{constructor(iterator,controller){this.iterator=iterator;this.controller=
controller}static fromSSEResponse(response,controller){let consumed=false;async function*iterator(){if(consumed)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");consumed=true;let done=false;try{for await(const sse of _iterSSEMessages(response,controller)){if(done)continue;if(sse.data.startsWith("[DONE]")){done=true;continue}if(sse.event===null||sse.event.startsWith("response.")||sse.event.startsWith("transcript.")){let data;try{data=JSON.parse(sse.data)}catch(e){console.error(`Could not parse message into JSON:`,
sse.data);console.error(`From chunk:`,sse.raw);throw e;}if(data&&data.error)throw new error_2.APIError(undefined,data.error,undefined,(0,core_1.createResponseHeaders)(response.headers));yield data}else{let data;try{data=JSON.parse(sse.data)}catch(e){console.error(`Could not parse message into JSON:`,sse.data);console.error(`From chunk:`,sse.raw);throw e;}if(sse.event=="error")throw new error_2.APIError(undefined,data.error,data.message,undefined);yield{event:sse.event,data:data}}}done=true}catch(e){if(e instanceof
Error&&e.name==="AbortError")return;throw e;}finally{if(!done)controller.abort()}}return new Stream(iterator,controller)}static fromReadableStream(readableStream,controller){let consumed=false;async function*iterLines(){const lineDecoder=new line_1.LineDecoder;const iter=(0,stream_utils_1.ReadableStreamToAsyncIterable)(readableStream);for await(const chunk of iter)for(const line of lineDecoder.decode(chunk))yield line;for(const line of lineDecoder.flush())yield line}async function*iterator(){if(consumed)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");
consumed=true;let done=false;try{for await(const line of iterLines()){if(done)continue;if(line)yield JSON.parse(line)}done=true}catch(e){if(e instanceof Error&&e.name==="AbortError")return;throw e;}finally{if(!done)controller.abort()}}return new Stream(iterator,controller)}[Symbol.asyncIterator](){return this.iterator()}tee(){const left=[];const right=[];const iterator=this.iterator();const teeIterator=queue=>{return{next:()=>{if(queue.length===0){const result=iterator.next();left.push(result);right.push(result)}return queue.shift()}}};
return[new Stream(()=>teeIterator(left),this.controller),new Stream(()=>teeIterator(right),this.controller)]}toReadableStream(){const self=this;let iter;const encoder=new TextEncoder;return new index_1.ReadableStream({async start(){iter=self[Symbol.asyncIterator]()},async pull(ctrl){try{const {value,done}=await iter.next();if(done)return ctrl.close();const bytes=encoder.encode(JSON.stringify(value)+"\n");ctrl.enqueue(bytes)}catch(err){ctrl.error(err)}},async cancel(){await iter.return?.()}})}}exports.Stream=
Stream;async function*_iterSSEMessages(response,controller){if(!response.body){controller.abort();throw new error_1.OpenAIError(`Attempted to iterate over a response with no body`);}const sseDecoder=new SSEDecoder;const lineDecoder=new line_1.LineDecoder;const iter=(0,stream_utils_1.ReadableStreamToAsyncIterable)(response.body);for await(const sseChunk of iterSSEChunks(iter))for(const line of lineDecoder.decode(sseChunk)){const sse=sseDecoder.decode(line);if(sse)yield sse}for(const line of lineDecoder.flush()){const sse=
sseDecoder.decode(line);if(sse)yield sse}}exports._iterSSEMessages=_iterSSEMessages;async function*iterSSEChunks(iterator){let data=new Uint8Array;for await(const chunk of iterator){if(chunk==null)continue;const binaryChunk=chunk instanceof ArrayBuffer?new Uint8Array(chunk):typeof chunk==="string"?(new TextEncoder).encode(chunk):chunk;let newData=new Uint8Array(data.length+binaryChunk.length);newData.set(data);newData.set(binaryChunk,data.length);data=newData;let patternIndex;while((patternIndex=
(0,line_1.findDoubleNewlineIndex)(data))!==-1){yield data.slice(0,patternIndex);data=data.slice(patternIndex)}}if(data.length>0)yield data}class SSEDecoder{constructor(){this.event=null;this.data=[];this.chunks=[]}decode(line){if(line.endsWith("\r"))line=line.substring(0,line.length-1);if(!line){if(!this.event&&!this.data.length)return null;const sse={event:this.event,data:this.data.join("\n"),raw:this.chunks};this.event=null;this.data=[];this.chunks=[];return sse}this.chunks.push(line);if(line.startsWith(":"))return null;
let [fieldname,_,value]=partition(line,":");if(value.startsWith(" "))value=value.substring(1);if(fieldname==="event")this.event=value;else if(fieldname==="data")this.data.push(value);return null}}function partition(str,delimiter){const index=str.indexOf(delimiter);if(index!==-1)return[str.substring(0,index),delimiter,str.substring(index+delimiter.length)];return[str,"",""]}},{"./_shims/index.js":7,"./core.js":11,"./error.js":12,"./internal/decoders/line.js":14,"./internal/stream-utils.js":19}],79:[function(require,
module,exports){(function(Buffer){(function(){Object.defineProperty(exports,"__esModule",{value:true});exports.createForm=exports.multipartFormRequestOptions=exports.maybeMultipartFormRequestOptions=exports.isMultipartBody=exports.toFile=exports.isUploadable=exports.isBlobLike=exports.isFileLike=exports.isResponseLike=exports.fileFromPath=void 0;const index_1=require("./_shims/index.js");var index_2=require("./_shims/index.js");Object.defineProperty(exports,"fileFromPath",{enumerable:true,get:function(){return index_2.fileFromPath}});
const isResponseLike=value=>value!=null&&typeof value==="object"&&typeof value.url==="string"&&typeof value.blob==="function";exports.isResponseLike=isResponseLike;const isFileLike=value=>value!=null&&typeof value==="object"&&typeof value.name==="string"&&typeof value.lastModified==="number"&&(0,exports.isBlobLike)(value);exports.isFileLike=isFileLike;const isBlobLike=value=>value!=null&&typeof value==="object"&&typeof value.size==="number"&&typeof value.type==="string"&&typeof value.text==="function"&&
typeof value.slice==="function"&&typeof value.arrayBuffer==="function";exports.isBlobLike=isBlobLike;const isUploadable=value=>{return(0,exports.isFileLike)(value)||(0,exports.isResponseLike)(value)||(0,index_1.isFsReadStream)(value)};exports.isUploadable=isUploadable;async function toFile(value,name,options){value=await value;if((0,exports.isFileLike)(value))return value;if((0,exports.isResponseLike)(value)){const blob=await value.blob();name||(name=(new URL(value.url)).pathname.split(/[\\/]/).pop()??
"unknown_file");const data=(0,exports.isBlobLike)(blob)?[await blob.arrayBuffer()]:[blob];return new index_1.File(data,name,options)}const bits=await getBytes(value);name||(name=getName(value)??"unknown_file");if(!options?.type){const type=bits[0]?.type;if(typeof type==="string")options={...options,type}}return new index_1.File(bits,name,options)}exports.toFile=toFile;async function getBytes(value){let parts=[];if(typeof value==="string"||ArrayBuffer.isView(value)||value instanceof ArrayBuffer)parts.push(value);
else if((0,exports.isBlobLike)(value))parts.push(await value.arrayBuffer());else if(isAsyncIterableIterator(value))for await(const chunk of value)parts.push(chunk);else throw new Error(`Unexpected data type: ${typeof value}; constructor: ${value?.constructor?.name}; props: ${propsForError(value)}`);return parts}function propsForError(value){const props=Object.getOwnPropertyNames(value);return`[${props.map(p=>`"${p}"`).join(", ")}]`}function getName(value){return getStringFromMaybeBuffer(value.name)||
getStringFromMaybeBuffer(value.filename)||getStringFromMaybeBuffer(value.path)?.split(/[\\/]/).pop()}const getStringFromMaybeBuffer=x=>{if(typeof x==="string")return x;if(typeof Buffer!=="undefined"&&x instanceof Buffer)return String(x);return undefined};const isAsyncIterableIterator=value=>value!=null&&typeof value==="object"&&typeof value[Symbol.asyncIterator]==="function";const isMultipartBody=body=>body&&typeof body==="object"&&body.body&&body[Symbol.toStringTag]==="MultipartBody";exports.isMultipartBody=
isMultipartBody;const maybeMultipartFormRequestOptions=async opts=>{if(!hasUploadableValue(opts.body))return opts;const form=await (0,exports.createForm)(opts.body);return(0,index_1.getMultipartRequestOptions)(form,opts)};exports.maybeMultipartFormRequestOptions=maybeMultipartFormRequestOptions;const multipartFormRequestOptions=async opts=>{const form=await (0,exports.createForm)(opts.body);return(0,index_1.getMultipartRequestOptions)(form,opts)};exports.multipartFormRequestOptions=multipartFormRequestOptions;
const createForm=async body=>{const form=new index_1.FormData;await Promise.all(Object.entries(body||{}).map(([key,value])=>addFormValue(form,key,value)));return form};exports.createForm=createForm;const hasUploadableValue=value=>{if((0,exports.isUploadable)(value))return true;if(Array.isArray(value))return value.some(hasUploadableValue);if(value&&typeof value==="object")for(const k in value)if(hasUploadableValue(value[k]))return true;return false};const addFormValue=async(form,key,value)=>{if(value===
undefined)return;if(value==null)throw new TypeError(`Received null for "${key}"; to pass null in FormData, you must use the string 'null'`);if(typeof value==="string"||typeof value==="number"||typeof value==="boolean")form.append(key,String(value));else if((0,exports.isUploadable)(value)){const file=await toFile(value);form.append(key,file)}else if(Array.isArray(value))await Promise.all(value.map(entry=>addFormValue(form,key+"[]",entry)));else if(typeof value==="object")await Promise.all(Object.entries(value).map(([name,
prop])=>addFormValue(form,`${key}[${name}]`,prop)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${value} instead`);}}).call(this)}).call(this,require("buffer").Buffer)},{"./_shims/index.js":7,"buffer":2}],80:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.VERSION=void 0;exports.VERSION="4.95.0"},{}],81:[function(require,module,exports){Object.defineProperty(exports,
"__esModule",{value:true});exports.ChatApi=void 0;const AiServer_1=require("../server/AiServer");class ChatApi{static getInstance(){if(!this.instance)this.instance=new ChatApi;return this.instance}chat(text,fn){AiServer_1.AiServer.chat(text,fn)}models(fn){AiServer_1.AiServer.getModels(fn)}}exports.ChatApi=ChatApi},{"../server/AiServer":86}],82:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.ServerConstants=void 0;class ServerConstants{}exports.ServerConstants=
ServerConstants;ServerConstants.MethodDelete="DELETE";ServerConstants.MethodGet="GET";ServerConstants.MethodPost="POST";ServerConstants.MethodPut="PUT"},{}],83:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.UrlConstants=void 0;class UrlConstants{}exports.UrlConstants=UrlConstants;UrlConstants.lmstudio="http://127.0.0.1:1234/v1"},{}],84:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.start=void 0;
const ChatApi_1=require("./api/ChatApi");function start(){window.ChatApi=ChatApi_1.ChatApi.getInstance()}exports.start=start;start()},{"./api/ChatApi":81}],85:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.AbstractServer=void 0;const ServerConstants_1=require("../constants/ServerConstants");const DebugUtil_1=require("../util/DebugUtil");const ServerUtil_1=require("./ServerUtil");class AbstractServer{sendDeleteRequest(url,data,fn){this.sendServerRequest(url,
ServerConstants_1.ServerConstants.MethodDelete,data,fn)}sendGetRequest(url,data,fn){this.sendServerRequest(url,ServerConstants_1.ServerConstants.MethodGet,data,fn)}sendPostRequest(url,data,fn){this.sendServerRequest(url,ServerConstants_1.ServerConstants.MethodPost,data,fn)}sendPutRequest(url,data,fn){this.sendServerRequest(url,ServerConstants_1.ServerConstants.MethodPut,data,fn)}sendServerRequest(url,method,data,fn){const req=new window.qx.io.request.Xhr;if(ServerUtil_1.ServerUtil.methodHasBody(method))req.setRequestData(data);
else url=`${url}?${ServerUtil_1.ServerUtil.serializeData(req,data)}`;req.setUrl(url);req.setMethod(method);req.setRequestHeader("Content-Type","application/json");req.addListener("success",e=>{var req=e.getTarget();if(fn)fn(req)},this);req.addListener("failure",e=>{DebugUtil_1.DebugUtil.log("failure",e)},this);req.send()}}exports.AbstractServer=AbstractServer},{"../constants/ServerConstants":82,"../util/DebugUtil":88,"./ServerUtil":87}],86:[function(require,module,exports){var __awaiter=this&&this.__awaiter||
function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value)})}return new (P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||
[])).next())})};var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{"default":mod}};Object.defineProperty(exports,"__esModule",{value:true});exports.AiServer=void 0;const openai_1=__importDefault(require("openai"));const UrlConstants_1=require("../constants/UrlConstants");const AbstractServer_1=require("./AbstractServer");class AiServer extends AbstractServer_1.AbstractServer{static getInstance(){if(!this.instance)this.instance=new AiServer;return this.instance}static chat(text,
fn){this.getInstance().chat(text,fn)}static getModels(fn){this.getInstance().getModels(fn)}constructor(){super();this.openAi=new openai_1.default({apiKey:"My API Key",dangerouslyAllowBrowser:true,baseURL:UrlConstants_1.UrlConstants.lmstudio})}chat(text,fn){return __awaiter(this,void 0,void 0,function*(){const completion=yield this.openAi.chat.completions.create({model:"gpt-4",messages:[{role:"user",content:text}]});fn(completion.choices)})}getBaseUrl(){return UrlConstants_1.UrlConstants.lmstudio}getModelsUrl(){return`${this.getBaseUrl()}/models`}getModels(fn){this.sendGetRequest(this.getModelsUrl(),
{},fn)}}exports.AiServer=AiServer},{"../constants/UrlConstants":83,"./AbstractServer":85,"openai":13}],87:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.ServerUtil=void 0;class ServerUtil{static methodHasBody(method){return window.qx.util.Request.methodAllowsRequestBody(method)}static serializeData(req,data){return req._serializeData(data)}static wrapUrl(url){return`${url}/api`}}exports.ServerUtil=ServerUtil},{}],88:[function(require,module,exports){Object.defineProperty(exports,
"__esModule",{value:true});exports.DebugUtil=void 0;class DebugUtil{static log(...args){console.log.apply(null,args)}static setX(...args){window.X=args}}exports.DebugUtil=DebugUtil},{}]},{},[84]);
